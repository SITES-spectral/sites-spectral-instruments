import{_ as L}from"./BaseModal-Dc5lCGN1.js";import{c as f,e as u,o as i,f as l,k as S,i as M,t as g,n as k,F as q,h as I,s as j,r as N,p as C,C as w,K as P,J as B,g as D,l as X,D as E,q as G,w as Y}from"./vendor-Ca1yrhWn.js";import{I as O,a as H,h as J}from"./useTypeRegistry-CnfxHgsO.js";const Q=["value"],W={key:1,class:"form-control"},Z={class:"label"},K={class:"label-text font-medium"},_={key:0,class:"text-error"},ee=["value","placeholder","required","disabled","pattern"],te=["value","placeholder","required","disabled","min","max","step"],le=["value","required","disabled"],ae={value:""},se=["value"],ne=["value","required","disabled"],ie=["value","placeholder","required","disabled","rows"],oe={key:5,class:"label"},ue={class:"label-text-alt text-base-content/60"},F={__name:"DynamicField",props:{modelValue:{type:[String,Number,Boolean,null],default:null},fieldKey:{type:String,required:!0},config:{type:Object,required:!0},disabled:{type:Boolean,default:!1},size:{type:String,default:"md",validator:t=>["sm","md","lg"].includes(t)}},emits:["update:modelValue"],setup(t,{emit:x}){const c=t,v=x,b=f(()=>`w-full ${{sm:"input-sm",md:"",lg:"input-lg"}[c.size]}`);function y(p){let o=p.target.value;c.config.type==="number"&&o!==""&&(o=Number(o)),v("update:modelValue",o)}const V=f(()=>c.config.options?c.config.options.map(p=>{var o;if(typeof p=="string"){const n=((o=c.config.optionLabels)==null?void 0:o[p])||p;return{value:p,label:n}}return p}):[]);return f(()=>!!c.config.dependsOn&&!!c.config.optionsByParent),(p,o)=>t.config.type==="hidden"?(i(),u("input",{key:0,type:"hidden",value:t.modelValue??t.config.defaultValue},null,8,Q)):(i(),u("div",W,[l("label",Z,[l("span",K,[M(g(t.config.label)+" ",1),t.config.required?(i(),u("span",_,"*")):S("",!0)])]),t.config.type==="text"||t.config.type==="string"?(i(),u("input",{key:0,type:"text",value:t.modelValue,onInput:y,class:k(["input input-bordered",b.value]),placeholder:t.config.placeholder||"",required:t.config.required,disabled:t.disabled,pattern:t.config.pattern},null,42,ee)):t.config.type==="number"?(i(),u("input",{key:1,type:"number",value:t.modelValue,onInput:y,class:k(["input input-bordered",b.value]),placeholder:t.config.placeholder||"",required:t.config.required,disabled:t.disabled,min:t.config.min,max:t.config.max,step:t.config.step||"any"},null,42,te)):t.config.type==="select"?(i(),u("select",{key:2,value:t.modelValue,onChange:y,class:k(["select select-bordered",b.value]),required:t.config.required,disabled:t.disabled},[l("option",ae,g(t.config.placeholder||"Select..."),1),(i(!0),u(q,null,I(V.value,n=>(i(),u("option",{key:n.value,value:n.value},g(n.label),9,se))),128))],42,le)):t.config.type==="date"?(i(),u("input",{key:3,type:"date",value:t.modelValue,onInput:y,class:k(["input input-bordered",b.value]),required:t.config.required,disabled:t.disabled},null,42,ne)):t.config.type==="textarea"?(i(),u("textarea",{key:4,value:t.modelValue,onInput:y,class:k(["textarea textarea-bordered",b.value]),placeholder:t.config.placeholder||"",required:t.config.required,disabled:t.disabled,rows:t.config.rows||3},null,42,ie)):S("",!0),t.config.helpText?(i(),u("label",oe,[l("span",ue,g(t.config.helpText),1)])):S("",!0)]))}},de={__name:"DynamicFieldGroup",props:{modelValue:{type:Object,default:()=>({})},schema:{type:Object,required:!0},columns:{type:Number,default:2},size:{type:String,default:"sm"},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:x}){const c=t,v=x,b=f(()=>Object.entries(c.schema).filter(([,n])=>n.type!=="hidden")),y=f(()=>Object.entries(c.schema).filter(([,n])=>n.type==="hidden")),V=f(()=>{const n={1:"grid-cols-1",2:"grid-cols-1 md:grid-cols-2",3:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3",4:"grid-cols-1 md:grid-cols-2 lg:grid-cols-4"};return n[c.columns]||n[2]});function p(n,d){v("update:modelValue",{...c.modelValue,[n]:d})}function o(n,d){const m=c.modelValue[n];return m??d.defaultValue??null}return(n,d)=>(i(),u("div",null,[(i(!0),u(q,null,I(y.value,([m,h])=>(i(),j(F,{key:m,"field-key":m,config:h,"model-value":o(m,h),"onUpdate:modelValue":$=>p(m,$)},null,8,["field-key","config","model-value","onUpdate:modelValue"]))),128)),l("div",{class:k(["grid gap-4",V.value])},[(i(!0),u(q,null,I(b.value,([m,h])=>(i(),j(F,{key:m,"field-key":m,config:h,"model-value":o(m,h),size:t.size,disabled:t.disabled,"onUpdate:modelValue":$=>p(m,$)},null,8,["field-key","config","model-value","size","disabled","onUpdate:modelValue"]))),128))],2)]))}},re={key:0,class:"form-control"},ce={class:"grid grid-cols-2 md:grid-cols-3 gap-2"},me=["value"],pe={class:"form-control"},fe={class:"bg-base-200 px-4 py-3 rounded-lg font-mono"},be={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ve={class:"form-control"},ye=["value"],ge={class:"form-control"},he=["value"],xe={key:1,class:"form-control"},Ve={class:"label"},ke={class:"label-text font-medium"},qe={class:"bg-base-200 p-4 rounded-lg"},Ie={key:2,class:"alert"},$e={class:"collapse collapse-arrow bg-base-200"},we={class:"collapse-content space-y-4"},Se={class:"form-control"},Oe={class:"form-control"},Ne={class:"flex justify-end gap-2 pt-4"},Te=["disabled"],je=["disabled"],Ue={key:0,class:"loading loading-spinner loading-sm"},ze={__name:"InstrumentForm",props:{instrument:{type:Object,default:null},platformId:{type:Number,required:!0},platformName:{type:String,required:!0},platformType:{type:String,default:"fixed"},loading:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(t,{emit:x}){const c=t,v=x,b=f(()=>Object.entries(O).filter(([s,e])=>e.platformCompatibility?e.platformCompatibility.includes(c.platformType):!0).map(([s,e])=>({value:s,label:e.name,code:e.code,icon:e.icon}))),y=["Active","Inactive","Maintenance","Decommissioned"],V=["active","paused","stopped","error"],p=f(()=>!!c.instrument),o=N("phenocam"),n=N({}),d=N({display_name:"",description:"",status:"Active",measurement_status:"active"}),m=f(()=>H(o.value)),h=f(()=>{const s=m.value;if(!(s!=null&&s.fields))return{};const e={};return Object.entries(s.fields).forEach(([r,a])=>{e[r]={type:a.type||"text",label:a.label,required:a.required||!1,placeholder:a.placeholder,options:a.options,min:a.min,max:a.max,step:a.step,unit:a.unit,defaultValue:a.defaultValue}}),e}),$=f(()=>{const s=J(o.value)||"XXX";return`${c.platformName}_${s}##`});C(()=>c.instrument,s=>{if(s){const e=Object.keys(O).find(r=>O[r].name===s.instrument_type||r===s.instrument_type.toLowerCase().replace(/\s+/g,""))||"phenocam";o.value=e,d.value={display_name:s.display_name||"",description:s.description||"",status:s.status||"Active",measurement_status:s.measurement_status||"active"},n.value=s.specifications||{}}},{immediate:!0}),C(o,(s,e)=>{if(s!==e&&!p.value){const r=O[s],a={};r!=null&&r.fields&&Object.entries(r.fields).forEach(([T,z])=>{z.defaultValue!==void 0&&(a[T]=z.defaultValue)}),n.value=a}});const U=f(()=>{if(!o.value)return!1;const s=m.value;if(!(s!=null&&s.fields))return!0;for(const[e,r]of Object.entries(s.fields))if(r.required){const a=n.value[e];if(a==null||a==="")return!1}return!0});function A(){if(!U.value)return;const s=m.value,e={platform_id:c.platformId,instrument_type:(s==null?void 0:s.name)||o.value,display_name:d.value.display_name||void 0,description:d.value.description||void 0,status:d.value.status,measurement_status:d.value.measurement_status,specifications:{...n.value}};Object.keys(e).forEach(r=>{(e[r]===void 0||e[r]==="")&&delete e[r]}),Object.keys(e.specifications).forEach(r=>{(e.specifications[r]===void 0||e.specifications[r]==="")&&delete e.specifications[r]}),v("submit",e)}function R(){v("cancel")}return(s,e)=>{var r;return i(),u("form",{onSubmit:G(A,["prevent"]),class:"space-y-6"},[p.value?S("",!0):(i(),u("div",re,[e[6]||(e[6]=l("label",{class:"label"},[l("span",{class:"label-text font-medium"},"Instrument Type *")],-1)),l("div",ce,[(i(!0),u(q,null,I(b.value,a=>(i(),u("label",{key:a.value,class:k(["flex items-center gap-2 px-3 py-2 rounded-lg border cursor-pointer transition-colors text-sm",o.value===a.value?"border-primary bg-primary/10":"border-base-300 hover:border-primary/50"])},[w(l("input",{type:"radio","onUpdate:modelValue":e[0]||(e[0]=T=>o.value=T),value:a.value,class:"radio radio-primary radio-sm"},null,8,me),[[P,o.value]]),l("span",null,g(a.icon),1),l("span",null,g(a.label),1)],2))),128))])])),l("div",pe,[e[7]||(e[7]=l("label",{class:"label"},[l("span",{class:"label-text font-medium"},"Instrument Name Preview")],-1)),l("div",fe,g($.value),1),e[8]||(e[8]=l("label",{class:"label"},[l("span",{class:"label-text-alt text-base-content/60"}," Auto-generated based on platform and instrument type ")],-1))]),l("div",be,[l("div",ve,[e[9]||(e[9]=l("label",{class:"label"},[l("span",{class:"label-text font-medium"},"Status")],-1)),w(l("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>d.value.status=a),class:"select select-bordered w-full"},[(i(),u(q,null,I(y,a=>l("option",{key:a,value:a},g(a),9,ye)),64))],512),[[B,d.value.status]])]),l("div",ge,[e[10]||(e[10]=l("label",{class:"label"},[l("span",{class:"label-text font-medium"},"Measurement Status")],-1)),w(l("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>d.value.measurement_status=a),class:"select select-bordered w-full"},[(i(),u(q,null,I(V,a=>l("option",{key:a,value:a},g(a),9,he)),64))],512),[[B,d.value.measurement_status]])])]),Object.keys(h.value).length>0?(i(),u("div",xe,[l("label",Ve,[l("span",ke,g(((r=m.value)==null?void 0:r.name)||"Instrument")+" Specifications ",1)]),l("div",qe,[D(X(de),{modelValue:n.value,"onUpdate:modelValue":e[3]||(e[3]=a=>n.value=a),schema:h.value,columns:2,size:"sm"},null,8,["modelValue","schema"])])])):(i(),u("div",Ie,[...e[11]||(e[11]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",class:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),l("span",null,"No additional specifications required for this instrument type.",-1)])])),l("div",$e,[e[14]||(e[14]=l("input",{type:"checkbox"},null,-1)),e[15]||(e[15]=l("div",{class:"collapse-title font-medium"}," Optional Fields ",-1)),l("div",we,[l("div",Se,[e[12]||(e[12]=l("label",{class:"label"},[l("span",{class:"label-text"},"Display Name")],-1)),w(l("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>d.value.display_name=a),type:"text",class:"input input-bordered",placeholder:"Human-readable name"},null,512),[[E,d.value.display_name]])]),l("div",Oe,[e[13]||(e[13]=l("label",{class:"label"},[l("span",{class:"label-text"},"Description")],-1)),w(l("textarea",{"onUpdate:modelValue":e[5]||(e[5]=a=>d.value.description=a),class:"textarea textarea-bordered",rows:"2",placeholder:"Instrument description..."},null,512),[[E,d.value.description]])])])]),l("div",Ne,[l("button",{type:"button",class:"btn btn-ghost",onClick:R,disabled:t.loading}," Cancel ",8,Te),l("button",{type:"submit",class:"btn btn-primary",disabled:!U.value||t.loading},[t.loading?(i(),u("span",Ue)):S("",!0),M(" "+g(p.value?"Update Instrument":"Create Instrument"),1)],8,je)])],32)}}},Fe={__name:"InstrumentFormModal",props:{modelValue:{type:Boolean,default:!1},instrument:{type:Object,default:null},platformId:{type:Number,required:!0},platformName:{type:String,required:!0},platformType:{type:String,default:"fixed"}},emits:["update:modelValue","submit","cancel"],setup(t,{emit:x}){const c=t,v=x,b=N(!1),y=f(()=>!!c.instrument),V=f(()=>y.value?"Edit Instrument":"Create Instrument");async function p(d){b.value=!0;try{v("submit",d)}finally{b.value=!1}}function o(){v("update:modelValue",!1),v("cancel")}function n(){v("update:modelValue",!1)}return(d,m)=>(i(),j(L,{"model-value":t.modelValue,title:V.value,size:"lg","onUpdate:modelValue":m[0]||(m[0]=h=>d.$emit("update:modelValue",h)),onClose:n},{default:Y(()=>[D(ze,{instrument:t.instrument,"platform-id":t.platformId,"platform-name":t.platformName,"platform-type":t.platformType,loading:b.value,onSubmit:p,onCancel:o},null,8,["instrument","platform-id","platform-name","platform-type","loading"])]),_:1},8,["model-value","title"]))}};export{Fe as _};
