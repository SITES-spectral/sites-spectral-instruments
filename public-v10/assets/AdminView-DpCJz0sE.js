import{c as u,r as y,m as z,e as r,o as i,f as e,i as j,t as c,k as U,F as M,h as $,n as R,q as B,C as S,D,J as V,l as A,a as J,s as Y,j as L}from"./vendor-Ca1yrhWn.js";import{u as P,A as G,e as K,d as F,c as Q}from"./index-DEDt9UTl.js";const O=["admin","sites-admin","spectral-admin"],E=["abisko","asa","grimsoe","lonnstorp","robacksdalen","skogaryd","svartberget"],C={admin:{name:"Administrator",description:"Full system access across all stations",level:100,icon:"fa-shield-halved",color:"error"},"spectral-admin":{name:"Spectral Administrator",description:"Full access for SITES Spectral management",level:100,icon:"fa-sun",color:"error"},"sites-admin":{name:"SITES Administrator",description:"Full access for SITES infrastructure management",level:100,icon:"fa-building",color:"error"},"sites-spectral-admin":{name:"SITES Spectral Administrator",description:"Full access for combined SITES Spectral management",level:100,icon:"fa-star",color:"error"},"station-admin":{name:"Station Administrator",description:"Full access to manage a specific station",level:75,icon:"fa-user-gear",color:"warning"},station:{name:"Station User",description:"Limited edit access for a specific station",level:50,icon:"fa-user",color:"info"},readonly:{name:"Read Only",description:"View-only access to all data",level:10,icon:"fa-eye",color:"neutral"}};function H(){const a=P();function w(l){return C[l]||C.readonly}const v=u(()=>{const l=a.userRole;return w(l).name}),h=u(()=>{const l=a.userRole;return`badge-${w(l).color}`}),d=u(()=>{const l=a.userRole;return`fa-solid ${w(l).icon}`}),b=u(()=>a.isAdmin),f=u(()=>a.isAdmin),m=u(()=>a.isAdmin),g=u(()=>a.isAdmin||a.isStationAdmin||a.isStationUser),o=u(()=>a.isAdmin||a.isStationAdmin),x=u(()=>O.includes(a.userRole)),n=u(()=>a.isAdmin||a.isStationAdmin||a.isStationUser),k=u(()=>a.isAdmin||a.isStationAdmin||a.isStationUser),p=u(()=>a.isAdmin||a.isStationAdmin),_=u(()=>a.isAuthenticated),N=u(()=>{if(a.isAdmin)return E;if(a.isStationAdmin||a.isStationUser){const l=a.userStationFromUsername;return l?[l]:[]}return E});function T(l){return{"users.manage":b.value,"stations.manage":f.value,"settings.manage":m.value,"platforms.create":g.value,"platforms.delete":o.value,"instruments.create":a.isAdmin||a.isStationAdmin||a.isStationUser,"instruments.delete":a.isAdmin||a.isStationAdmin,"rois.create":k.value,"rois.edit":n.value,"rois.edit.direct":x.value,"rois.delete":p.value,"rois.legacy.view":_.value,"export.full":a.isAdmin}[l]??!1}const I=u(()=>({"users.manage":b.value,"stations.manage":f.value,"settings.manage":m.value,"platforms.create":g.value,"platforms.delete":o.value,"instruments.create":a.isAdmin||a.isStationAdmin||a.isStationUser,"instruments.delete":a.isAdmin||a.isStationAdmin,"rois.create":k.value,"rois.edit":n.value,"rois.edit.direct":x.value,"rois.delete":p.value,"rois.legacy.view":_.value,"export.full":a.isAdmin}));return{STATION_NAMES:E,ROLE_DEFINITIONS:C,ADMIN_ROLES:K,ADMIN_USERNAMES:G,SUPER_ADMIN_ROLES:O,currentRoleDisplay:v,roleBadgeClass:h,roleIconClass:d,canManageUsers:b,canManageStations:f,canManageSettings:m,canCreatePlatforms:g,canDeletePlatforms:o,accessibleStations:N,currentPermissions:I,canDirectEditROI:x,canEditROI:n,canCreateROI:k,canDeleteROI:p,canViewLegacyROIs:_,getRoleDefinition:w,hasPermission:T}}const W={class:"space-y-4"},X={key:0,class:"flex justify-center py-8"},Z={key:1,class:"alert alert-error"},ee={key:2,class:"overflow-x-auto"},te={class:"table table-zebra"},se={class:"font-medium"},le={class:"flex gap-1"},ae=["onClick"],oe=["onClick"],ne={key:0},ie={class:"modal-box"},re={class:"form-control mb-4"},de={class:"form-control mb-4"},ue={class:"form-control mb-4"},ce=["value"],ve={key:0,class:"form-control mb-4"},me=["value"],pe={class:"modal-action"},be=["disabled"],fe={key:0,class:"loading loading-spinner loading-sm"},ge={method:"dialog",class:"modal-backdrop"},xe={class:"modal-box"},we={class:"form-control mb-4"},ye={class:"form-control mb-4"},he={class:"form-control mb-4"},ke=["value"],Se={key:0,class:"form-control mb-4"},Ae=["value"],_e={class:"modal-action"},Ue=["disabled"],Me={key:0,class:"loading loading-spinner loading-sm"},$e={method:"dialog",class:"modal-backdrop"},Ce={__name:"UserManagement",setup(a){const{canManageUsers:w}=H(),v=Q(),h=y([]),d=y(!1),b=y(null),f=y(!1),m=y(!1),g=y(null),o=y({username:"",password:"",role:"readonly",station_id:null});async function x(){if(w.value){d.value=!0,b.value=null;try{const l=await F.get("/users");l.success?h.value=l.users||[]:b.value=l.error||"Failed to fetch users"}catch(l){b.value=l.message||"Failed to fetch users"}finally{d.value=!1}}}function n(l){return C[l]||C.readonly}function k(){o.value={username:"",password:"",role:"readonly",station_id:null},f.value=!0}function p(l){g.value=l,o.value={username:l.username,password:"",role:l.role||"readonly",station_id:l.station_id},m.value=!0}async function _(){d.value=!0;try{const l=await F.post("/users",o.value);l.success?(v.success("User created successfully"),f.value=!1,await x()):v.error(l.error||"Failed to create user")}catch(l){v.error(l.message||"Failed to create user")}finally{d.value=!1}}async function N(){if(g.value){d.value=!0;try{const l={...o.value};l.password||delete l.password;const t=await F.put(`/users/${g.value.id}`,l);t.success?(v.success("User updated successfully"),m.value=!1,g.value=null,await x()):v.error(t.error||"Failed to update user")}catch(l){v.error(l.message||"Failed to update user")}finally{d.value=!1}}}async function T(l){if(confirm(`Are you sure you want to delete user "${l.username}"?`)){d.value=!0;try{const t=await F.delete(`/users/${l.id}`);t.success?(v.success("User deleted successfully"),await x()):v.error(t.error||"Failed to delete user")}catch(t){v.error(t.message||"Failed to delete user")}finally{d.value=!1}}}const I=u(()=>Object.entries(C).map(([l,t])=>({value:l,label:t.name,description:t.description})));return z(x),(l,t)=>(i(),r("div",W,[e("div",{class:"flex items-center justify-between"},[t[13]||(t[13]=e("h2",{class:"text-xl font-semibold"},"User Management",-1)),e("button",{class:"btn btn-primary btn-sm",onClick:k},[...t[12]||(t[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),j(" Add User ",-1)])])]),d.value&&h.value.length===0?(i(),r("div",X,[...t[14]||(t[14]=[e("span",{class:"loading loading-spinner loading-lg"},null,-1)])])):b.value?(i(),r("div",Z,[t[15]||(t[15]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",null,c(b.value),1)])):(i(),r("div",ee,[e("table",te,[t[19]||(t[19]=e("thead",null,[e("tr",null,[e("th",null,"Username"),e("th",null,"Role"),e("th",null,"Station"),e("th",null,"Created"),e("th",null,"Actions")])],-1)),e("tbody",null,[(i(!0),r(M,null,$(h.value,s=>(i(),r("tr",{key:s.id},[e("td",se,c(s.username),1),e("td",null,[e("span",{class:R(["badge",`badge-${n(s.role).color}`])},c(n(s.role).name),3)]),e("td",null,c(s.station_name||"-"),1),e("td",null,c(s.created_at?new Date(s.created_at).toLocaleDateString():"-"),1),e("td",null,[e("div",le,[e("button",{class:"btn btn-ghost btn-xs",onClick:q=>p(s)},[...t[16]||(t[16]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,ae),e("button",{class:"btn btn-ghost btn-xs text-error",onClick:q=>T(s)},[...t[17]||(t[17]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,oe)])])]))),128)),h.value.length===0?(i(),r("tr",ne,[...t[18]||(t[18]=[e("td",{colspan:"5",class:"text-center text-base-content/60 py-8"}," No users found ",-1)])])):U("",!0)])])])),e("dialog",{class:R(["modal",{"modal-open":f.value}])},[e("div",ie,[t[26]||(t[26]=e("h3",{class:"font-bold text-lg mb-4"},"Create User",-1)),e("form",{onSubmit:B(_,["prevent"])},[e("div",re,[t[20]||(t[20]=e("label",{class:"label"},[e("span",{class:"label-text"},"Username")],-1)),S(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>o.value.username=s),type:"text",class:"input input-bordered",required:""},null,512),[[D,o.value.username]])]),e("div",de,[t[21]||(t[21]=e("label",{class:"label"},[e("span",{class:"label-text"},"Password")],-1)),S(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>o.value.password=s),type:"password",class:"input input-bordered",required:""},null,512),[[D,o.value.password]])]),e("div",ue,[t[22]||(t[22]=e("label",{class:"label"},[e("span",{class:"label-text"},"Role")],-1)),S(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>o.value.role=s),class:"select select-bordered"},[(i(!0),r(M,null,$(I.value,s=>(i(),r("option",{key:s.value,value:s.value},c(s.label),9,ce))),128))],512),[[V,o.value.role]])]),o.value.role==="station"?(i(),r("div",ve,[t[24]||(t[24]=e("label",{class:"label"},[e("span",{class:"label-text"},"Station")],-1)),S(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>o.value.station_id=s),class:"select select-bordered"},[t[23]||(t[23]=e("option",{value:null},"Select station...",-1)),(i(!0),r(M,null,$(A(E),s=>(i(),r("option",{key:s,value:s},c(s),9,me))),128))],512),[[V,o.value.station_id]])])):U("",!0),e("div",pe,[e("button",{type:"button",class:"btn",onClick:t[4]||(t[4]=s=>f.value=!1)},"Cancel"),e("button",{type:"submit",class:"btn btn-primary",disabled:d.value},[d.value?(i(),r("span",fe)):U("",!0),t[25]||(t[25]=j(" Create ",-1))],8,be)])],32)]),e("form",ge,[e("button",{onClick:t[5]||(t[5]=s=>f.value=!1)},"close")])],2),e("dialog",{class:R(["modal",{"modal-open":m.value}])},[e("div",xe,[t[33]||(t[33]=e("h3",{class:"font-bold text-lg mb-4"},"Edit User",-1)),e("form",{onSubmit:B(N,["prevent"])},[e("div",we,[t[27]||(t[27]=e("label",{class:"label"},[e("span",{class:"label-text"},"Username")],-1)),S(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>o.value.username=s),type:"text",class:"input input-bordered",required:""},null,512),[[D,o.value.username]])]),e("div",ye,[t[28]||(t[28]=e("label",{class:"label"},[e("span",{class:"label-text"},"Password (leave blank to keep current)")],-1)),S(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>o.value.password=s),type:"password",class:"input input-bordered"},null,512),[[D,o.value.password]])]),e("div",he,[t[29]||(t[29]=e("label",{class:"label"},[e("span",{class:"label-text"},"Role")],-1)),S(e("select",{"onUpdate:modelValue":t[8]||(t[8]=s=>o.value.role=s),class:"select select-bordered"},[(i(!0),r(M,null,$(I.value,s=>(i(),r("option",{key:s.value,value:s.value},c(s.label),9,ke))),128))],512),[[V,o.value.role]])]),o.value.role==="station"?(i(),r("div",Se,[t[31]||(t[31]=e("label",{class:"label"},[e("span",{class:"label-text"},"Station")],-1)),S(e("select",{"onUpdate:modelValue":t[9]||(t[9]=s=>o.value.station_id=s),class:"select select-bordered"},[t[30]||(t[30]=e("option",{value:null},"Select station...",-1)),(i(!0),r(M,null,$(A(E),s=>(i(),r("option",{key:s,value:s},c(s),9,Ae))),128))],512),[[V,o.value.station_id]])])):U("",!0),e("div",_e,[e("button",{type:"button",class:"btn",onClick:t[10]||(t[10]=s=>m.value=!1)},"Cancel"),e("button",{type:"submit",class:"btn btn-primary",disabled:d.value},[d.value?(i(),r("span",Me)):U("",!0),t[32]||(t[32]=j(" Update ",-1))],8,Ue)])],32)]),e("form",$e,[e("button",{onClick:t[11]||(t[11]=s=>m.value=!1)},"close")])],2)]))}},Re={key:0},Ee={class:"bg-base-100 rounded-lg shadow-lg p-6 mb-6"},Ie={class:"flex items-center justify-between"},De={class:"flex items-center gap-3"},Ve={class:"text-sm text-base-content/60"},Fe={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-4 border-t border-base-200"},je={class:"stat bg-base-200 rounded-lg p-4"},Ne={class:"stat-value text-2xl"},Te={class:"stat bg-base-200 rounded-lg p-4"},Be={class:"stat-value text-2xl"},Le={class:"stat bg-base-200 rounded-lg p-4"},Oe={class:"stat-value text-2xl"},ze={class:"stat bg-base-200 rounded-lg p-4"},Pe={class:"stat-value text-2xl"},He={class:"tabs tabs-boxed bg-base-200 p-1 mb-6"},qe=["onClick"],Je={xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Ye=["d"],Ge={class:"bg-base-100 rounded-lg shadow-lg p-6"},Ke={key:1,class:"space-y-6"},Qe={key:2,class:"space-y-4"},We={key:1,class:"text-center py-12"},et={__name:"AdminView",setup(a){const w=J(),v=P(),{canManageUsers:h,canManageSettings:d,currentRoleDisplay:b,roleBadgeClass:f}=H();z(()=>{v.isAdmin||w.push("/")});const m=y("users"),g=u(()=>[{id:"users",name:"Users",icon:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z",visible:h.value},{id:"settings",name:"Settings",icon:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z M15 12a3 3 0 11-6 0 3 3 0 016 0z",visible:d.value},{id:"activity",name:"Activity Log",icon:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01",visible:d.value}].filter(n=>n.visible)),o=y({totalUsers:0,totalStations:7,totalPlatforms:0,totalInstruments:0});return(x,n)=>{var k;return A(v).isAdmin?(i(),r("div",Re,[e("div",Ee,[e("div",Ie,[n[1]||(n[1]=e("div",null,[e("h1",{class:"text-2xl font-bold"},"Administration"),e("p",{class:"text-base-content/60 mt-1"}," Manage users, settings, and system configuration ")],-1)),e("div",De,[e("span",{class:R(["badge",A(f)])},c(A(b)),3),e("span",Ve,c((k=A(v).user)==null?void 0:k.username),1)])]),e("div",Fe,[e("div",je,[n[2]||(n[2]=e("div",{class:"stat-title text-xs"},"Users",-1)),e("div",Ne,c(o.value.totalUsers),1)]),e("div",Te,[n[3]||(n[3]=e("div",{class:"stat-title text-xs"},"Stations",-1)),e("div",Be,c(o.value.totalStations),1)]),e("div",Le,[n[4]||(n[4]=e("div",{class:"stat-title text-xs"},"Platforms",-1)),e("div",Oe,c(o.value.totalPlatforms),1)]),e("div",ze,[n[5]||(n[5]=e("div",{class:"stat-title text-xs"},"Instruments",-1)),e("div",Pe,c(o.value.totalInstruments),1)])])]),e("div",He,[(i(!0),r(M,null,$(g.value,p=>(i(),r("button",{key:p.id,class:R(["tab",{"tab-active":m.value===p.id}]),onClick:_=>m.value=p.id},[(i(),r("svg",Je,[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:p.icon},null,8,Ye)])),j(" "+c(p.name),1)],10,qe))),128))]),e("div",Ge,[m.value==="users"?(i(),Y(A(Ce),{key:0})):m.value==="settings"?(i(),r("div",Ke,[...n[6]||(n[6]=[L('<h2 class="text-xl font-semibold">System Settings</h2><div class="divider">Application</div><div class="form-control"><label class="label cursor-pointer justify-start gap-4"><input type="checkbox" class="toggle toggle-primary" checked><div><span class="label-text font-medium">Enable User Registration</span><p class="text-xs text-base-content/60">Allow new users to self-register</p></div></label></div><div class="form-control"><label class="label cursor-pointer justify-start gap-4"><input type="checkbox" class="toggle toggle-primary" checked><div><span class="label-text font-medium">Require Email Verification</span><p class="text-xs text-base-content/60">New users must verify email before access</p></div></label></div><div class="divider">Security</div><div class="form-control"><label class="label"><span class="label-text">Session Timeout (hours)</span></label><input type="number" class="input input-bordered w-32" value="24" min="1" max="168"></div><div class="form-control"><label class="label"><span class="label-text">Max Login Attempts</span></label><input type="number" class="input input-bordered w-32" value="5" min="3" max="10"></div><div class="divider">Maintenance</div><div class="flex gap-4"><button class="btn btn-outline"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg> Export Database </button><button class="btn btn-outline"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> Clear Cache </button></div>',9)])])):m.value==="activity"?(i(),r("div",Qe,[...n[7]||(n[7]=[L('<h2 class="text-xl font-semibold">Activity Log</h2><div class="overflow-x-auto"><table class="table table-zebra"><thead><tr><th>Timestamp</th><th>User</th><th>Action</th><th>Entity</th><th>Details</th></tr></thead><tbody><tr><td colspan="5" class="text-center text-base-content/60 py-8"> Activity log will be displayed here </td></tr></tbody></table></div>',2)])])):U("",!0)])])):(i(),r("div",We,[n[8]||(n[8]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 mx-auto text-error",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})],-1)),n[9]||(n[9]=e("h2",{class:"text-xl font-bold mt-4"},"Access Denied",-1)),n[10]||(n[10]=e("p",{class:"text-base-content/60 mt-2"},"You do not have permission to access this area.",-1)),e("button",{class:"btn btn-primary mt-4",onClick:n[0]||(n[0]=p=>A(w).push("/"))}," Return to Dashboard ")]))}}};export{et as default};
