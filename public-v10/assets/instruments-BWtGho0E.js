import{_ as L}from"./BaseModal-BSvtwcmN.js";import{c as b,e as p,o as c,f as a,k as j,h as P,t as V,n as $,F as O,i as N,p as E,r as k,E as z,B as T,K as X,J as M,g as R,l as G,C as D,A as Y,w as H,d as J}from"./vendor-oiqY8oHn.js";import{I as C,a as Q,h as W}from"./platforms-B8RC1nK3.js";import{c as S}from"./index-BP56eZvN.js";const Z=["value"],K={key:1,class:"form-control"},_={class:"label"},ee={class:"label-text font-medium"},te={key:0,class:"text-error"},le=["value","placeholder","required","disabled","pattern"],ae=["value","placeholder","required","disabled","min","max","step"],ne=["value","required","disabled"],se={value:""},ue=["value"],ie=["value","required","disabled"],re=["value","placeholder","required","disabled","rows"],oe={key:5,class:"label"},de={class:"label-text-alt text-base-content/60"},A={__name:"DynamicField",props:{modelValue:{type:[String,Number,Boolean,null],default:null},fieldKey:{type:String,required:!0},config:{type:Object,required:!0},disabled:{type:Boolean,default:!1},size:{type:String,default:"md",validator:t=>["sm","md","lg"].includes(t)}},emits:["update:modelValue"],setup(t,{emit:y}){const s=t,u=y,g=b(()=>`w-full ${{sm:"input-sm",md:"",lg:"input-lg"}[s.size]}`);function h(v){let o=v.target.value;s.config.type==="number"&&o!==""&&(o=Number(o)),u("update:modelValue",o)}const I=b(()=>s.config.options?s.config.options.map(v=>{var o;if(typeof v=="string"){const r=((o=s.config.optionLabels)==null?void 0:o[v])||v;return{value:v,label:r}}return v}):[]);return b(()=>!!s.config.dependsOn&&!!s.config.optionsByParent),(v,o)=>t.config.type==="hidden"?(c(),p("input",{key:0,type:"hidden",value:t.modelValue??t.config.defaultValue},null,8,Z)):(c(),p("div",K,[a("label",_,[a("span",ee,[P(V(t.config.label)+" ",1),t.config.required?(c(),p("span",te,"*")):j("",!0)])]),t.config.type==="text"||t.config.type==="string"?(c(),p("input",{key:0,type:"text",value:t.modelValue,onInput:h,class:$(["input input-bordered",g.value]),placeholder:t.config.placeholder||"",required:t.config.required,disabled:t.disabled,pattern:t.config.pattern},null,42,le)):t.config.type==="number"?(c(),p("input",{key:1,type:"number",value:t.modelValue,onInput:h,class:$(["input input-bordered",g.value]),placeholder:t.config.placeholder||"",required:t.config.required,disabled:t.disabled,min:t.config.min,max:t.config.max,step:t.config.step||"any"},null,42,ae)):t.config.type==="select"?(c(),p("select",{key:2,value:t.modelValue,onChange:h,class:$(["select select-bordered",g.value]),required:t.config.required,disabled:t.disabled},[a("option",se,V(t.config.placeholder||"Select..."),1),(c(!0),p(O,null,N(I.value,r=>(c(),p("option",{key:r.value,value:r.value},V(r.label),9,ue))),128))],42,ne)):t.config.type==="date"?(c(),p("input",{key:3,type:"date",value:t.modelValue,onInput:h,class:$(["input input-bordered",g.value]),required:t.config.required,disabled:t.disabled},null,42,ie)):t.config.type==="textarea"?(c(),p("textarea",{key:4,value:t.modelValue,onInput:h,class:$(["textarea textarea-bordered",g.value]),placeholder:t.config.placeholder||"",required:t.config.required,disabled:t.disabled,rows:t.config.rows||3},null,42,re)):j("",!0),t.config.helpText?(c(),p("label",oe,[a("span",de,V(t.config.helpText),1)])):j("",!0)]))}},ce={__name:"DynamicFieldGroup",props:{modelValue:{type:Object,default:()=>({})},schema:{type:Object,required:!0},columns:{type:Number,default:2},size:{type:String,default:"sm"},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:y}){const s=t,u=y,g=b(()=>Object.entries(s.schema).filter(([,r])=>r.type!=="hidden")),h=b(()=>Object.entries(s.schema).filter(([,r])=>r.type==="hidden")),I=b(()=>{const r={1:"grid-cols-1",2:"grid-cols-1 md:grid-cols-2",3:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3",4:"grid-cols-1 md:grid-cols-2 lg:grid-cols-4"};return r[s.columns]||r[2]});function v(r,m){u("update:modelValue",{...s.modelValue,[r]:m})}function o(r,m){const f=s.modelValue[r];return f??m.defaultValue??null}return(r,m)=>(c(),p("div",null,[(c(!0),p(O,null,N(h.value,([f,x])=>(c(),E(A,{key:f,"field-key":f,config:x,"model-value":o(f,x),"onUpdate:modelValue":w=>v(f,w)},null,8,["field-key","config","model-value","onUpdate:modelValue"]))),128)),a("div",{class:$(["grid gap-4",I.value])},[(c(!0),p(O,null,N(g.value,([f,x])=>(c(),E(A,{key:f,"field-key":f,config:x,"model-value":o(f,x),size:t.size,disabled:t.disabled,"onUpdate:modelValue":w=>v(f,w)},null,8,["field-key","config","model-value","size","disabled","onUpdate:modelValue"]))),128))],2)]))}},me={key:0,class:"form-control"},fe={class:"grid grid-cols-2 md:grid-cols-3 gap-2"},pe=["value"],ve={class:"form-control"},be={class:"bg-base-200 px-4 py-3 rounded-lg font-mono"},ye={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ge={class:"form-control"},he=["value"],xe={class:"form-control"},Ve=["value"],Ie={key:1,class:"form-control"},ke={class:"label"},we={class:"label-text font-medium"},$e={class:"bg-base-200 p-4 rounded-lg"},qe={key:2,class:"alert"},Se={class:"collapse collapse-arrow bg-base-200"},Oe={class:"collapse-content space-y-4"},Ne={class:"form-control"},Te={class:"form-control"},je={class:"flex justify-end gap-2 pt-4"},Fe=["disabled"],Be=["disabled"],Ce={key:0,class:"loading loading-spinner loading-sm"},Ue={__name:"InstrumentForm",props:{instrument:{type:Object,default:null},platformId:{type:Number,required:!0},platformName:{type:String,required:!0},platformType:{type:String,default:"fixed"},loading:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(t,{emit:y}){const s=t,u=y,g=b(()=>Object.entries(C).filter(([l,e])=>e.platformCompatibility?e.platformCompatibility.includes(s.platformType):!0).map(([l,e])=>({value:l,label:e.name,code:e.code,icon:e.icon}))),h=["Active","Inactive","Maintenance","Decommissioned"],I=["active","paused","stopped","error"],v=b(()=>!!s.instrument),o=k("phenocam"),r=k({}),m=k({display_name:"",description:"",status:"Active",measurement_status:"active"}),f=b(()=>Q(o.value)),x=b(()=>{const l=f.value;if(!(l!=null&&l.fields))return{};const e={};return Object.entries(l.fields).forEach(([i,n])=>{e[i]={type:n.type||"text",label:n.label,required:n.required||!1,placeholder:n.placeholder,options:n.options,min:n.min,max:n.max,step:n.step,unit:n.unit,defaultValue:n.defaultValue}}),e}),w=b(()=>{const l=W(o.value)||"XXX";return`${s.platformName}_${l}##`});z(()=>s.instrument,l=>{if(l){const e=Object.keys(C).find(i=>C[i].name===l.instrument_type||i===l.instrument_type.toLowerCase().replace(/\s+/g,""))||"phenocam";o.value=e,m.value={display_name:l.display_name||"",description:l.description||"",status:l.status||"Active",measurement_status:l.measurement_status||"active"},r.value=l.specifications||{}}},{immediate:!0}),z(o,(l,e)=>{if(l!==e&&!v.value){const i=C[l],n={};i!=null&&i.fields&&Object.entries(i.fields).forEach(([q,B])=>{B.defaultValue!==void 0&&(n[q]=B.defaultValue)}),r.value=n}});const F=b(()=>{if(!o.value)return!1;const l=f.value;if(!(l!=null&&l.fields))return!0;for(const[e,i]of Object.entries(l.fields))if(i.required){const n=r.value[e];if(n==null||n==="")return!1}return!0});function U(){if(!F.value)return;const l=f.value,e={platform_id:s.platformId,instrument_type:(l==null?void 0:l.name)||o.value,display_name:m.value.display_name||void 0,description:m.value.description||void 0,status:m.value.status,measurement_status:m.value.measurement_status,specifications:{...r.value}};Object.keys(e).forEach(i=>{(e[i]===void 0||e[i]==="")&&delete e[i]}),Object.keys(e.specifications).forEach(i=>{(e.specifications[i]===void 0||e.specifications[i]==="")&&delete e.specifications[i]}),u("submit",e)}function d(){u("cancel")}return(l,e)=>{var i;return c(),p("form",{onSubmit:Y(U,["prevent"]),class:"space-y-6"},[v.value?j("",!0):(c(),p("div",me,[e[6]||(e[6]=a("label",{class:"label"},[a("span",{class:"label-text font-medium"},"Instrument Type *")],-1)),a("div",fe,[(c(!0),p(O,null,N(g.value,n=>(c(),p("label",{key:n.value,class:$(["flex items-center gap-2 px-3 py-2 rounded-lg border cursor-pointer transition-colors text-sm",o.value===n.value?"border-primary bg-primary/10":"border-base-300 hover:border-primary/50"])},[T(a("input",{type:"radio","onUpdate:modelValue":e[0]||(e[0]=q=>o.value=q),value:n.value,class:"radio radio-primary radio-sm"},null,8,pe),[[X,o.value]]),a("span",null,V(n.icon),1),a("span",null,V(n.label),1)],2))),128))])])),a("div",ve,[e[7]||(e[7]=a("label",{class:"label"},[a("span",{class:"label-text font-medium"},"Instrument Name Preview")],-1)),a("div",be,V(w.value),1),e[8]||(e[8]=a("label",{class:"label"},[a("span",{class:"label-text-alt text-base-content/60"}," Auto-generated based on platform and instrument type ")],-1))]),a("div",ye,[a("div",ge,[e[9]||(e[9]=a("label",{class:"label"},[a("span",{class:"label-text font-medium"},"Status")],-1)),T(a("select",{"onUpdate:modelValue":e[1]||(e[1]=n=>m.value.status=n),class:"select select-bordered w-full"},[(c(),p(O,null,N(h,n=>a("option",{key:n,value:n},V(n),9,he)),64))],512),[[M,m.value.status]])]),a("div",xe,[e[10]||(e[10]=a("label",{class:"label"},[a("span",{class:"label-text font-medium"},"Measurement Status")],-1)),T(a("select",{"onUpdate:modelValue":e[2]||(e[2]=n=>m.value.measurement_status=n),class:"select select-bordered w-full"},[(c(),p(O,null,N(I,n=>a("option",{key:n,value:n},V(n),9,Ve)),64))],512),[[M,m.value.measurement_status]])])]),Object.keys(x.value).length>0?(c(),p("div",Ie,[a("label",ke,[a("span",we,V(((i=f.value)==null?void 0:i.name)||"Instrument")+" Specifications ",1)]),a("div",$e,[R(G(ce),{modelValue:r.value,"onUpdate:modelValue":e[3]||(e[3]=n=>r.value=n),schema:x.value,columns:2,size:"sm"},null,8,["modelValue","schema"])])])):(c(),p("div",qe,[...e[11]||(e[11]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),a("span",null,"No additional specifications required for this instrument type.",-1)])])),a("div",Se,[e[14]||(e[14]=a("input",{type:"checkbox"},null,-1)),e[15]||(e[15]=a("div",{class:"collapse-title font-medium"}," Optional Fields ",-1)),a("div",Oe,[a("div",Ne,[e[12]||(e[12]=a("label",{class:"label"},[a("span",{class:"label-text"},"Display Name")],-1)),T(a("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>m.value.display_name=n),type:"text",class:"input input-bordered",placeholder:"Human-readable name"},null,512),[[D,m.value.display_name]])]),a("div",Te,[e[13]||(e[13]=a("label",{class:"label"},[a("span",{class:"label-text"},"Description")],-1)),T(a("textarea",{"onUpdate:modelValue":e[5]||(e[5]=n=>m.value.description=n),class:"textarea textarea-bordered",rows:"2",placeholder:"Instrument description..."},null,512),[[D,m.value.description]])])])]),a("div",je,[a("button",{type:"button",class:"btn btn-ghost",onClick:d,disabled:t.loading}," Cancel ",8,Fe),a("button",{type:"submit",class:"btn btn-primary",disabled:!F.value||t.loading},[t.loading?(c(),p("span",Ce)):j("",!0),P(" "+V(v.value?"Update Instrument":"Create Instrument"),1)],8,Be)])],32)}}},Ae={__name:"InstrumentFormModal",props:{modelValue:{type:Boolean,default:!1},instrument:{type:Object,default:null},platformId:{type:Number,required:!0},platformName:{type:String,required:!0},platformType:{type:String,default:"fixed"}},emits:["update:modelValue","submit","cancel"],setup(t,{emit:y}){const s=t,u=y,g=k(!1),h=b(()=>!!s.instrument),I=b(()=>h.value?"Edit Instrument":"Create Instrument");async function v(m){g.value=!0;try{u("submit",m)}finally{g.value=!1}}function o(){u("update:modelValue",!1),u("cancel")}function r(){u("update:modelValue",!1)}return(m,f)=>(c(),E(L,{"model-value":t.modelValue,title:I.value,size:"lg","onUpdate:modelValue":f[0]||(f[0]=x=>m.$emit("update:modelValue",x)),onClose:r},{default:H(()=>[R(Ue,{instrument:t.instrument,"platform-id":t.platformId,"platform-name":t.platformName,"platform-type":t.platformType,loading:g.value,onSubmit:v,onCancel:o},null,8,["instrument","platform-id","platform-name","platform-type","loading"])]),_:1},8,["model-value","title"]))}},Pe=J("instruments",()=>{const t=k([]),y=k(null),s=k(!1),u=k(null),g=b(()=>t.value.length),h=b(()=>{const d={};return t.value.forEach(l=>{const e=l.instrument_type||"Unknown";d[e]||(d[e]=[]),d[e].push(l)}),d}),I=b(()=>t.value.filter(d=>d.status==="Active")),v=b(()=>t.value.filter(d=>d.measurement_status==="Operational"));async function o(d){s.value=!0,u.value=null;try{const l=await S.get(`/instruments/platform/${d}`);l.data?t.value=l.data||[]:l.success?t.value=l.data||[]:u.value=l.error||"Failed to fetch instruments"}catch(l){u.value=l.message}finally{s.value=!1}}async function r(d){s.value=!0,u.value=null;try{const l=await S.get(`/instruments/station/${d}`);l.data?t.value=l.data||[]:l.success?t.value=l.data||[]:u.value=l.error||"Failed to fetch instruments"}catch(l){u.value=l.message}finally{s.value=!1}}async function m(d){s.value=!0,u.value=null;try{const l=await S.get(`/instruments/${d}`),e=l.data||(l.success?l.data:null);return e?(y.value=e,e):(u.value=l.error||"Instrument not found",null)}catch(l){return u.value=l.message,null}finally{s.value=!1}}async function f(d){s.value=!0,u.value=null;try{const l=await S.post("/instruments",d),e=l.data||(l.success?l.data:null);return e?(t.value.push(e),e):(u.value=l.error||"Failed to create instrument",null)}catch(l){return u.value=l.message,null}finally{s.value=!1}}async function x(d,l){var e;s.value=!0,u.value=null;try{const i=await S.put(`/instruments/${d}`,l),n=i.data||(i.success?i.data:null);if(n){const q=t.value.findIndex(B=>B.id===d);return q!==-1&&(t.value[q]=n),((e=y.value)==null?void 0:e.id)===d&&(y.value=n),n}else return u.value=i.error||"Failed to update instrument",null}catch(i){return u.value=i.message,null}finally{s.value=!1}}async function w(d){var l;s.value=!0,u.value=null;try{const e=await S.delete(`/instruments/${d}`);return e.deleted||e.success?(t.value=t.value.filter(i=>i.id!==d),((l=y.value)==null?void 0:l.id)===d&&(y.value=null),!0):(u.value=e.error||"Failed to delete instrument",!1)}catch(e){return u.value=e.message,!1}finally{s.value=!1}}function F(){y.value=null}function U(){t.value=[],y.value=null}return{instruments:t,currentInstrument:y,loading:s,error:u,instrumentCount:g,instrumentsByType:h,activeInstruments:I,operationalInstruments:v,fetchInstrumentsByPlatform:o,fetchInstrumentsByStation:r,fetchInstrument:m,createInstrument:f,updateInstrument:x,deleteInstrument:w,clearCurrentInstrument:F,clearInstruments:U}});export{Ae as _,Pe as u};
