import{d as Se,r as M,c as O,m as Ie,M as $e,D as De,E as ie,e as h,o as f,f as e,G as me,k as L,n as Q,t as D,h as K,F as ye,i as _e,p as ke,N as Me,l as Y,w as he,g as ge,A as Le,B as fe,C as be,b as Ee,H as Ve,a as Pe}from"./vendor-oiqY8oHn.js";import{u as Ae,_ as Be}from"./instruments-CmG5Vv-E.js";import{u as Te,a as je,e as Ne,_ as Ce,f as ze}from"./platforms-CbTA9KXc.js";import{c as de,_ as Oe,u as Ue,b as Fe}from"./index-3p0rx6oH.js";import{_ as Ye,g as Xe,a as He}from"./BaseModal-BSvtwcmN.js";const Ge=Se("rois",()=>{const g=M([]),j=M(null),b=M(!1),r=M(null),_=M(!0),t=O(()=>g.value.length),A=O(()=>g.value.filter(n=>!n.is_legacy)),d=O(()=>g.value.filter(n=>n.is_legacy)),u=O(()=>A.value.length),E=O(()=>d.value.length),m=O(()=>{const n={};return g.value.forEach(v=>{const R=v.instrument_id;n[R]||(n[R]=[]),n[R].push(v)}),n});function w(n){if(!n)return n;if(n.points_json&&typeof n.points_json=="string")try{n.points=JSON.parse(n.points_json)}catch{n.points=[]}else n.points_json&&Array.isArray(n.points_json)?n.points=n.points_json:n.points||(n.points=[]);return n}async function z(n,v=!0){var R,$;b.value=!0,r.value=null;try{const S={instrument:n};v&&(S.include_legacy="true");const B=await de.get("/rois",S);B.rois?g.value=B.rois.map(w):(R=B.data)!=null&&R.rois?g.value=B.data.rois.map(w):B.success?g.value=((($=B.data)==null?void 0:$.rois)||[]).map(w):r.value=B.error||"Failed to fetch ROIs"}catch(S){r.value=S.message}finally{b.value=!1}}async function F(n){var v,R;b.value=!0,r.value=null;try{const $=await de.get("/rois",{station:n});$.rois?g.value=$.rois.map(w):(v=$.data)!=null&&v.rois?g.value=$.data.rois.map(w):$.success?g.value=(((R=$.data)==null?void 0:R.rois)||[]).map(w):r.value=$.error||"Failed to fetch ROIs"}catch($){r.value=$.message}finally{b.value=!1}}async function J(n){b.value=!0,r.value=null;try{const v=await de.get(`/rois/${n}`),R=v.id?v:v.data||(v.success?v.data:null);return R?(j.value=w(R),j.value):(r.value=v.error||"ROI not found",null)}catch(v){return r.value=v.message,null}finally{b.value=!1}}async function Z(n){b.value=!0,r.value=null;try{const v={...n};v.points&&Array.isArray(v.points)&&(v.points_json=JSON.stringify(v.points),delete v.points);const R=await de.post("/rois",v),$=R.id?R:R.data||(R.success?R.data:null);return $?(n.instrument_id&&await z(n.instrument_id),$):(r.value=R.error||"Failed to create ROI",null)}catch(v){return r.value=v.message,null}finally{b.value=!1}}async function V(n,v){var R;b.value=!0,r.value=null;try{const $={...v};$.points&&Array.isArray($.points)&&($.points_json=JSON.stringify($.points),delete $.points);const S=await de.put(`/rois/${n}`,$),B=S.id?S:S.data||(S.success?S.data:null);if(B||S.success){const G=g.value.findIndex(le=>le.id===n);return G!==-1&&(g.value[G]=w({...g.value[G],...v})),((R=j.value)==null?void 0:R.id)===n&&(j.value=w({...j.value,...v})),B||S.data}else return r.value=S.error||"Failed to update ROI",null}catch($){return r.value=$.message,null}finally{b.value=!1}}async function k(n){var v;b.value=!0,r.value=null;try{const R=await de.delete(`/rois/${n}`);return R.deleted||R.success?(g.value=g.value.filter($=>$.id!==n),((v=j.value)==null?void 0:v.id)===n&&(j.value=null),!0):(r.value=R.error||"Failed to delete ROI",!1)}catch(R){return r.value=R.message,!1}finally{b.value=!1}}function U(){j.value=null}function W(){g.value=[],j.value=null}async function N(n){try{const v=await de.get(`/rois/${n}/edit-mode`),R=v.can_direct_edit!==void 0?v:v.data||(v.success?v.data:null);return R||(r.value=v.error||"Failed to get edit mode",null)}catch(v){return r.value=v.message,null}}async function H(n,v,R="Replaced by new ROI"){var $;b.value=!0,r.value=null;try{const S=await de.post(`/rois/${n}/legacy`,{reason:R,replacement_data:v}),B=S.legacy_roi||S.new_roi?S:S.data||(S.success?S.data:null);if(B){const G=($=g.value.find(le=>le.id===n))==null?void 0:$.instrument_id;return G&&await z(G),B}return r.value=S.error||"Failed to mark ROI as legacy",null}catch(S){return r.value=S.message,null}finally{b.value=!1}}async function I(n,v){var R;b.value=!0,r.value=null;try{const $={...v};$.points&&Array.isArray($.points)&&($.points_json=JSON.stringify($.points),delete $.points);const S=await de.put(`/rois/${n}/override`,$),B=S.id?S:S.data||(S.success?S.data:null);if(B||S.success){const G=g.value.findIndex(le=>le.id===n);return G!==-1&&(g.value[G]={...g.value[G],...v,timeseries_broken:!0}),((R=j.value)==null?void 0:R.id)===n&&(j.value={...j.value,...v,timeseries_broken:!0}),B||S.data}return r.value=S.error||"Failed to update ROI",null}catch($){return r.value=$.message,null}finally{b.value=!1}}function p(n){_.value=n}return{rois:g,currentROI:j,loading:b,error:r,includeLegacy:_,roiCount:t,roisByInstrument:m,activeRois:A,legacyRois:d,activeRoiCount:u,legacyRoiCount:E,fetchROIsByInstrument:z,fetchROIsByStation:F,fetchROI:J,createROI:Z,updateROI:V,deleteROI:k,clearCurrentROI:U,clearROIs:W,getROIEditMode:N,markAsLegacyAndReplace:H,adminOverrideUpdate:I,setIncludeLegacy:p}}),We={class:"absolute top-2 right-2 flex gap-1"},qe=["title"],Je={class:"text-xs"},Ke={class:"absolute bottom-2 left-2 flex gap-1"},Qe={class:"badge badge-xs sm:badge-sm badge-neutral whitespace-nowrap"},Ze={key:0,class:"badge badge-xs sm:badge-sm badge-warning badge-outline whitespace-nowrap"},et={__name:"ROIViewer",props:{imageUrl:{type:String,default:""},rois:{type:Array,default:()=>[]},selectedRoiId:{type:[Number,String],default:null},showLabels:{type:Boolean,default:!0},height:{type:[Number,String],default:400},showLegacyToggle:{type:Boolean,default:!0},initialShowLegacy:{type:Boolean,default:!1}},emits:["roi-click","roi-hover","toggle-legacy"],setup(g,{expose:j,emit:b}){const r=g,_=b,t=M(null),A=M(null),d=M(!1),u=M(!1),E=M(null),m=M(r.initialShowLegacy),w=O(()=>r.rois.some(a=>a.is_legacy)),z=O(()=>m.value?r.rois:r.rois.filter(a=>!a.is_legacy)),F=O(()=>r.rois.filter(a=>a.is_legacy).length),J=O(()=>r.rois.filter(a=>!a.is_legacy).length);function Z(){m.value=!m.value,_("toggle-legacy",m.value),B()}let V=null;const k=M(1),U=M(0),W=M(0);let N=!1,H=0,I=0;const p=O(()=>typeof r.height=="number"?r.height:parseInt(r.height)||400);function n(a,i=1){const C=a.color_r??255,o=a.color_g??0,l=a.color_b??0;return`rgba(${C}, ${o}, ${l}, ${i})`}function v(a,i){return{x:a*k.value+U.value,y:i*k.value+W.value}}function R(a,i){return{x:(a-U.value)/k.value,y:(i-W.value)/k.value}}function $(a,i,C){if(!C||C.length<3)return!1;let o=!1;for(let l=0,y=C.length-1;l<C.length;y=l++){const c=C[l].x,s=C[l].y,x=C[y].x,P=C[y].y;s>i!=P>i&&a<(x-c)*(i-s)/(P-s)+c&&(o=!o)}return o}function S(a,i){const C=R(a,i);for(const o of z.value)if(o.points&&$(C.x,C.y,o.points))return o;return null}function B(){const a=A.value;if(!a)return;const i=a.getContext("2d"),C=a.width,o=a.height;i.clearRect(0,0,C,o),i.fillStyle="#1a1a2e",i.fillRect(0,0,C,o),V&&d.value?(i.save(),i.translate(U.value,W.value),i.scale(k.value,k.value),i.drawImage(V,0,0),i.restore()):r.imageUrl?u.value?(i.fillStyle="#ff6b6b",i.font="16px sans-serif",i.textAlign="center",i.fillText("Failed to load image",C/2,o/2)):(i.fillStyle="#888",i.font="16px sans-serif",i.textAlign="center",i.fillText("Loading image...",C/2,o/2)):(i.fillStyle="#4a4a6a",i.font="16px sans-serif",i.textAlign="center",i.fillText("No image available",C/2,o/2)),z.value.forEach(l=>{if(!l.points||l.points.length<3)return;const y=l.id===r.selectedRoiId,c=l.id===E.value,s=l.is_legacy,x=l.alpha??.3,P=s?x*.5:x;i.beginPath();const T=v(l.points[0].x,l.points[0].y);i.moveTo(T.x,T.y);for(let te=1;te<l.points.length;te++){const se=v(l.points[te].x,l.points[te].y);i.lineTo(se.x,se.y)}i.closePath();const ee=y?P+.2:c?P+.1:P;i.fillStyle=n(l,ee),i.fill(),i.lineWidth=y?3:c?2:l.thickness??2;const ne=s?.6:1;if(i.strokeStyle=n(l,ne),s&&i.setLineDash([4,4]),i.stroke(),i.setLineDash([]),r.showLabels&&l.roi_name){let te=0,se=0;l.points.forEach(Re=>{te+=Re.x,se+=Re.y}),te/=l.points.length,se/=l.points.length;const oe=v(te,se);i.font=s?"11px sans-serif":"bold 12px sans-serif";const xe=s?`${l.roi_name} (legacy)`:l.roi_name,we=i.measureText(xe),X=4;i.fillStyle=s?"rgba(0, 0, 0, 0.5)":"rgba(0, 0, 0, 0.7)",i.fillRect(oe.x-we.width/2-X,oe.y-8-X,we.width+X*2,16+X),i.fillStyle=s?"rgba(255, 255, 255, 0.7)":"#fff",i.textAlign="center",i.textBaseline="middle",i.fillText(xe,oe.x,oe.y)}})}function G(){if(!V||!A.value)return;const a=A.value,i=a.width/V.width,C=a.height/V.height;k.value=Math.min(i,C)*.95,U.value=(a.width-V.width*k.value)/2,W.value=(a.height-V.height*k.value)/2,B()}function le(a){a.preventDefault();const C=A.value.getBoundingClientRect(),o=a.clientX-C.left,l=a.clientY-C.top,y=a.deltaY>0?.9:1.1,c=Math.max(.1,Math.min(5,k.value*y)),s=R(o,l);k.value=c,U.value=o-s.x*c,W.value=l-s.y*c,B()}function pe(a){N=!0,H=a.clientX,I=a.clientY}function ve(a){const i=A.value,C=i.getBoundingClientRect(),o=a.clientX-C.left,l=a.clientY-C.top;if(N){const y=a.clientX-H,c=a.clientY-I;U.value+=y,W.value+=c,H=a.clientX,I=a.clientY,B()}else{const y=S(o,l),c=(y==null?void 0:y.id)||null;c!==E.value&&(E.value=c,_("roi-hover",y),B()),i.style.cursor=y?"pointer":N?"grabbing":"grab"}}function re(){N=!1}function ue(a){const C=A.value.getBoundingClientRect(),o=a.clientX-C.left,l=a.clientY-C.top,y=S(o,l);y&&_("roi-click",y)}function ae(){const a=A.value,i=t.value;!a||!i||(a.width=i.clientWidth,a.height=p.value,d.value?G():B())}function ce(){if(!r.imageUrl){d.value=!1,u.value=!1,B();return}V=new Image,V.crossOrigin="anonymous",V.onload=()=>{d.value=!0,u.value=!1,G()},V.onerror=()=>{d.value=!1,u.value=!0,B()},V.src=r.imageUrl}return Ie(()=>{$e(()=>{ae(),ce()}),window.addEventListener("resize",ae),window.addEventListener("mouseup",re)}),De(()=>{window.removeEventListener("resize",ae),window.removeEventListener("mouseup",re)}),ie(()=>r.imageUrl,ce),ie(()=>r.rois,B,{deep:!0}),ie(()=>r.selectedRoiId,B),ie(()=>r.showLabels,B),j({fitToCanvas:G,draw:B}),(a,i)=>(f(),h("div",{ref_key:"containerRef",ref:t,class:"roi-viewer-container relative w-full bg-base-300 rounded-lg overflow-hidden"},[e("canvas",{ref_key:"canvasRef",ref:A,style:me({height:`${p.value}px`}),class:"w-full cursor-grab",onWheel:le,onMousedown:pe,onMousemove:ve,onClick:ue},null,36),e("div",We,[g.showLegacyToggle&&w.value?(f(),h("button",{key:0,class:Q(["btn btn-sm btn-ghost bg-base-100/80 hover:bg-base-100 gap-1",{"btn-active":m.value}]),title:m.value?"Hide legacy ROIs":"Show legacy ROIs",onClick:Z},[i[0]||(i[0]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",Je,D(F.value),1)],10,qe)):L("",!0),e("button",{class:"btn btn-sm btn-square btn-ghost bg-base-100/80 hover:bg-base-100",title:"Fit to view",onClick:G},[...i[1]||(i[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})],-1)])])]),e("div",Ke,[e("div",Qe,[K(D(J.value)+" ",1),i[2]||(i[2]=e("span",{class:"hidden sm:inline"},"active",-1))]),m.value&&F.value>0?(f(),h("div",Ze,[K(D(F.value)+" ",1),i[3]||(i[3]=e("span",{class:"hidden sm:inline"},"legacy",-1))])):L("",!0)])],512))}},tt=Oe(et,[["__scopeId","data-v-69b555b8"]]),lt={class:"flex-1 min-w-0"},nt={class:"flex items-center gap-2"},st={key:0,class:"badge badge-xs badge-warning gap-1"},at={key:1,class:"badge badge-xs badge-error gap-1",title:"Time series data may be inconsistent"},ot={key:0,class:"text-xs text-base-content/60"},it={key:0,class:"badge badge-xs badge-ghost ml-1"},rt={key:1,class:"ml-1"},ut={key:0,class:"flex gap-1 flex-shrink-0"},ct={key:1,class:"flex-shrink-0"},dt={__name:"ROICard",props:{roi:{type:Object,required:!0},selected:{type:Boolean,default:!1},canEdit:{type:Boolean,default:!1},compact:{type:Boolean,default:!1},isLegacy:{type:Boolean,default:!1}},emits:["select","edit","delete"],setup(g,{emit:j}){const b=g,r=j,_=O(()=>{const m=b.roi.color_r??255,w=b.roi.color_g??0,z=b.roi.color_b??0,F=b.isLegacy?.5:1;return{backgroundColor:`rgba(${m}, ${w}, ${z}, ${F})`}}),t=O(()=>{const m="roi-card flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-all border";return b.isLegacy?[m,"border-base-300 opacity-60",b.selected?"bg-base-200 border-base-content/30":"bg-base-100/50 hover:bg-base-200/50"]:[m,"border-base-300 hover:border-primary/50",b.selected?"bg-primary/10 border-primary":"bg-base-100 hover:bg-base-200"]}),A=O(()=>{const m=b.roi.points||b.roi.points_json;if(Array.isArray(m))return m.length;if(typeof m=="string")try{return JSON.parse(m).length}catch{return 0}return 0});function d(){r("select",b.roi)}function u(m){m.stopPropagation(),r("edit",b.roi)}function E(m){m.stopPropagation(),r("delete",b.roi)}return(m,w)=>(f(),h("div",{class:Q(t.value),onClick:d},[e("div",{class:"w-4 h-4 rounded flex-shrink-0 border border-base-300",style:me(_.value)},null,4),e("div",lt,[e("div",nt,[e("span",{class:Q(["font-medium truncate",{"line-through":g.isLegacy}])},D(g.roi.roi_name),3),g.isLegacy?(f(),h("span",st,[...w[0]||(w[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),K(" Legacy ",-1)])])):L("",!0),g.roi.timeseries_broken?(f(),h("span",at,[...w[1]||(w[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)])])):L("",!0)]),g.compact?L("",!0):(f(),h("div",ot,[K(D(A.value)+" points ",1),g.roi.auto_generated?(f(),h("span",it,"auto")):L("",!0),g.isLegacy&&g.roi.legacy_date?(f(),h("span",rt," ("+D(new Date(g.roi.legacy_date).toLocaleDateString())+") ",1)):L("",!0)]))]),g.canEdit&&!g.isLegacy?(f(),h("div",ut,[e("button",{class:"btn btn-ghost btn-xs btn-square",title:"Edit ROI",onClick:u},[...w[2]||(w[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])]),e("button",{class:"btn btn-ghost btn-xs btn-square text-error",title:"Delete ROI",onClick:E},[...w[3]||(w[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])])])):L("",!0),g.isLegacy?(f(),h("div",ct,[...w[4]||(w[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 text-base-content/40",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})],-1)])])):L("",!0)],2))}},vt={class:"roi-list"},gt={class:"flex items-center justify-between mb-3"},ft={class:"flex items-center gap-2"},mt={class:"badge badge-sm"},pt={key:0,class:"tabs tabs-boxed mb-3 bg-base-200"},bt={class:"badge badge-sm ml-1"},ht={class:"badge badge-sm badge-ghost ml-1"},yt={key:1,class:"flex justify-center py-8"},xt={key:2,class:"text-center py-8 text-base-content/60"},wt={key:0,class:"text-sm mt-1"},kt={key:4,class:"mt-3"},_t={__name:"ROIList",props:{rois:{type:Array,default:()=>[]},selectedId:{type:[Number,String],default:null},canEdit:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},compact:{type:Boolean,default:!1},maxHeight:{type:[Number,String],default:null},showLegacyTabs:{type:Boolean,default:!0}},emits:["select","edit","delete","create"],setup(g,{emit:j}){const b=g,r=j,_=M("active"),t=O(()=>b.rois.filter(V=>!V.is_legacy)),A=O(()=>b.rois.filter(V=>V.is_legacy)),d=O(()=>A.value.length>0),u=O(()=>b.showLegacyTabs&&d.value),E=O(()=>[...u.value?_.value==="legacy"?A.value:t.value:b.rois].sort((k,U)=>(k.roi_name||"").localeCompare(U.roi_name||"",void 0,{numeric:!0}))),m=O(()=>u.value?_.value==="legacy"?A.value.length:t.value.length:b.rois.length),w=O(()=>b.maxHeight?{maxHeight:typeof b.maxHeight=="number"?`${b.maxHeight}px`:b.maxHeight,overflowY:"auto"}:{});function z(V){r("select",V)}function F(V){r("edit",V)}function J(V){r("delete",V)}function Z(){r("create")}return(V,k)=>(f(),h("div",vt,[e("div",gt,[e("div",ft,[k[2]||(k[2]=e("span",{class:"font-medium"},"ROIs",-1)),e("span",mt,D(g.rois.length),1)]),g.canEdit&&_.value==="active"?(f(),h("button",{key:0,class:"btn btn-primary btn-sm",onClick:Z},[...k[3]||(k[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),K(" Add ROI ",-1)])])):L("",!0)]),u.value?(f(),h("div",pt,[e("button",{class:Q(["tab",{"tab-active":_.value==="active"}]),onClick:k[0]||(k[0]=U=>_.value="active")},[k[4]||(k[4]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),k[5]||(k[5]=K(" Active ",-1)),e("span",bt,D(t.value.length),1)],2),e("button",{class:Q(["tab",{"tab-active":_.value==="legacy"}]),onClick:k[1]||(k[1]=U=>_.value="legacy")},[k[6]||(k[6]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),k[7]||(k[7]=K(" Legacy ",-1)),e("span",ht,D(A.value.length),1)],2)])):L("",!0),g.loading?(f(),h("div",yt,[...k[8]||(k[8]=[e("span",{class:"loading loading-spinner loading-md"},null,-1)])])):m.value===0?(f(),h("div",xt,[k[12]||(k[12]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 mx-auto mb-3 opacity-50",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),_.value==="legacy"?(f(),h(ye,{key:0},[k[9]||(k[9]=e("p",null,"No legacy ROIs",-1)),k[10]||(k[10]=e("p",{class:"text-sm mt-1"},"Legacy ROIs are preserved for historical data integrity",-1))],64)):(f(),h(ye,{key:1},[k[11]||(k[11]=e("p",null,"No ROIs defined",-1)),g.canEdit?(f(),h("p",wt,'Click "Add ROI" to create one')):L("",!0)],64))])):(f(),h("div",{key:3,class:"space-y-2",style:me(w.value)},[(f(!0),h(ye,null,_e(E.value,U=>(f(),ke(dt,{key:U.id,roi:U,selected:U.id===g.selectedId,"can-edit":g.canEdit&&!U.is_legacy,compact:g.compact,"is-legacy":U.is_legacy,onSelect:z,onEdit:F,onDelete:J},null,8,["roi","selected","can-edit","compact","is-legacy"]))),128))],4)),u.value&&_.value==="legacy"&&A.value.length>0?(f(),h("div",kt,[...k[13]||(k[13]=[e("div",{class:"alert alert-info py-2"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"stroke-current shrink-0 h-5 w-5",fill:"none",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("span",{class:"text-sm"}," Legacy ROIs are preserved for L2/L3 historical product consistency. They cannot be edited or deleted. ")],-1)])])):L("",!0)]))}},q={IDLE:"idle",DRAWING:"drawing",EDITING:"editing"};function It(g={}){const{minPoints:j=3,vertexRadius:b=8,snapDistance:r=10}=g,_=M(q.IDLE),t=M([]),A=M({x:0,y:0}),d=M(-1),u=M(-1),E=M(!1),m=Me({r:255,g:100,b:100}),w=M(2),z=M(.3),F=O(()=>t.value.length>=j),J=O(()=>_.value===q.DRAWING),Z=O(()=>_.value===q.EDITING),V=O(()=>_.value!==q.IDLE);function k(a,i){const C=i.x-a.x,o=i.y-a.y;return Math.sqrt(C*C+o*o)}function U(){_.value=q.DRAWING,t.value=[],d.value=-1,u.value=-1,E.value=!1}function W(a){return!a||a.length<j?(console.warn("Cannot edit polygon with fewer than",j,"points"),!1):(_.value=q.EDITING,t.value=a.map(i=>({x:i.x,y:i.y})),d.value=-1,u.value=-1,!0)}function N(a,i){_.value===q.DRAWING&&t.value.push({x:a,y:i})}function H(){t.value.length>0&&t.value.pop()}function I(){return F.value?(_.value=q.IDLE,!0):!1}function p(){_.value=q.IDLE,t.value=[],d.value=-1,u.value=-1,E.value=!1}function n(){return _.value!==q.EDITING||!F.value?null:(_.value=q.IDLE,[...t.value])}function v(a,i,C){for(let o=0;o<t.value.length;o++){const l=C(t.value[o].x,t.value[o].y);if(k({x:a,y:i},l)<=b)return o}return-1}function R(a,i,C,o,l){if(A.value={x:a,y:i},_.value===q.DRAWING&&t.value.length>0){const y=l(t.value[0].x,t.value[0].y);E.value=k({x:C,y:o},y)<=r}u.value>=0?t.value[u.value]={x:a,y:i}:_.value===q.EDITING&&(d.value=v(C,o,l))}function $(a,i){return _.value!==q.DRAWING?!1:E.value&&F.value?I():(N(a,i),!1)}function S(){return _.value!==q.DRAWING?!1:(t.value.length>j&&H(),I())}function B(a){_.value===q.EDITING&&(a<0||a>=t.value.length||(u.value=a))}function G(){u.value=-1}function le(a,i,C){a<0||a>=t.value.length||(t.value[a]={x:i,y:C})}function pe(a){return t.value.length<=j||a<0||a>=t.value.length?!1:(t.value.splice(a,1),d.value=-1,!0)}function ve(a,i,C){a<0||a>=t.value.length||t.value.splice(a+1,0,{x:i,y:C})}function re(a,i,C){m.r=Math.max(0,Math.min(255,a)),m.g=Math.max(0,Math.min(255,i)),m.b=Math.max(0,Math.min(255,C))}function ue(){return{points:[...t.value],color_r:m.r,color_g:m.g,color_b:m.b,thickness:w.value,alpha:z.value}}function ae(a){a.points&&Array.isArray(a.points)&&W(a.points),a.color_r!==void 0&&(m.r=a.color_r),a.color_g!==void 0&&(m.g=a.color_g),a.color_b!==void 0&&(m.b=a.color_b),a.thickness!==void 0&&(w.value=a.thickness),a.alpha!==void 0&&(z.value=a.alpha)}function ce(){_.value=q.IDLE,t.value=[],A.value={x:0,y:0},d.value=-1,u.value=-1,E.value=!1}return{DRAWING_MODES:q,vertexRadius:b,snapDistance:r,minPoints:j,mode:_,points:t,cursorPosition:A,hoveredVertexIndex:d,draggingVertexIndex:u,isNearFirstVertex:E,color:m,thickness:w,alpha:z,isValidPolygon:F,isDrawing:J,isEditing:Z,isActive:V,startDrawing:U,startEditing:W,addPoint:N,removeLastPoint:H,closePolygon:I,cancel:p,finishEditing:n,findVertexAtPosition:v,handleMouseMove:R,handleClick:$,handleDoubleClick:S,startDragVertex:B,stopDragVertex:G,moveVertex:le,deleteVertex:pe,insertVertex:ve,setColor:re,getPolygonData:ue,loadPolygonData:ae,reset:ce}}const Rt={key:1,class:"absolute bottom-2 left-2 badge badge-neutral"},Ct={key:2,class:"absolute bottom-2 right-2 flex gap-2"},$t=["disabled"],Dt={__name:"ROIDrawingCanvas",props:{imageUrl:{type:String,default:""},existingRois:{type:Array,default:()=>[]},editingRoi:{type:Object,default:null},disabled:{type:Boolean,default:!1},height:{type:[Number,String],default:400},defaultColor:{type:Object,default:()=>({r:255,g:100,b:100})}},emits:["points-change","drawing-complete","drawing-cancel","roi-click"],setup(g,{expose:j,emit:b}){const r=g,_=b,t=It(),A=M(null),d=M(null),u=M(!1),E=M(!1);let m=null;const w=M(1),z=M(0),F=M(0);let J=!1,Z=0,V=0;const k=O(()=>typeof r.height=="number"?r.height:parseInt(r.height)||400),U=O(()=>r.disabled?"not-allowed":t.isDrawing.value?"crosshair":t.draggingVertexIndex.value>=0?"grabbing":t.hoveredVertexIndex.value>=0?"grab":t.isEditing.value?"default":"crosshair");function W(o,l=1){const y=o.color_r??255,c=o.color_g??0,s=o.color_b??0;return`rgba(${y}, ${c}, ${s}, ${l})`}function N(o,l){return{x:o*w.value+z.value,y:l*w.value+F.value}}function H(o,l){return{x:(o-z.value)/w.value,y:(l-F.value)/w.value}}function I(o,l,y){if(!y||y.length<3)return!1;let c=!1;for(let s=0,x=y.length-1;s<y.length;x=s++){const P=y[s].x,T=y[s].y,ee=y[x].x,ne=y[x].y;T>l!=ne>l&&o<(ee-P)*(l-T)/(ne-T)+P&&(c=!c)}return c}function p(o,l){const y=H(o,l);for(const c of r.existingRois)if(c.points&&I(y.x,y.y,c.points))return c;return null}function n(){const o=d.value;if(!o)return;const l=o.getContext("2d"),y=o.width,c=o.height;l.clearRect(0,0,y,c),l.fillStyle="#1a1a2e",l.fillRect(0,0,y,c),m&&u.value?(l.save(),l.translate(z.value,F.value),l.scale(w.value,w.value),l.drawImage(m,0,0),l.restore()):r.imageUrl?E.value?(l.fillStyle="#ff6b6b",l.font="16px sans-serif",l.textAlign="center",l.fillText("Failed to load image",y/2,c/2)):(l.fillStyle="#888",l.font="16px sans-serif",l.textAlign="center",l.fillText("Loading image...",y/2,c/2)):(l.fillStyle="#4a4a6a",l.font="16px sans-serif",l.textAlign="center",l.fillText("No image available",y/2,c/2)),r.existingRois.forEach(x=>{if(!x.points||x.points.length<3)return;l.beginPath();const P=N(x.points[0].x,x.points[0].y);l.moveTo(P.x,P.y);for(let T=1;T<x.points.length;T++){const ee=N(x.points[T].x,x.points[T].y);l.lineTo(ee.x,ee.y)}if(l.closePath(),l.fillStyle=W(x,.15),l.fill(),l.lineWidth=x.thickness??2,l.strokeStyle=W(x,.5),l.setLineDash([4,4]),l.stroke(),l.setLineDash([]),x.roi_name){const T=x.points;let ee=0,ne=0;T.forEach(se=>{ee+=se.x,ne+=se.y}),ee/=T.length,ne/=T.length;const te=N(ee,ne);l.font="11px sans-serif",l.fillStyle="rgba(255, 255, 255, 0.6)",l.textAlign="center",l.textBaseline="middle",l.fillText(x.roi_name,te.x,te.y)}});const s=t.points.value;if(s.length>0){l.beginPath();const x=N(s[0].x,s[0].y);l.moveTo(x.x,x.y);for(let P=1;P<s.length;P++){const T=N(s[P].x,s[P].y);l.lineTo(T.x,T.y)}if(t.isEditing.value&&s.length>=3&&(l.closePath(),l.fillStyle=`rgba(${t.color.r}, ${t.color.g}, ${t.color.b}, ${t.alpha.value})`,l.fill()),l.lineWidth=t.thickness.value,l.strokeStyle=`rgba(${t.color.r}, ${t.color.g}, ${t.color.b}, 1)`,l.stroke(),t.isDrawing.value&&s.length>0){const P=N(s[s.length-1].x,s[s.length-1].y),T=N(t.cursorPosition.value.x,t.cursorPosition.value.y);l.beginPath(),l.moveTo(P.x,P.y),l.lineTo(T.x,T.y),l.setLineDash([5,5]),l.stroke(),l.setLineDash([]),t.isNearFirstVertex.value&&(l.beginPath(),l.moveTo(T.x,T.y),l.lineTo(x.x,x.y),l.strokeStyle=`rgba(${t.color.r}, ${t.color.g}, ${t.color.b}, 0.5)`,l.setLineDash([3,3]),l.stroke(),l.setLineDash([]))}s.forEach((P,T)=>{const ee=N(P.x,P.y),ne=T===t.hoveredVertexIndex.value,te=T===t.draggingVertexIndex.value,oe=T===0&&t.isDrawing.value&&t.isNearFirstVertex.value;l.beginPath(),l.arc(ee.x,ee.y,oe?t.vertexRadius*1.5:t.vertexRadius,0,Math.PI*2),te||oe?l.fillStyle=`rgba(${t.color.r}, ${t.color.g}, ${t.color.b}, 1)`:ne?l.fillStyle=`rgba(${t.color.r}, ${t.color.g}, ${t.color.b}, 0.8)`:l.fillStyle="white",l.fill(),l.lineWidth=2,l.strokeStyle=`rgba(${t.color.r}, ${t.color.g}, ${t.color.b}, 1)`,l.stroke()})}if(t.isDrawing.value){l.fillStyle="rgba(0, 0, 0, 0.7)",l.fillRect(10,c-30,300,20),l.font="12px sans-serif",l.fillStyle="white",l.textAlign="left";let x="Click to add points";s.length>=3&&(t.isNearFirstVertex.value?x="Click to close polygon":x="Double-click or click first point to close"),l.fillText(x+" | Right-click: undo | Esc: cancel",15,c-16)}else t.isEditing.value&&(l.fillStyle="rgba(0, 0, 0, 0.7)",l.fillRect(10,c-30,250,20),l.font="12px sans-serif",l.fillStyle="white",l.textAlign="left",l.fillText("Drag vertices to edit | Esc: cancel",15,c-16))}function v(){if(!m||!d.value)return;const o=d.value,l=o.width/m.width,y=o.height/m.height;w.value=Math.min(l,y)*.95,z.value=(o.width-m.width*w.value)/2,F.value=(o.height-m.height*w.value)/2,n()}function R(o){o.preventDefault();const y=d.value.getBoundingClientRect(),c=o.clientX-y.left,s=o.clientY-y.top,x=o.deltaY>0?.9:1.1,P=Math.max(.1,Math.min(5,w.value*x)),T=H(c,s);w.value=P,z.value=c-T.x*P,F.value=s-T.y*P,n()}function $(o){if(r.disabled)return;const y=d.value.getBoundingClientRect(),c=o.clientX-y.left,s=o.clientY-y.top;if(t.isEditing.value&&o.button===0){const x=t.findVertexAtPosition(c,s,N);if(x>=0){t.startDragVertex(x);return}}(o.button===1||!t.isActive.value&&o.button===0)&&(J=!0,Z=o.clientX,V=o.clientY)}function S(o){const y=d.value.getBoundingClientRect(),c=o.clientX-y.left,s=o.clientY-y.top,x=H(c,s);if(J){const P=o.clientX-Z,T=o.clientY-V;z.value+=P,F.value+=T,Z=o.clientX,V=o.clientY,n()}else t.isActive.value&&(t.handleMouseMove(x.x,x.y,c,s,N),n())}function B(){J=!1,t.draggingVertexIndex.value>=0&&(t.stopDragVertex(),_("points-change",[...t.points.value]))}function G(o){if(r.disabled||o.button!==0)return;const y=d.value.getBoundingClientRect(),c=o.clientX-y.left,s=o.clientY-y.top,x=H(c,s);if(!t.isActive.value){const P=p(c,s);if(P){_("roi-click",P);return}re()}t.isDrawing.value&&(t.handleClick(x.x,x.y)?_("drawing-complete",t.getPolygonData()):_("points-change",[...t.points.value]),n())}function le(o){if(r.disabled||!t.isDrawing.value)return;o.preventDefault(),t.handleDoubleClick()&&_("drawing-complete",t.getPolygonData()),n()}function pe(o){o.preventDefault(),!r.disabled&&t.isDrawing.value&&(t.removeLastPoint(),_("points-change",[...t.points.value]),n())}function ve(o){o.key==="Escape"&&t.isActive.value&&ae()}function re(){t.startDrawing(),t.setColor(r.defaultColor.r,r.defaultColor.g,r.defaultColor.b),n()}function ue(o){t.loadPolygonData(o),n()}function ae(){t.cancel(),_("drawing-cancel"),n()}function ce(){if(!t.isValidPolygon.value)return null;const o=t.getPolygonData();return t.reset(),n(),o}function a(o,l,y){t.setColor(o,l,y),n()}function i(){const o=d.value,l=A.value;!o||!l||(o.width=l.clientWidth,o.height=k.value,u.value?v():n())}function C(){if(!r.imageUrl){u.value=!1,E.value=!1,n();return}m=new Image,m.crossOrigin="anonymous",m.onload=()=>{u.value=!0,E.value=!1,v()},m.onerror=()=>{u.value=!1,E.value=!0,n()},m.src=r.imageUrl}return Ie(()=>{$e(()=>{i(),C(),r.editingRoi&&ue(r.editingRoi)}),window.addEventListener("resize",i),window.addEventListener("mouseup",B),window.addEventListener("keydown",ve)}),De(()=>{window.removeEventListener("resize",i),window.removeEventListener("mouseup",B),window.removeEventListener("keydown",ve)}),ie(()=>r.imageUrl,C),ie(()=>r.existingRois,n,{deep:!0}),ie(()=>r.editingRoi,o=>{o&&ue(o)},{deep:!0}),j({fitToCanvas:v,draw:n,startDrawing:re,startEditing:ue,cancelDrawing:ae,confirmEditing:ce,setColor:a,isDrawing:t.isDrawing,isEditing:t.isEditing,isActive:t.isActive,isValidPolygon:t.isValidPolygon,points:t.points}),(o,l)=>(f(),h("div",{ref_key:"containerRef",ref:A,class:"roi-drawing-container relative w-full bg-base-300 rounded-lg overflow-hidden"},[e("canvas",{ref_key:"canvasRef",ref:d,style:me({height:`${k.value}px`,cursor:U.value}),class:"w-full",onWheel:R,onMousedown:$,onMousemove:S,onClick:G,onDblclick:le,onContextmenu:pe},null,36),e("div",{class:"absolute top-2 right-2 flex gap-1"},[e("button",{class:"btn btn-sm btn-square btn-ghost bg-base-100/80 hover:bg-base-100",title:"Fit to view",onClick:v},[...l[1]||(l[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})],-1)])])]),Y(t).isActive.value?(f(),h("div",{key:0,class:Q(["absolute top-2 left-2 badge",Y(t).isDrawing.value?"badge-primary":"badge-secondary"])},D(Y(t).isDrawing.value?"Drawing":"Editing"),3)):L("",!0),Y(t).points.value.length>0?(f(),h("div",Rt,D(Y(t).points.value.length)+" point"+D(Y(t).points.value.length!==1?"s":""),1)):L("",!0),Y(t).isActive.value?(f(),h("div",Ct,[e("button",{class:"btn btn-sm btn-ghost bg-base-100/80",onClick:ae}," Cancel "),Y(t).isEditing.value||Y(t).isValidPolygon.value?(f(),h("button",{key:0,class:"btn btn-sm btn-primary",disabled:!Y(t).isValidPolygon.value,onClick:l[0]||(l[0]=()=>{Y(t).isDrawing.value?(Y(t).closePolygon(),_("drawing-complete",Y(t).getPolygonData())):_("drawing-complete",ce())})}," Confirm ",8,$t)):L("",!0)])):L("",!0)],512))}},Ot=Oe(Dt,[["__scopeId","data-v-3d84026e"]]),St={key:0,class:"flex items-center justify-center gap-4 mb-4"},Mt={class:"flex items-center gap-2"},Lt={class:"flex items-center gap-2"},Et={key:1,class:"space-y-4"},Vt={class:"flex flex-wrap gap-2"},Pt=["title","onClick"],At={class:"alert alert-info py-2"},Bt={class:"text-sm"},Tt={key:0,class:"alert py-2"},jt={class:"text-sm"},Nt={class:"form-control"},zt=["disabled"],Ut={key:0,class:"label"},Ft={class:"form-control"},Yt={class:"form-control"},Xt={class:"flex flex-wrap gap-2 mb-3"},Ht=["title","onClick"],Gt={class:"grid grid-cols-3 gap-3"},Wt={class:"flex items-center gap-3 mt-3"},qt={class:"form-control"},Jt={class:"label"},Kt={class:"label-text-alt"},Qt={class:"form-control"},Zt={class:"label"},el={class:"label-text-alt"},tl=["disabled"],ll=["disabled"],nl=["disabled"],sl={key:0,class:"loading loading-spinner loading-sm"},al={__name:"ROIFormModal",props:{modelValue:{type:Boolean,default:!1},roi:{type:Object,default:null},instrumentId:{type:[Number,String],required:!0},instrumentName:{type:String,default:""},loading:{type:Boolean,default:!1},imageUrl:{type:String,default:""},existingRois:{type:Array,default:()=>[]}},emits:["update:modelValue","submit"],setup(g,{emit:j}){const b=g,r=j,_=M(null),t=M("draw"),A=M([]),d=M({roi_name:"",description:"",color_r:255,color_g:0,color_b:0,alpha:.3,thickness:2}),u=O(()=>A.value.length>=3),E=[{name:"Red",r:255,g:0,b:0},{name:"Green",r:0,g:200,b:0},{name:"Blue",r:0,g:100,b:255},{name:"Yellow",r:255,g:220,b:0},{name:"Magenta",r:255,g:0,b:200},{name:"Cyan",r:0,g:200,b:200},{name:"Orange",r:255,g:140,b:0},{name:"Purple",r:128,g:0,b:255}],m=O(()=>{var I;return!!((I=b.roi)!=null&&I.id)}),w=O(()=>m.value?`Edit ${b.roi.roi_name}`:t.value==="draw"?"Draw ROI Polygon":"ROI Details"),z=O(()=>b.imageUrl&&t.value==="draw"),F=O(()=>({backgroundColor:`rgb(${d.value.color_r}, ${d.value.color_g}, ${d.value.color_b})`}));ie(()=>b.roi,I=>{I?d.value={roi_name:I.roi_name||"",description:I.description||"",color_r:I.color_r??255,color_g:I.color_g??0,color_b:I.color_b??0,alpha:I.alpha??.3,thickness:I.thickness??2}:J()},{immediate:!0}),ie(()=>b.modelValue,I=>{I&&!b.roi&&J()});function J(){d.value={roi_name:"",description:"",color_r:255,color_g:0,color_b:0,alpha:.3,thickness:2},A.value=[],t.value=b.imageUrl?"draw":"details"}function Z(I){d.value.color_r=I.r,d.value.color_g=I.g,d.value.color_b=I.b,_.value&&_.value.setColor(I.r,I.g,I.b)}function V(){r("update:modelValue",!1)}function k(I){A.value=I}function U(I){A.value=I.points,d.value.color_r=I.color_r,d.value.color_g=I.color_g,d.value.color_b=I.color_b,d.value.alpha=I.alpha,d.value.thickness=I.thickness,t.value="details"}function W(){A.value=[]}function N(){t.value="draw"}function H(){const I={...d.value,instrument_id:parseInt(b.instrumentId),points:A.value};m.value&&A.value.length===0&&b.roi.points&&(I.points=b.roi.points),r("submit",I)}return(I,p)=>(f(),ke(Ye,{"model-value":g.modelValue,title:w.value,size:z.value?"lg":"md","onUpdate:modelValue":p[7]||(p[7]=n=>I.$emit("update:modelValue",n))},{default:he(()=>[g.imageUrl&&!m.value?(f(),h("div",St,[e("div",Mt,[e("div",{class:Q(["w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold",t.value==="draw"?"bg-primary text-primary-content":"bg-success text-success-content"])},D(t.value==="draw"?"1":"âœ“"),3),e("span",{class:Q(t.value==="draw"?"font-medium":"text-base-content/60")},"Draw",2)]),p[8]||(p[8]=e("div",{class:"w-8 h-0.5 bg-base-300"},null,-1)),e("div",Lt,[e("div",{class:Q(["w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold",t.value==="details"?"bg-primary text-primary-content":"bg-base-300 text-base-content/60"])}," 2 ",2),e("span",{class:Q(t.value==="details"?"font-medium":"text-base-content/60")},"Details",2)])])):L("",!0),z.value?(f(),h("div",Et,[p[10]||(p[10]=e("div",{class:"alert alert-info py-2"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"stroke-current shrink-0 h-5 w-5",fill:"none",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("span",{class:"text-sm"},"Click on the image to draw ROI points. Double-click or click the first point to close.")],-1)),e("div",Vt,[p[9]||(p[9]=e("span",{class:"text-sm text-base-content/70"},"Color:",-1)),(f(),h(ye,null,_e(E,n=>e("button",{key:n.name,type:"button",class:"w-6 h-6 rounded border-2 border-base-300 hover:border-primary transition-colors",style:me({backgroundColor:`rgb(${n.r}, ${n.g}, ${n.b})`}),title:n.name,onClick:v=>Z(n)},null,12,Pt)),64))]),ge(Ot,{ref_key:"canvasRef",ref:_,"image-url":g.imageUrl,"existing-rois":g.existingRois,"editing-roi":m.value?g.roi:null,height:400,"default-color":{r:d.value.color_r,g:d.value.color_g,b:d.value.color_b},onPointsChange:k,onDrawingComplete:U,onDrawingCancel:W},null,8,["image-url","existing-rois","editing-roi","default-color"])])):(f(),h("form",{key:2,onSubmit:Le(H,["prevent"]),class:"space-y-4"},[e("div",At,[p[12]||(p[12]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"stroke-current shrink-0 h-5 w-5",fill:"none",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",Bt,[p[11]||(p[11]=K("ROI for: ",-1)),e("strong",null,D(g.instrumentName),1)])]),u.value?(f(),h("div",Tt,[p[13]||(p[13]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"stroke-current shrink-0 h-5 w-5",fill:"none",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",jt,"Polygon drawn with "+D(A.value.length)+" points",1),g.imageUrl?(f(),h("button",{key:0,type:"button",class:"btn btn-ghost btn-xs",onClick:N}," Redraw ")):L("",!0)])):L("",!0),e("div",Nt,[p[15]||(p[15]=e("label",{class:"label"},[e("span",{class:"label-text font-medium"},"ROI Name"),e("span",{class:"label-text-alt text-base-content/60"},"e.g., ROI_01")],-1)),fe(e("input",{"onUpdate:modelValue":p[0]||(p[0]=n=>d.value.roi_name=n),type:"text",class:"input input-bordered",placeholder:"Leave empty for auto-generated name",disabled:m.value},null,8,zt),[[be,d.value.roi_name]]),m.value?L("",!0):(f(),h("label",Ut,[...p[14]||(p[14]=[e("span",{class:"label-text-alt"},"Auto-generated if left empty",-1)])]))]),e("div",Ft,[p[16]||(p[16]=e("label",{class:"label"},[e("span",{class:"label-text font-medium"},"Description")],-1)),fe(e("textarea",{"onUpdate:modelValue":p[1]||(p[1]=n=>d.value.description=n),class:"textarea textarea-bordered",rows:"2",placeholder:"Optional description of this ROI..."},null,512),[[be,d.value.description]])]),e("div",Yt,[p[21]||(p[21]=e("label",{class:"label"},[e("span",{class:"label-text font-medium"},"Color")],-1)),e("div",Xt,[(f(),h(ye,null,_e(E,n=>e("button",{key:n.name,type:"button",class:"w-8 h-8 rounded-lg border-2 border-base-300 hover:border-primary transition-colors",style:me({backgroundColor:`rgb(${n.r}, ${n.g}, ${n.b})`}),title:n.name,onClick:v=>Z(n)},null,12,Ht)),64))]),e("div",Gt,[e("div",null,[p[17]||(p[17]=e("label",{class:"label py-0"},[e("span",{class:"label-text text-xs"},"Red")],-1)),fe(e("input",{"onUpdate:modelValue":p[2]||(p[2]=n=>d.value.color_r=n),type:"number",min:"0",max:"255",class:"input input-bordered input-sm w-full"},null,512),[[be,d.value.color_r,void 0,{number:!0}]])]),e("div",null,[p[18]||(p[18]=e("label",{class:"label py-0"},[e("span",{class:"label-text text-xs"},"Green")],-1)),fe(e("input",{"onUpdate:modelValue":p[3]||(p[3]=n=>d.value.color_g=n),type:"number",min:"0",max:"255",class:"input input-bordered input-sm w-full"},null,512),[[be,d.value.color_g,void 0,{number:!0}]])]),e("div",null,[p[19]||(p[19]=e("label",{class:"label py-0"},[e("span",{class:"label-text text-xs"},"Blue")],-1)),fe(e("input",{"onUpdate:modelValue":p[4]||(p[4]=n=>d.value.color_b=n),type:"number",min:"0",max:"255",class:"input input-bordered input-sm w-full"},null,512),[[be,d.value.color_b,void 0,{number:!0}]])])]),e("div",Wt,[e("div",{class:"w-12 h-12 rounded-lg border border-base-300",style:me(F.value)},null,4),p[20]||(p[20]=e("span",{class:"text-sm text-base-content/60"},"Color preview",-1))])]),e("div",qt,[e("label",Jt,[p[22]||(p[22]=e("span",{class:"label-text font-medium"},"Opacity",-1)),e("span",Kt,D(Math.round(d.value.alpha*100))+"%",1)]),fe(e("input",{"onUpdate:modelValue":p[5]||(p[5]=n=>d.value.alpha=n),type:"range",min:"0.1",max:"0.8",step:"0.1",class:"range range-primary range-sm"},null,512),[[be,d.value.alpha,void 0,{number:!0}]])]),e("div",Qt,[e("label",Zt,[p[23]||(p[23]=e("span",{class:"label-text font-medium"},"Border Thickness",-1)),e("span",el,D(d.value.thickness)+"px",1)]),fe(e("input",{"onUpdate:modelValue":p[6]||(p[6]=n=>d.value.thickness=n),type:"range",min:"1",max:"10",step:"1",class:"range range-sm"},null,512),[[be,d.value.thickness,void 0,{number:!0}]])])],32))]),actions:he(()=>[e("button",{type:"button",class:"btn btn-ghost",disabled:g.loading,onClick:V}," Cancel ",8,tl),t.value==="details"&&g.imageUrl&&!m.value?(f(),h("button",{key:0,type:"button",class:"btn btn-ghost",disabled:g.loading,onClick:N}," Back ",8,ll)):L("",!0),t.value==="details"?(f(),h("button",{key:1,type:"submit",class:"btn btn-primary",disabled:g.loading||!u.value&&!m.value,onClick:H},[g.loading?(f(),h("span",sl)):L("",!0),K(" "+D(m.value?"Save Changes":"Create ROI"),1)],8,nl)):L("",!0)]),_:1},8,["model-value","title","size"]))}},ol={key:0,class:"flex justify-center py-12"},il={key:1,class:"alert alert-error"},rl={key:2},ul={class:"text-sm breadcrumbs mb-4"},cl={key:0},dl={key:1},vl={class:"bg-base-100 rounded-lg shadow-lg p-6 mb-6"},gl={class:"flex items-start justify-between"},fl={class:"flex items-start gap-4"},ml={class:"flex items-center flex-wrap gap-2 sm:gap-3"},pl={class:"text-xl sm:text-2xl font-bold"},bl={class:"text-sm text-base-content/60 font-mono block mt-1"},hl={class:"flex items-center flex-wrap gap-2 sm:gap-4 mt-2"},yl={key:0,class:"text-base-content/50 ml-1 hidden sm:inline"},xl={key:0,class:"text-base-content/60 mt-2"},wl={key:0,class:"flex gap-2"},kl={class:"bg-base-100 rounded-lg shadow-lg p-6 mb-6"},_l={class:"text-xl font-semibold mb-4"},Il={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},Rl={class:"text-sm text-base-content/60"},Cl={key:1,class:"text-center py-8 text-base-content/60"},$l={key:0,class:"bg-base-100 rounded-lg shadow-lg p-6 mb-6"},Dl={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},Ol={key:0},Sl={class:"font-medium"},Ml={key:1},Ll={class:"font-medium"},El={key:2},Vl={class:"font-medium"},Pl={key:1,class:"bg-base-100 rounded-lg shadow-lg p-6 mb-6"},Al={class:"flex items-center justify-between mb-4"},Bl={class:"flex items-center gap-3"},Tl={class:"badge badge-sm sm:badge-lg"},jl={class:"flex items-center gap-2"},Nl={class:"label cursor-pointer gap-2"},zl={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Ul={class:"lg:col-span-2"},Fl={class:"lg:col-span-1"},Yl={key:0,class:"mt-4 p-4 bg-base-200 rounded-lg"},Xl={class:"flex items-center justify-between mb-2"},Hl={class:"font-semibold"},Gl={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm"},Wl={class:"flex items-center gap-2"},ql={key:0,class:"mt-2 text-sm text-base-content/70"},Jl={class:"bg-base-100 rounded-lg shadow-lg p-6"},Kl={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm"},Ql={class:"font-mono"},sn={__name:"InstrumentView",props:{id:{type:[Number,String],required:!0}},setup(g){const j=g,b=Pe(),r=Ae(),_=Te(),t=Ge(),A=Ue(),d=Fe(),u=O(()=>r.currentInstrument),E=O(()=>_.currentPlatform),m=O(()=>t.rois),w=O(()=>u.value?je(u.value.instrument_type):null),z=O(()=>u.value?Ne(u.value.instrument_type):{}),F=O(()=>{if(!u.value)return{};const c=u.value.specifications;if(c&&typeof c=="object")return c;if(typeof c=="string")try{return JSON.parse(c)}catch{return{}}return{}}),J=O(()=>z.value?Object.entries(z.value).map(([c,s])=>{var P;const x=F.value[c]??((P=u.value)==null?void 0:P[c]);return{key:c,label:s.label,value:x,config:s,hasValue:x!=null&&x!==""}}):[]),Z=O(()=>u.value?Xe(u.value.status):null),V=O(()=>u.value?He(u.value.measurement_status):null),k=O(()=>E.value?A.canEditStation(E.value.station_id):!1),U=O(()=>r.loading||_.loading),W=O(()=>t.loading),N=M(!1),H=M(!1),I=M(!1),p=M(!1),n=M(null),v=M(null),R=M(null),$=M(!0);async function S(){const c=parseInt(j.id),s=await r.fetchInstrument(c);s&&(await _.fetchPlatform(s.platform_id),await t.fetchROIsByInstrument(c))}Ie(S),ie(()=>j.id,S);function B(){N.value=!0}async function G(c){await r.updateInstrument(u.value.id,c)?(d.success("Instrument updated successfully"),N.value=!1):d.error(r.error||"Failed to update instrument")}function le(){H.value=!0}async function pe(){const c=u.value.platform_id;await r.deleteInstrument(u.value.id)?(d.success("Instrument deleted successfully"),H.value=!1,b.push({name:"platform",params:{id:c}})):d.error(r.error||"Failed to delete instrument")}function ve(c){n.value=c}function re(c){}function ue(c){n.value=c}function ae(){v.value=null,I.value=!0}function ce(c){v.value=c,I.value=!0}function a(c){R.value=c,p.value=!0}async function i(c){var s;(s=v.value)!=null&&s.id?await t.updateROI(v.value.id,c)?(d.success("ROI updated successfully"),I.value=!1,v.value=null):d.error(t.error||"Failed to update ROI"):await t.createROI(c)?(d.success("ROI created successfully"),I.value=!1):d.error(t.error||"Failed to create ROI")}async function C(){var s,x;if(!R.value)return;await t.deleteROI(R.value.id)?(d.success("ROI deleted successfully"),p.value=!1,R.value=null,((s=n.value)==null?void 0:s.id)===((x=R.value)==null?void 0:x.id)&&(n.value=null)):d.error(t.error||"Failed to delete ROI")}const o=O(()=>w.value&&{phenocam:"text-blue-500",multispectral:"text-purple-500",par_sensor:"text-amber-500",ndvi_sensor:"text-green-500",pri_sensor:"text-cyan-500",hyperspectral:"text-pink-500",thermal:"text-red-500",lidar:"text-teal-500",radar:"text-indigo-500"}[w.value.key]||"text-gray-500"),l=O(()=>w.value&&{phenocam:"bg-blue-500/10",multispectral:"bg-purple-500/10",par_sensor:"bg-amber-500/10",ndvi_sensor:"bg-green-500/10",pri_sensor:"bg-cyan-500/10",hyperspectral:"bg-pink-500/10",thermal:"bg-red-500/10",lidar:"bg-teal-500/10",radar:"bg-indigo-500/10"}[w.value.key]||"bg-gray-500/10"),y=O(()=>w.value?w.value.key==="phenocam":!1);return(c,s)=>{var P,T,ee,ne,te,se,oe,xe,we;const x=Ee("router-link");return f(),h("div",null,[U.value&&!u.value?(f(),h("div",ol,[...s[6]||(s[6]=[e("span",{class:"loading loading-spinner loading-lg"},null,-1)])])):Y(r).error?(f(),h("div",il,[s[7]||(s[7]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",null,D(Y(r).error),1)])):u.value?(f(),h("div",rl,[e("div",ul,[e("ul",null,[e("li",null,[ge(x,{to:"/dashboard"},{default:he(()=>[...s[8]||(s[8]=[K("Dashboard",-1)])]),_:1})]),E.value?(f(),h("li",cl,[ge(x,{to:`/stations/${E.value.station_acronym}`},{default:he(()=>[K(D(E.value.station_acronym),1)]),_:1},8,["to"])])):L("",!0),E.value?(f(),h("li",dl,[ge(x,{to:`/platforms/${E.value.id}`},{default:he(()=>[K(D(E.value.normalized_name),1)]),_:1},8,["to"])])):L("",!0),e("li",null,D(u.value.normalized_name),1)])]),e("div",vl,[e("div",gl,[e("div",fl,[e("div",{class:Q(["p-4 rounded-lg",l.value])},[(f(),h("svg",{xmlns:"http://www.w3.org/2000/svg",class:Q(["h-8 w-8",o.value]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[...s[9]||(s[9]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z M15 13a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)])],2))],2),e("div",null,[e("div",ml,[e("h1",pl,D(u.value.display_name||u.value.normalized_name),1),e("span",{class:Q(["badge badge-sm sm:badge-md whitespace-nowrap",(P=Z.value)==null?void 0:P.badgeClass])},D(u.value.status),3)]),e("code",bl,D(u.value.normalized_name),1),e("div",hl,[e("span",{class:Q(["font-medium whitespace-nowrap",o.value])},[K(D(((T=w.value)==null?void 0:T.name)||u.value.instrument_type)+" ",1),(ee=w.value)!=null&&ee.code?(f(),h("span",yl," ("+D(w.value.code)+") ",1)):L("",!0)],2),V.value?(f(),h("span",{key:0,class:Q([V.value.textClass,"flex items-center gap-1 whitespace-nowrap"])},[e("span",{class:Q(["w-2 h-2 rounded-full flex-shrink-0",V.value.dotClass])},null,2),K(" "+D(u.value.measurement_status),1)],2)):L("",!0)]),u.value.description?(f(),h("p",xl,D(u.value.description),1)):L("",!0)])]),k.value?(f(),h("div",wl,[e("button",{class:"btn btn-outline btn-sm",onClick:B},[...s[10]||(s[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),K(" Edit ",-1)])]),e("button",{class:"btn btn-outline btn-error btn-sm",onClick:le},[...s[11]||(s[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),K(" Delete ",-1)])])])):L("",!0)])]),e("div",kl,[e("h2",_l,D(((ne=w.value)==null?void 0:ne.name)||"Instrument")+" Specifications ",1),J.value.length>0?(f(),h("div",Il,[(f(!0),h(ye,null,_e(J.value,X=>(f(),h("div",{key:X.key,class:"space-y-1"},[e("label",Rl,D(X.label),1),e("div",{class:Q(["font-medium",{"text-base-content/40 italic":!X.hasValue}])},D(X.hasValue?Y(ze)(X.value,X.config):"Not specified"),3)]))),128))])):(f(),h("div",Cl,[...s[12]||(s[12]=[e("p",null,"No specifications defined for this instrument type.",-1)])]))]),u.value.deployment_date||u.value.calibration_date?(f(),h("div",$l,[s[16]||(s[16]=e("h2",{class:"text-xl font-semibold mb-4"},"Timeline",-1)),e("div",Dl,[u.value.deployment_date?(f(),h("div",Ol,[s[13]||(s[13]=e("label",{class:"text-sm text-base-content/60"},"Deployment Date",-1)),e("div",Sl,D(new Date(u.value.deployment_date).toLocaleDateString()),1)])):L("",!0),u.value.calibration_date?(f(),h("div",Ml,[s[14]||(s[14]=e("label",{class:"text-sm text-base-content/60"},"Last Calibration",-1)),e("div",Ll,D(new Date(u.value.calibration_date).toLocaleDateString()),1)])):L("",!0),u.value.created_at?(f(),h("div",El,[s[15]||(s[15]=e("label",{class:"text-sm text-base-content/60"},"Added to System",-1)),e("div",Vl,D(new Date(u.value.created_at).toLocaleDateString()),1)])):L("",!0)])])):L("",!0),y.value?(f(),h("div",Pl,[e("div",Al,[e("div",Bl,[s[17]||(s[17]=e("h2",{class:"text-xl font-semibold"}," Regions of Interest (ROIs) ",-1)),e("span",Tl,D(m.value.length),1)]),e("div",jl,[e("label",Nl,[s[18]||(s[18]=e("span",{class:"label-text text-sm"},"Labels",-1)),fe(e("input",{"onUpdate:modelValue":s[0]||(s[0]=X=>$.value=X),type:"checkbox",class:"toggle toggle-sm toggle-primary"},null,512),[[Ve,$.value]])])])]),e("div",zl,[e("div",Ul,[ge(Y(tt),{rois:m.value,"selected-roi-id":(te=n.value)==null?void 0:te.id,"show-labels":$.value,height:400,onRoiClick:ve,onRoiHover:re},null,8,["rois","selected-roi-id","show-labels"]),s[19]||(s[19]=e("p",{class:"text-sm text-base-content/60 mt-2"}," Scroll to zoom, drag to pan. Click ROI to select. ",-1))]),e("div",Fl,[ge(Y(_t),{rois:m.value,"selected-id":(se=n.value)==null?void 0:se.id,"can-edit":k.value,loading:W.value,"max-height":350,onSelect:ue,onEdit:ce,onDelete:a,onCreate:ae},null,8,["rois","selected-id","can-edit","loading"])])]),n.value?(f(),h("div",Yl,[e("div",Xl,[e("h3",Hl,D(n.value.roi_name),1),e("button",{class:"btn btn-ghost btn-xs",onClick:s[1]||(s[1]=X=>n.value=null)},[...s[20]||(s[20]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Gl,[e("div",null,[s[21]||(s[21]=e("label",{class:"text-base-content/60"},"Points",-1)),e("div",null,D(((oe=n.value.points)==null?void 0:oe.length)||0),1)]),e("div",null,[s[22]||(s[22]=e("label",{class:"text-base-content/60"},"Color",-1)),e("div",Wl,[e("div",{class:"w-4 h-4 rounded border border-base-300",style:me({backgroundColor:`rgb(${n.value.color_r??255}, ${n.value.color_g??0}, ${n.value.color_b??0})`})},null,4),e("span",null,"RGB("+D(n.value.color_r??255)+", "+D(n.value.color_g??0)+", "+D(n.value.color_b??0)+")",1)])]),e("div",null,[s[23]||(s[23]=e("label",{class:"text-base-content/60"},"Auto Generated",-1)),e("div",null,D(n.value.auto_generated?"Yes":"No"),1)]),e("div",null,[s[24]||(s[24]=e("label",{class:"text-base-content/60"},"Created",-1)),e("div",null,D(n.value.created_at?new Date(n.value.created_at).toLocaleDateString():"-"),1)])]),n.value.description?(f(),h("p",ql,D(n.value.description),1)):L("",!0)])):L("",!0)])):L("",!0),e("div",Jl,[s[29]||(s[29]=e("h2",{class:"text-xl font-semibold mb-4"},"Metadata",-1)),e("div",Kl,[e("div",null,[s[25]||(s[25]=e("label",{class:"text-base-content/60"},"ID",-1)),e("div",Ql,D(u.value.id),1)]),e("div",null,[s[26]||(s[26]=e("label",{class:"text-base-content/60"},"Platform",-1)),E.value?(f(),ke(x,{key:0,to:`/platforms/${E.value.id}`,class:"link link-primary"},{default:he(()=>[K(D(E.value.normalized_name),1)]),_:1},8,["to"])):L("",!0)]),e("div",null,[s[27]||(s[27]=e("label",{class:"text-base-content/60"},"Created",-1)),e("div",null,D(u.value.created_at?new Date(u.value.created_at).toLocaleString():"-"),1)]),e("div",null,[s[28]||(s[28]=e("label",{class:"text-base-content/60"},"Last Updated",-1)),e("div",null,D(u.value.updated_at?new Date(u.value.updated_at).toLocaleString():"-"),1)])])])])):L("",!0),u.value&&E.value?(f(),ke(Y(Be),{key:3,modelValue:N.value,"onUpdate:modelValue":s[2]||(s[2]=X=>N.value=X),instrument:u.value,"platform-id":u.value.platform_id,"platform-name":E.value.normalized_name,"platform-type":E.value.platform_type,onSubmit:G},null,8,["modelValue","instrument","platform-id","platform-name","platform-type"])):L("",!0),ge(Y(Ce),{modelValue:H.value,"onUpdate:modelValue":s[3]||(s[3]=X=>H.value=X),title:"Delete Instrument",message:`Are you sure you want to delete '${(xe=u.value)==null?void 0:xe.normalized_name}'? This will also delete all associated ROIs. This action cannot be undone.`,"confirm-text":"Delete Instrument",variant:"error",loading:Y(r).loading,onConfirm:pe},null,8,["modelValue","message","loading"]),u.value?(f(),ke(Y(al),{key:4,modelValue:I.value,"onUpdate:modelValue":s[4]||(s[4]=X=>I.value=X),roi:v.value,"instrument-id":u.value.id,"instrument-name":u.value.normalized_name,loading:Y(t).loading,onSubmit:i},null,8,["modelValue","roi","instrument-id","instrument-name","loading"])):L("",!0),ge(Y(Ce),{modelValue:p.value,"onUpdate:modelValue":s[5]||(s[5]=X=>p.value=X),title:"Delete ROI",message:`Are you sure you want to delete '${(we=R.value)==null?void 0:we.roi_name}'? This action cannot be undone.`,"confirm-text":"Delete ROI",variant:"error",loading:Y(t).loading,onConfirm:C},null,8,["modelValue","message","loading"])])}}};export{sn as default};
