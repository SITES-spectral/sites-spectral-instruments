import{c as u,e as l,o as a,F as T,i as F,f as e,t as r,l as p,b as Q,k as g,G as J,n as h,h as _,g as V,w as j,r as B,m as le,p as oe,s as A,x as re,a as ie}from"./vendor-DIThaKhE.js";import{e as ue,f as me,u as ce,b as de}from"./index-WNvBzQOU.js";import{a as X,b as fe,f as ve,g as pe,_ as W}from"./useTypeRegistry-Cq5ebRSc.js";import{_ as ge,a as be,b as he,c as ye}from"./SatellitePlatformDetails-BjgdXvpg.js";import{g as xe,a as we}from"./BaseModal-CYDQdZr3.js";import{_ as ke}from"./InstrumentFormModal-Drrb1Oa2.js";const _e={key:0,class:"grid grid-cols-2 sm:grid-cols-3 gap-2 text-sm"},Me={class:"text-xs text-base-content/50 block truncate"},Ce=["title"],$e={key:1,class:"text-xs text-base-content/50 italic"},Ve={__name:"InstrumentTypeDetails",props:{instrument:{type:Object,required:!0},showAllFields:{type:Boolean,default:!1}},setup(n){const d=n,y=u(()=>X(d.instrument.instrument_type)),f=u(()=>{if(d.instrument.specifications&&typeof d.instrument.specifications=="object")return d.instrument.specifications;if(typeof d.instrument.specifications=="string")try{return JSON.parse(d.instrument.specifications)}catch{return{}}return d.instrument}),o=u(()=>{var w;if(!((w=y.value)!=null&&w.fields))return[];const t=y.value.fields,P=fe(d.instrument.instrument_type);return(d.showAllFields?Object.keys(t):P).map(k=>{const c=t[k];if(!c)return null;const i=f.value[k]??d.instrument[k];return{key:k,label:c.label,value:i,config:c,hasValue:i!=null&&i!==""}}).filter(k=>k!==null)}),D=u(()=>o.value.filter(t=>t.hasValue)),v=u(()=>D.value.length>0);return(t,P)=>v.value?(a(),l("div",_e,[(a(!0),l(T,null,F(D.value,x=>(a(),l("div",{key:x.key,class:"min-w-0"},[e("span",Me,r(x.label),1),e("span",{class:"font-medium block truncate",title:String(x.value)},r(p(ve)(x.value,x.config)),9,Ce)]))),128))])):(a(),l("div",$e," No specifications recorded "))}},Ie={class:"flex items-start justify-between gap-2"},Se={class:"flex items-center gap-2 min-w-0 flex-1"},De=["title"],Pe=["d"],ze={class:"min-w-0 flex-1"},Be={class:"text-xs text-base-content/50 font-mono truncate block"},je={class:"flex items-center flex-wrap gap-2 mt-2 text-xs"},Ae={key:0,class:"opacity-70 ml-1 hidden sm:inline"},Te={class:"truncate"},Fe={key:0,class:"text-accent whitespace-nowrap"},He={key:0,class:"mt-3 pt-2 border-t border-base-200"},Ee={key:1,class:"mt-2"},Le={key:2,class:"flex justify-end gap-1 mt-2 pt-2 border-t border-base-200"},Ne={key:3,class:"flex justify-end mt-2 pt-2 border-t border-base-200"},Oe={__name:"InstrumentCard",props:{instrument:{type:Object,required:!0},canEdit:{type:Boolean,default:!1},compact:{type:Boolean,default:!1},showPlatform:{type:Boolean,default:!1},showAllSpecs:{type:Boolean,default:!1}},emits:["edit","delete","view"],setup(n,{emit:d}){const y=n,f=d,o=u(()=>X(y.instrument.instrument_type)),D=u(()=>xe(y.instrument.status)),v=u(()=>we(y.instrument.measurement_status)),t=u(()=>{var c;return y.instrument.roi_count||((c=y.instrument.rois)==null?void 0:c.length)||0});u(()=>{var c;return((c=o.value)==null?void 0:c.color)||"#6b7280"});const P=u(()=>o.value&&{phenocam:"bg-blue-500/10",multispectral:"bg-purple-500/10",par_sensor:"bg-amber-500/10",ndvi_sensor:"bg-green-500/10",pri_sensor:"bg-cyan-500/10",hyperspectral:"bg-pink-500/10",thermal:"bg-red-500/10",lidar:"bg-teal-500/10",radar:"bg-indigo-500/10"}[o.value.key]||"bg-gray-500/10"),x=u(()=>o.value&&{phenocam:"text-blue-500",multispectral:"text-purple-500",par_sensor:"text-amber-500",ndvi_sensor:"text-green-500",pri_sensor:"text-cyan-500",hyperspectral:"text-pink-500",thermal:"text-red-500",lidar:"text-teal-500",radar:"text-indigo-500"}[o.value.key]||"text-gray-500"),w={camera:["M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z","M15 13a3 3 0 11-6 0 3 3 0 016 0z"],"layer-group":["M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"],sun:["M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"],leaf:["M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"],microscope:["M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"],rainbow:["M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"],"temperature-high":["M9 19c-4.3 1.4-6-2.7-6-7 0-4.3 1.7-8.4 6-7m0 14V5m0 14a5 5 0 005-5 5 5 0 00-5-5"],"wave-square":["M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"],"satellite-dish":["M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.14 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"],cube:["M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"]},k=u(()=>{var i;const c=((i=o.value)==null?void 0:i.icon)||"cube";return w[c]||w.cube});return(c,i)=>{var I,S,C,$;const M=Q("router-link");return a(),l("div",{class:h(["card bg-base-100 shadow-sm border border-base-200 hover:border-primary/30 transition-colors",{"card-compact":n.compact}])},[e("div",{class:h(["card-body",n.compact?"p-2":"p-3"])},[e("div",Ie,[e("div",Se,[e("div",{class:h(["flex-shrink-0 rounded flex items-center justify-center",P.value]),style:J({width:n.compact?"28px":"32px",height:n.compact?"28px":"32px"}),title:((I=o.value)==null?void 0:I.name)||n.instrument.instrument_type},[(a(),l("svg",{xmlns:"http://www.w3.org/2000/svg",class:h([x.value]),style:J({width:n.compact?"14px":"16px",height:n.compact?"14px":"16px"}),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[(a(!0),l(T,null,F(k.value,(z,H)=>(a(),l("path",{key:H,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:z},null,8,Pe))),128))],6))],14,De),e("div",ze,[e("h5",{class:h(["font-medium truncate",n.compact?"text-xs":"text-sm"])},r(n.instrument.display_name),3),e("code",Be,r(n.instrument.normalized_name),1)])]),e("span",{class:h(["badge",n.compact?"badge-xs":"badge-sm",D.value.badgeClass])},r(n.instrument.status),3)]),e("div",je,[e("span",{class:h(["badge badge-xs sm:badge-sm whitespace-nowrap",((S=o.value)==null?void 0:S.badgeClass)||"badge-ghost"])},[_(r(((C=o.value)==null?void 0:C.name)||n.instrument.instrument_type)+" ",1),($=o.value)!=null&&$.code?(a(),l("span",Ae," ("+r(o.value.code)+") ",1)):g("",!0)],2),e("span",{class:h([v.value.textClass,"flex items-center gap-1 whitespace-nowrap"])},[e("span",{class:h(["w-1.5 h-1.5 rounded-full flex-shrink-0",v.value.dotClass])},null,2),e("span",Te,r(n.instrument.measurement_status||"Unknown"),1)],2),t.value>0?(a(),l("span",Fe,r(t.value)+" ROI"+r(t.value!==1?"s":""),1)):g("",!0)]),n.compact?g("",!0):(a(),l("div",He,[V(Ve,{instrument:n.instrument,"show-all-fields":n.showAllSpecs},null,8,["instrument","show-all-fields"])])),n.showPlatform&&n.instrument.platform_name?(a(),l("div",Ee,[V(M,{to:`/platforms/${n.instrument.platform_id}`,class:"text-xs text-primary hover:underline"},{default:j(()=>[_(r(n.instrument.platform_name),1)]),_:1},8,["to"])])):g("",!0),n.canEdit?(a(),l("div",Le,[V(M,{to:`/instruments/${n.instrument.id}`,class:"btn btn-ghost btn-xs"},{default:j(()=>[...i[2]||(i[2]=[_(" View ",-1)])]),_:1},8,["to"]),e("button",{onClick:i[0]||(i[0]=z=>f("edit",n.instrument)),class:"btn btn-ghost btn-xs text-primary"}," Edit "),e("button",{onClick:i[1]||(i[1]=z=>f("delete",n.instrument)),class:"btn btn-ghost btn-xs text-error"}," Delete ")])):n.compact?g("",!0):(a(),l("div",Ne,[V(M,{to:`/instruments/${n.instrument.id}`,class:"btn btn-ghost btn-xs text-primary"},{default:j(()=>[...i[3]||(i[3]=[_(" View Details ",-1),e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 ml-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])]),_:1},8,["to"])]))],2)],2)}}},Ue={key:0,class:"flex justify-center py-12"},qe={key:1,class:"alert alert-error"},Re={key:2},Ge={class:"text-sm breadcrumbs mb-4"},Je={class:"bg-base-100 rounded-lg shadow-lg p-6 mb-6"},We={class:"flex items-start justify-between"},Qe={class:"flex items-center gap-3"},Xe={class:"text-2xl font-bold"},Ye={class:"text-sm text-base-content/60 font-mono mt-1 block"},Ze={key:0,class:"text-base-content/60 mt-2"},Ke={key:0,class:"flex gap-2"},et={class:"mt-6 pt-4 border-t border-base-200"},tt={class:"bg-base-100 rounded-lg shadow-lg p-6"},st={class:"flex items-center justify-between mb-4"},nt={class:"text-xl font-semibold"},at={class:"badge badge-lg ml-2"},lt={key:0,class:"space-y-6"},ot={class:"text-lg font-medium mb-3 flex items-center gap-2"},rt={class:"badge badge-secondary"},it={class:"text-base-content/60 text-sm font-normal"},ut={class:"grid grid-cols-1 lg:grid-cols-2 gap-4"},mt={key:1,class:"text-center py-8"},bt={__name:"PlatformView",props:{id:{type:[Number,String],required:!0}},setup(n){const d=n,y=ie(),f=ue(),o=me(),D=ce(),v=de(),t=u(()=>f.currentPlatform),P=u(()=>t.value?pe(t.value.platform_type):null),x=u(()=>{var m;switch((m=t.value)==null?void 0:m.platform_type){case"uav":return he;case"satellite":return be;case"fixed":default:return ge}}),w=u(()=>t.value?D.canEditStation(t.value.station_id):!1),k=u(()=>o.instrumentsByType),c=u(()=>f.loading||o.loading),i=B(!1),M=B(!1),I=B(!1),S=B(!1),C=B(null),$=B(null);async function z(){const m=parseInt(d.id);await f.fetchPlatform(m)&&await o.fetchInstrumentsByPlatform(m)}le(z),oe(()=>d.id,z);function H(){i.value=!0}function Y(){I.value=!0}async function Z(m){await f.updatePlatform(t.value.id,m)?(v.success("Platform updated successfully"),i.value=!1):v.error(f.error||"Failed to update platform")}async function K(){const m=t.value.station_acronym;await f.deletePlatform(t.value.id)?(v.success("Platform deleted successfully"),I.value=!1,y.push({name:"station",params:{acronym:m}})):v.error(f.error||"Failed to delete platform")}function E(){C.value=null,M.value=!0}function ee(m){C.value=m,M.value=!0}function te(m){$.value=m,S.value=!0}async function se(m){let s;C.value?(s=await o.updateInstrument(C.value.id,m),s&&v.success("Instrument updated successfully")):(s=await o.createInstrument(m),s&&v.success("Instrument created successfully")),s?(M.value=!1,C.value=null):v.error(o.error||"Failed to save instrument")}async function ne(){if(!$.value)return;await o.deleteInstrument($.value.id)?(v.success("Instrument deleted successfully"),S.value=!1,$.value=null):v.error(o.error||"Failed to delete instrument")}const ae=u(()=>{var s;return{fixed:"badge-info",uav:"badge-warning",satellite:"badge-accent"}[(s=t.value)==null?void 0:s.platform_type]||"badge-info"});return(m,s)=>{var N,O,U,q;const L=Q("router-link");return a(),l("div",null,[c.value&&!t.value?(a(),l("div",Ue,[...s[4]||(s[4]=[e("span",{class:"loading loading-spinner loading-lg"},null,-1)])])):p(f).error?(a(),l("div",qe,[s[5]||(s[5]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",null,r(p(f).error),1)])):t.value?(a(),l("div",Re,[e("div",Ge,[e("ul",null,[e("li",null,[V(L,{to:"/dashboard"},{default:j(()=>[...s[6]||(s[6]=[_("Dashboard",-1)])]),_:1})]),e("li",null,[V(L,{to:`/stations/${t.value.station_acronym}`},{default:j(()=>[_(r(t.value.station_acronym),1)]),_:1},8,["to"])]),e("li",null,r(t.value.normalized_name),1)])]),e("div",Je,[e("div",We,[e("div",null,[e("div",Qe,[e("h1",Xe,r(t.value.display_name||t.value.normalized_name),1),e("span",{class:h(["badge badge-lg",ae.value])},r(((N=P.value)==null?void 0:N.name)||t.value.platform_type),3),e("span",{class:h([t.value.status==="Active"?"badge-success":"badge-warning","badge"])},r(t.value.status),3)]),e("code",Ye,r(t.value.normalized_name),1),t.value.description?(a(),l("p",Ze,r(t.value.description),1)):g("",!0)]),w.value?(a(),l("div",Ke,[e("button",{class:"btn btn-outline btn-sm",onClick:H},[...s[7]||(s[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),_(" Edit ",-1)])]),e("button",{class:"btn btn-outline btn-error btn-sm",onClick:Y},[...s[8]||(s[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),_(" Delete ",-1)])])])):g("",!0)]),e("div",et,[(a(),A(re(x.value),{platform:t.value},null,8,["platform"]))])]),e("div",tt,[e("div",st,[e("h2",nt,[s[9]||(s[9]=_(" Instruments ",-1)),e("span",at,r(p(o).instrumentCount),1)]),w.value?(a(),l("button",{key:0,class:"btn btn-primary btn-sm",onClick:E},[...s[10]||(s[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),_(" Add Instrument ",-1)])])):g("",!0)]),p(o).instrumentCount>0?(a(),l("div",lt,[(a(!0),l(T,null,F(k.value,(b,R)=>(a(),l("div",{key:R},[e("h3",ot,[e("span",rt,r(R),1),e("span",it,r(b.length)+" instrument"+r(b.length!==1?"s":""),1)]),e("div",ut,[(a(!0),l(T,null,F(b,G=>(a(),A(Oe,{key:G.id,instrument:G,"can-edit":w.value,onEdit:ee,onDelete:te},null,8,["instrument","can-edit"]))),128))])]))),128))])):(a(),l("div",mt,[s[11]||(s[11]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 mx-auto text-base-content/30",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"})],-1)),s[12]||(s[12]=e("p",{class:"mt-4 text-base-content/60"},"No instruments found",-1)),w.value?(a(),l("button",{key:0,class:"btn btn-primary mt-4",onClick:E}," Add First Instrument ")):g("",!0)]))])])):g("",!0),t.value?(a(),A(p(ye),{key:3,modelValue:i.value,"onUpdate:modelValue":s[0]||(s[0]=b=>i.value=b),platform:t.value,"station-id":t.value.station_id,"station-acronym":t.value.station_acronym,onSubmit:Z},null,8,["modelValue","platform","station-id","station-acronym"])):g("",!0),V(p(W),{modelValue:I.value,"onUpdate:modelValue":s[1]||(s[1]=b=>I.value=b),title:"Delete Platform",message:`Are you sure you want to delete '${(O=t.value)==null?void 0:O.normalized_name}'? This will also delete all ${p(o).instrumentCount} instrument(s). This action cannot be undone.`,"confirm-text":"Delete Platform",variant:"error",loading:p(f).loading,onConfirm:K},null,8,["modelValue","message","loading"]),t.value?(a(),A(p(ke),{key:4,modelValue:M.value,"onUpdate:modelValue":s[2]||(s[2]=b=>M.value=b),instrument:C.value,"platform-id":t.value.id,"platform-name":t.value.normalized_name,"platform-type":t.value.platform_type,onSubmit:se},null,8,["modelValue","instrument","platform-id","platform-name","platform-type"])):g("",!0),V(p(W),{modelValue:S.value,"onUpdate:modelValue":s[3]||(s[3]=b=>S.value=b),title:"Delete Instrument",message:`Are you sure you want to delete '${((U=$.value)==null?void 0:U.normalized_name)||((q=$.value)==null?void 0:q.display_name)}'? This action cannot be undone.`,"confirm-text":"Delete",variant:"error",loading:p(o).loading,onConfirm:ne},null,8,["modelValue","message","loading"])])}}};export{bt as default};
