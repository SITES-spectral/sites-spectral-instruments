openapi: 3.0.3
info:
  title: SITES Spectral Instruments API
  description: |
    API for managing SITES Spectral stations, platforms, instruments, and data products.

    ## Architecture
    Built on Hexagonal Architecture (Ports & Adapters) with CQRS pattern.

    ## Authentication
    JWT-based authentication with HMAC-SHA256 signing. Tokens are passed via:
    - HTTP-only cookies (preferred)
    - Authorization header (Bearer token)

    ## Versioning
    API supports semantic versioning with aliases:
    - `/api/v11` - Current version
    - `/api/latest` - Points to latest stable version
    - `/api/stable` - Points to stable production version
    - `/api/current` - Alias for latest

    ## Authentication (v15.0.0+)
    Multiple authentication methods supported:
    - **Cloudflare Access JWT** - Passwordless via email OTP (primary)
    - **HTTP-only cookies** - Legacy session-based auth (fallback)
    - **Magic Links** - Time-limited tokens for station internal users

    ## Subdomain Architecture (v15.0.0+)
    Portal-based access via subdomains:
    - `sitesspectral.work` - Public dashboard (no auth)
    - `admin.sitesspectral.work` - Global admin portal (CF Access)
    - `{station}.sitesspectral.work` - Station portals (CF Access/Magic Link)

    ## Standards Alignment
    - Darwin Core (biodiversity data)
    - ICOS (carbon observation)
    - Copernicus (Earth observation)
  version: 15.6.4
  contact:
    name: SITES Spectral Support
    url: https://www.fieldsites.se/
  license:
    name: CC-BY-4.0
    url: https://creativecommons.org/licenses/by/4.0/

servers:
  - url: https://sitesspectral.work/api/v11
    description: Production API (v15.0.0+)
  - url: https://admin.sitesspectral.work/api/v11
    description: Admin Portal API
  - url: https://sites.jobelab.com/api/v11
    description: Legacy Production API
  - url: https://sites-spectral-instruments.jose-beltran.workers.dev/api/v11
    description: Cloudflare Workers API
  - url: http://localhost:8787/api/v11
    description: Local development

tags:
  - name: Authentication
    description: Login, logout, and token verification
  - name: Magic Links
    description: Passwordless authentication via time-limited tokens (v15.0.0+)
  - name: Public API
    description: No-authentication endpoints for public dashboard (v15.0.0+)
  - name: Stations
    description: Research station management
  - name: Platforms
    description: Observation platform management (Fixed, UAV, Satellite)
  - name: Instruments
    description: Scientific instrument management
  - name: Maintenance
    description: Maintenance record management
  - name: Calibrations
    description: Calibration record management
  - name: ROIs
    description: Regions of Interest management
  - name: AOIs
    description: Areas of Interest management (GeoJSON/KML)
  - name: Campaigns
    description: Field campaign management
  - name: Products
    description: Data product management
  - name: Users
    description: User management (admin only)
  - name: Analytics
    description: Analytics and statistics
  - name: Export
    description: Data export functionality
  - name: Admin
    description: Administration endpoints
  - name: System
    description: Health checks and system info
  - name: UAV Pilots
    description: UAV pilot registration and certification management (v15.0.0+)
  - name: UAV Missions
    description: UAV mission planning and execution workflow (v15.0.0+)
  - name: UAV Flight Logs
    description: UAV flight logging and telemetry (v15.0.0+)
  - name: UAV Batteries
    description: UAV battery inventory and health tracking (v15.0.0+)

security:
  - BearerAuth: []
  - CookieAuth: []

paths:
  # ============================================
  # AUTHENTICATION ENDPOINTS
  # ============================================
  /auth/login:
    post:
      tags: [Authentication]
      summary: Authenticate user
      description: Login with username and password. Returns JWT token.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          headers:
            Set-Cookie:
              description: HTTP-only authentication cookie
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'

  /auth/verify:
    get:
      tags: [Authentication]
      summary: Verify token
      description: Verify current authentication token and return user info.
      responses:
        '200':
          description: Token valid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VerifyResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/me:
    get:
      tags: [Authentication]
      summary: Get current user
      description: Alias for /auth/verify - returns current user info.
      responses:
        '200':
          description: User info
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VerifyResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/logout:
    post:
      tags: [Authentication]
      summary: Logout
      description: Invalidate current session and clear authentication cookie.
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Logged out successfully

  # ============================================
  # MAGIC LINKS ENDPOINTS (v15.0.0+)
  # ============================================
  /magic-links/create:
    post:
      tags: [Magic Links]
      summary: Create magic link
      description: |
        Create a time-limited, single-use authentication token for station internal users.
        Requires admin or station-admin role.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MagicLinkCreate'
      responses:
        '201':
          description: Magic link created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MagicLinkCreateResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /magic-links/validate:
    get:
      tags: [Magic Links]
      summary: Validate magic link
      description: Validate a magic link token and create a session if valid.
      security: []
      parameters:
        - name: token
          in: query
          required: true
          schema:
            type: string
          description: The magic link token
      responses:
        '200':
          description: Token valid, session created
          headers:
            Set-Cookie:
              description: HTTP-only authentication cookie
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MagicLinkValidateResponse'
        '400':
          description: Token expired, revoked, or already used
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Token not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /magic-links/revoke:
    post:
      tags: [Magic Links]
      summary: Revoke magic link
      description: Revoke a magic link token. Requires admin or station-admin role.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [token_id]
              properties:
                token_id:
                  type: integer
                  description: ID of the token to revoke
                reason:
                  type: string
                  description: Optional reason for revocation
      responses:
        '200':
          description: Token revoked
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /magic-links/list:
    get:
      tags: [Magic Links]
      summary: List magic links
      description: |
        List magic link tokens. Admins see all tokens, station-admins see only their station's tokens.
      parameters:
        - name: station_id
          in: query
          schema:
            type: integer
          description: Filter by station ID
        - name: include_revoked
          in: query
          schema:
            type: boolean
            default: false
          description: Include revoked tokens
        - name: include_expired
          in: query
          schema:
            type: boolean
            default: false
          description: Include expired tokens
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Token list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MagicLinkListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ============================================
  # PUBLIC API ENDPOINTS (v15.0.0+)
  # No authentication required
  # ============================================
  /public/health:
    get:
      tags: [Public API]
      summary: Public health check
      description: Public system health status with database connectivity and counts.
      security: []
      responses:
        '200':
          description: System healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublicHealthResponse'
        '503':
          description: System unhealthy

  /public/stations:
    get:
      tags: [Public API]
      summary: List public stations
      description: Get public information about all SITES research stations.
      security: []
      parameters:
        - name: sites_member
          in: query
          schema:
            type: boolean
          description: Filter to SITES member stations only
      responses:
        '200':
          description: Station list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublicStationsResponse'

  /public/station/{id}:
    get:
      tags: [Public API]
      summary: Get public station details
      description: Get public details for a specific station including platforms and instrument summary.
      security: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            oneOf:
              - type: integer
              - type: string
          description: Station ID or acronym
      responses:
        '200':
          description: Station details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublicStationDetailResponse'
        '404':
          $ref: '#/components/responses/NotFound'

  /public/metrics:
    get:
      tags: [Public API]
      summary: Get public metrics
      description: Get aggregated metrics about platforms and instruments.
      security: []
      responses:
        '200':
          description: Metrics data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublicMetricsResponse'

  # ============================================
  # STATION ENDPOINTS
  # ============================================
  /stations:
    get:
      tags: [Stations]
      summary: List all stations
      description: Get paginated list of research stations.
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/SortByParam'
        - $ref: '#/components/parameters/SortOrderParam'
      responses:
        '200':
          description: Station list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StationListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
    post:
      tags: [Stations]
      summary: Create station
      description: Create a new research station. Requires admin role.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StationCreate'
      responses:
        '201':
          description: Station created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /stations/{id}:
    get:
      tags: [Stations]
      summary: Get station
      description: Get station by ID or acronym.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            oneOf:
              - type: integer
                description: Numeric ID
              - type: string
                description: Station acronym (e.g., SVB, ANS)
      responses:
        '200':
          description: Station details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StationResponse'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags: [Stations]
      summary: Update station
      description: Update station details. Requires admin role.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StationUpdate'
      responses:
        '200':
          description: Station updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StationResponse'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [Stations]
      summary: Delete station
      description: Delete station. Requires admin role with delete permission.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Station deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'

  /stations/{acronym}/dashboard:
    get:
      tags: [Stations]
      summary: Get station dashboard
      description: Get comprehensive dashboard data for a station including platforms, instruments, and recent activity.
      parameters:
        - name: acronym
          in: path
          required: true
          schema:
            type: string
            example: SVB
      responses:
        '200':
          description: Dashboard data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StationDashboardResponse'
        '404':
          $ref: '#/components/responses/NotFound'

  # ============================================
  # PLATFORM ENDPOINTS
  # ============================================
  /platforms:
    get:
      tags: [Platforms]
      summary: List all platforms
      description: Get paginated list of observation platforms.
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: station
          in: query
          schema:
            type: string
          description: Filter by station acronym (e.g., SVB)
        - name: station_id
          in: query
          schema:
            type: integer
          description: Filter by station ID (legacy)
        - name: platform_type
          in: query
          schema:
            $ref: '#/components/schemas/PlatformType'
        - name: ecosystem_code
          in: query
          schema:
            $ref: '#/components/schemas/EcosystemCode'
      responses:
        '200':
          description: Platform list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlatformListResponse'
    post:
      tags: [Platforms]
      summary: Create platform
      description: Create a new observation platform. UAV platforms auto-create instruments.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PlatformCreate'
      responses:
        '201':
          description: Platform created (with auto-created instruments for UAV)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlatformCreateResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

  /platforms/{id}:
    get:
      tags: [Platforms]
      summary: Get platform
      description: Get platform by ID or normalized name.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            oneOf:
              - type: integer
              - type: string
      responses:
        '200':
          description: Platform details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlatformResponse'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags: [Platforms]
      summary: Update platform
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PlatformUpdate'
      responses:
        '200':
          description: Platform updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlatformResponse'
    delete:
      tags: [Platforms]
      summary: Delete platform
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Platform deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteResponse'

  /platforms/station/{stationId}:
    get:
      tags: [Platforms]
      summary: Get platforms by station
      parameters:
        - name: stationId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Platform list for station
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlatformListResponse'

  /platforms/type/{type}:
    get:
      tags: [Platforms]
      summary: Get platforms by type
      parameters:
        - name: type
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/PlatformType'
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Platform list by type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlatformListResponse'

  # ============================================
  # INSTRUMENT ENDPOINTS
  # ============================================
  /instruments:
    get:
      tags: [Instruments]
      summary: List all instruments
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: station
          in: query
          schema:
            type: string
          description: Filter by station acronym
        - name: platform_id
          in: query
          schema:
            type: integer
        - name: instrument_type
          in: query
          schema:
            $ref: '#/components/schemas/InstrumentType'
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/Status'
      responses:
        '200':
          description: Instrument list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstrumentListResponse'
    post:
      tags: [Instruments]
      summary: Create instrument
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InstrumentCreate'
      responses:
        '201':
          description: Instrument created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstrumentResponse'

  /instruments/{id}:
    get:
      tags: [Instruments]
      summary: Get instrument
      parameters:
        - name: id
          in: path
          required: true
          schema:
            oneOf:
              - type: integer
              - type: string
      responses:
        '200':
          description: Instrument details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstrumentResponse'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags: [Instruments]
      summary: Update instrument
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InstrumentUpdate'
      responses:
        '200':
          description: Instrument updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstrumentResponse'
    delete:
      tags: [Instruments]
      summary: Delete instrument
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: cascade
          in: query
          schema:
            type: boolean
            default: false
          description: Delete related records (calibrations, ROIs, etc.)
      responses:
        '200':
          description: Instrument deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteResponse'

  /instruments/{id}/details:
    get:
      tags: [Instruments]
      summary: Get instrument with full details
      description: Get instrument with all related data (calibrations, ROIs, maintenance).
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Instrument with full details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstrumentDetailsResponse'

  /instruments/platform/{platformId}:
    get:
      tags: [Instruments]
      summary: Get instruments by platform
      parameters:
        - name: platformId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Instruments for platform
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstrumentListResponse'

  /instruments/station/{stationId}:
    get:
      tags: [Instruments]
      summary: Get instruments by station
      parameters:
        - name: stationId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Instruments for station
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstrumentListResponse'

  # ============================================
  # MAINTENANCE ENDPOINTS
  # ============================================
  /maintenance:
    get:
      tags: [Maintenance]
      summary: List maintenance records
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Maintenance record list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MaintenanceListResponse'
    post:
      tags: [Maintenance]
      summary: Create maintenance record
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MaintenanceCreate'
      responses:
        '201':
          description: Maintenance record created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MaintenanceResponse'

  /maintenance/timeline:
    get:
      tags: [Maintenance]
      summary: Get maintenance timeline
      description: Get timeline of maintenance activities for an entity.
      parameters:
        - name: entity_type
          in: query
          required: true
          schema:
            type: string
            enum: [platform, instrument]
        - name: entity_id
          in: query
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Maintenance timeline
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MaintenanceTimelineResponse'

  /maintenance/pending:
    get:
      tags: [Maintenance]
      summary: Get pending maintenance
      responses:
        '200':
          description: Pending maintenance records
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MaintenanceListResponse'

  /maintenance/overdue:
    get:
      tags: [Maintenance]
      summary: Get overdue maintenance
      responses:
        '200':
          description: Overdue maintenance records
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MaintenanceListResponse'

  /maintenance/{id}:
    get:
      tags: [Maintenance]
      summary: Get maintenance record
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Maintenance record
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MaintenanceResponse'
    put:
      tags: [Maintenance]
      summary: Update maintenance record
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MaintenanceUpdate'
      responses:
        '200':
          description: Maintenance record updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MaintenanceResponse'
    delete:
      tags: [Maintenance]
      summary: Delete maintenance record
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Maintenance record deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteResponse'

  /maintenance/{id}/complete:
    post:
      tags: [Maintenance]
      summary: Complete maintenance
      description: Mark a maintenance task as completed.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                completion_notes:
                  type: string
      responses:
        '200':
          description: Maintenance completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MaintenanceResponse'

  # ============================================
  # CALIBRATION ENDPOINTS
  # ============================================
  /calibrations:
    get:
      tags: [Calibrations]
      summary: List calibration records
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Calibration record list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CalibrationListResponse'
    post:
      tags: [Calibrations]
      summary: Create calibration record
      description: Create calibration record (multispectral/hyperspectral instruments only).
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CalibrationCreate'
      responses:
        '201':
          description: Calibration record created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CalibrationResponse'

  /calibrations/timeline:
    get:
      tags: [Calibrations]
      summary: Get calibration timeline
      parameters:
        - name: instrument_id
          in: query
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Calibration timeline
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CalibrationTimelineResponse'

  /calibrations/current:
    get:
      tags: [Calibrations]
      summary: Get current calibration
      parameters:
        - name: instrument_id
          in: query
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Current calibration
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CalibrationResponse'

  /calibrations/expired:
    get:
      tags: [Calibrations]
      summary: Get expired calibrations
      responses:
        '200':
          description: Expired calibrations
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CalibrationListResponse'

  /calibrations/expiring:
    get:
      tags: [Calibrations]
      summary: Get expiring calibrations
      parameters:
        - name: days
          in: query
          schema:
            type: integer
            default: 30
          description: Days until expiration
      responses:
        '200':
          description: Expiring calibrations
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CalibrationListResponse'

  /calibrations/{id}:
    get:
      tags: [Calibrations]
      summary: Get calibration record
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Calibration record
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CalibrationResponse'
    put:
      tags: [Calibrations]
      summary: Update calibration record
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CalibrationUpdate'
      responses:
        '200':
          description: Calibration record updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CalibrationResponse'
    delete:
      tags: [Calibrations]
      summary: Delete calibration record
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Calibration record deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteResponse'

  /calibrations/{id}/expire:
    post:
      tags: [Calibrations]
      summary: Expire calibration
      description: Mark a calibration as expired.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Calibration expired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CalibrationResponse'

  # ============================================
  # ROI ENDPOINTS
  # ============================================
  /rois:
    get:
      tags: [ROIs]
      summary: List ROIs
      parameters:
        - name: instrument_id
          in: query
          schema:
            type: integer
        - name: include_legacy
          in: query
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: ROI list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ROIListResponse'
    post:
      tags: [ROIs]
      summary: Create ROI
      description: Create a new Region of Interest. Station users create new ROIs; legacy system marks old as replaced.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ROICreate'
      responses:
        '201':
          description: ROI created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ROIResponse'

  /rois/{id}:
    get:
      tags: [ROIs]
      summary: Get ROI
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: ROI details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ROIResponse'
    put:
      tags: [ROIs]
      summary: Update ROI
      description: Update ROI. Super admins can override with warning.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ROIUpdate'
      responses:
        '200':
          description: ROI updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ROIResponse'
    delete:
      tags: [ROIs]
      summary: Delete ROI
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: ROI deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteResponse'

  # ============================================
  # UAV PILOT ENDPOINTS (v15.0.0+)
  # ============================================
  /uav/pilots:
    get:
      tags: [UAV Pilots]
      summary: List UAV pilots
      description: Get all registered UAV pilots. Filter by station or certification status.
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: station_id
          in: query
          schema:
            type: integer
          description: Filter by authorized station
        - name: status
          in: query
          schema:
            type: string
            enum: [active, inactive, suspended, pending_verification]
          description: Filter by pilot status
      responses:
        '200':
          description: Pilot list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PilotListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
    post:
      tags: [UAV Pilots]
      summary: Register new pilot
      description: Register a new UAV pilot. Requires admin or station-admin role.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PilotCreate'
      responses:
        '201':
          description: Pilot registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PilotResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /uav/pilots/{id}:
    get:
      tags: [UAV Pilots]
      summary: Get pilot details
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Pilot details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PilotResponse'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags: [UAV Pilots]
      summary: Update pilot
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PilotUpdate'
      responses:
        '200':
          description: Pilot updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PilotResponse'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [UAV Pilots]
      summary: Deactivate pilot
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Pilot deactivated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteResponse'

  /uav/pilots/{id}/authorize/{stationId}:
    post:
      tags: [UAV Pilots]
      summary: Authorize pilot for station
      description: Add station to pilot's authorized stations list.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: stationId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Authorization added
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PilotResponse'

  /uav/pilots/{id}/flights:
    get:
      tags: [UAV Pilots]
      summary: Get pilot's flight history
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Flight history
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FlightLogListResponse'

  # ============================================
  # UAV MISSION ENDPOINTS (v15.0.0+)
  # ============================================
  /uav/missions:
    get:
      tags: [UAV Missions]
      summary: List missions
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: station_id
          in: query
          schema:
            type: integer
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/MissionStatus'
        - name: from_date
          in: query
          schema:
            type: string
            format: date
        - name: to_date
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Mission list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MissionListResponse'
    post:
      tags: [UAV Missions]
      summary: Create mission
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MissionCreate'
      responses:
        '201':
          description: Mission created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MissionResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

  /uav/missions/{id}:
    get:
      tags: [UAV Missions]
      summary: Get mission details
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Mission details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MissionResponse'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags: [UAV Missions]
      summary: Update mission
      description: Update mission details. Only allowed for draft/planned missions.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MissionUpdate'
      responses:
        '200':
          description: Mission updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MissionResponse'

  /uav/missions/{id}/approve:
    post:
      tags: [UAV Missions]
      summary: Approve mission
      description: Approve a planned mission. Requires station-admin or higher role.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                notes:
                  type: string
                  description: Approval notes
      responses:
        '200':
          description: Mission approved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MissionResponse'
        '400':
          description: Mission cannot be approved (wrong status)

  /uav/missions/{id}/start:
    post:
      tags: [UAV Missions]
      summary: Start mission execution
      description: Mark mission as in progress. Only allowed for approved missions.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                weather_conditions:
                  $ref: '#/components/schemas/WeatherConditions'
      responses:
        '200':
          description: Mission started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MissionResponse'

  /uav/missions/{id}/complete:
    post:
      tags: [UAV Missions]
      summary: Complete mission
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                images_captured:
                  type: integer
                data_collected_gb:
                  type: number
                coverage_achieved_percent:
                  type: number
                quality_score:
                  type: number
                  minimum: 0
                  maximum: 100
      responses:
        '200':
          description: Mission completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MissionResponse'

  /uav/missions/{id}/abort:
    post:
      tags: [UAV Missions]
      summary: Abort mission
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [reason]
              properties:
                reason:
                  type: string
                  description: Reason for aborting
      responses:
        '200':
          description: Mission aborted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MissionResponse'

  # ============================================
  # UAV FLIGHT LOG ENDPOINTS (v15.0.0+)
  # ============================================
  /uav/flight-logs:
    get:
      tags: [UAV Flight Logs]
      summary: List flight logs
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: mission_id
          in: query
          schema:
            type: integer
        - name: pilot_id
          in: query
          schema:
            type: integer
        - name: has_incident
          in: query
          schema:
            type: boolean
      responses:
        '200':
          description: Flight log list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FlightLogListResponse'
    post:
      tags: [UAV Flight Logs]
      summary: Log new flight
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FlightLogCreate'
      responses:
        '201':
          description: Flight logged
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FlightLogResponse'

  /uav/flight-logs/{id}:
    get:
      tags: [UAV Flight Logs]
      summary: Get flight details
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Flight details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FlightLogResponse'
    put:
      tags: [UAV Flight Logs]
      summary: Update flight log
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FlightLogUpdate'
      responses:
        '200':
          description: Flight updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FlightLogResponse'

  /uav/flight-logs/{id}/incident:
    post:
      tags: [UAV Flight Logs]
      summary: Report incident
      description: Report an incident that occurred during the flight.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [description, severity]
              properties:
                description:
                  type: string
                severity:
                  type: string
                  enum: [minor, moderate, major, critical]
      responses:
        '200':
          description: Incident reported
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FlightLogResponse'

  # ============================================
  # UAV BATTERY ENDPOINTS (v15.0.0+)
  # ============================================
  /uav/batteries:
    get:
      tags: [UAV Batteries]
      summary: List batteries
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: station_id
          in: query
          schema:
            type: integer
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/BatteryStatus'
        - name: needs_health_check
          in: query
          schema:
            type: boolean
      responses:
        '200':
          description: Battery list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatteryListResponse'
    post:
      tags: [UAV Batteries]
      summary: Register battery
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BatteryCreate'
      responses:
        '201':
          description: Battery registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatteryResponse'

  /uav/batteries/{id}:
    get:
      tags: [UAV Batteries]
      summary: Get battery details
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Battery details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatteryResponse'
    put:
      tags: [UAV Batteries]
      summary: Update battery
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BatteryUpdate'
      responses:
        '200':
          description: Battery updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatteryResponse'

  /uav/batteries/{id}/health-check:
    post:
      tags: [UAV Batteries]
      summary: Record health check
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [health_percent]
              properties:
                health_percent:
                  type: number
                  minimum: 0
                  maximum: 100
                internal_resistance_mohm:
                  type: number
      responses:
        '200':
          description: Health check recorded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatteryResponse'

  /uav/batteries/{id}/retire:
    post:
      tags: [UAV Batteries]
      summary: Retire battery
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
      responses:
        '200':
          description: Battery retired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatteryResponse'

  # ============================================
  # SYSTEM ENDPOINTS
  # ============================================
  /health:
    get:
      tags: [System]
      summary: Health check
      security: []
      responses:
        '200':
          description: System healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
        '503':
          description: System unhealthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /info:
    get:
      tags: [System]
      summary: API information
      security: []
      responses:
        '200':
          description: API information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InfoResponse'

  # ============================================
  # AOI ENDPOINTS (v15.6.4+)
  # ============================================
  /aois:
    get:
      tags: [AOIs]
      summary: List areas of interest
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: station_id
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: AOI list
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/AOI'
    post:
      tags: [AOIs]
      summary: Create area of interest
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AOICreate'
      responses:
        '201':
          description: AOI created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AOIResponse'

  /aois/{id}:
    get:
      tags: [AOIs]
      summary: Get AOI details
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: AOI details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AOIResponse'
    put:
      tags: [AOIs]
      summary: Update AOI
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AOIUpdate'
      responses:
        '200':
          description: AOI updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AOIResponse'
    delete:
      tags: [AOIs]
      summary: Delete AOI
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: AOI deleted

  /aois/station/{stationId}:
    get:
      tags: [AOIs]
      summary: Get AOIs by station
      parameters:
        - name: stationId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Station AOIs
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/AOI'

  /aois/export/geojson:
    get:
      tags: [AOIs]
      summary: Export AOIs as GeoJSON
      parameters:
        - name: station_id
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: GeoJSON export
          content:
            application/geo+json:
              schema:
                type: object

  /aois/import/geojson:
    post:
      tags: [AOIs]
      summary: Import AOIs from GeoJSON
      requestBody:
        required: true
        content:
          application/geo+json:
            schema:
              type: object
      responses:
        '201':
          description: AOIs imported

  /aois/import/kml:
    post:
      tags: [AOIs]
      summary: Import AOIs from KML
      requestBody:
        required: true
        content:
          application/vnd.google-earth.kml+xml:
            schema:
              type: string
      responses:
        '201':
          description: AOIs imported

  # ============================================
  # CAMPAIGN ENDPOINTS (v15.6.4+)
  # ============================================
  /campaigns:
    get:
      tags: [Campaigns]
      summary: List campaigns
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: station_id
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: Campaign list
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Campaign'
    post:
      tags: [Campaigns]
      summary: Create campaign
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CampaignCreate'
      responses:
        '201':
          description: Campaign created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignResponse'

  /campaigns/{id}:
    get:
      tags: [Campaigns]
      summary: Get campaign details
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Campaign details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignResponse'
    put:
      tags: [Campaigns]
      summary: Update campaign
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CampaignUpdate'
      responses:
        '200':
          description: Campaign updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignResponse'
    delete:
      tags: [Campaigns]
      summary: Delete campaign
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Campaign deleted

  /campaigns/station/{stationId}:
    get:
      tags: [Campaigns]
      summary: Get campaigns by station
      parameters:
        - name: stationId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Station campaigns
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Campaign'

  /campaigns/active:
    get:
      tags: [Campaigns]
      summary: Get active campaigns
      responses:
        '200':
          description: Active campaigns
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Campaign'

  /campaigns/{id}/start:
    post:
      tags: [Campaigns]
      summary: Start campaign
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Campaign started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignResponse'

  /campaigns/{id}/complete:
    post:
      tags: [Campaigns]
      summary: Complete campaign
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Campaign completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignResponse'

  # ============================================
  # PRODUCT ENDPOINTS (v15.6.4+)
  # ============================================
  /products:
    get:
      tags: [Products]
      summary: List data products
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: instrument_id
          in: query
          schema:
            type: integer
        - name: processing_level
          in: query
          schema:
            type: string
            enum: [L0, L1, L2, L3]
      responses:
        '200':
          description: Product list
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Product'
    post:
      tags: [Products]
      summary: Register data product
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductCreate'
      responses:
        '201':
          description: Product registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductResponse'

  /products/{id}:
    get:
      tags: [Products]
      summary: Get product details
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Product details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductResponse'
    put:
      tags: [Products]
      summary: Update product
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductUpdate'
      responses:
        '200':
          description: Product updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductResponse'
    delete:
      tags: [Products]
      summary: Delete product
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Product deleted

  /products/doi/{doi}:
    get:
      tags: [Products]
      summary: Get product by DOI
      parameters:
        - name: doi
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Product details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductResponse'

  /products/instrument/{instrumentId}:
    get:
      tags: [Products]
      summary: Get products by instrument
      parameters:
        - name: instrumentId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Instrument products
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Product'

  /products/campaign/{campaignId}:
    get:
      tags: [Products]
      summary: Get products by campaign
      parameters:
        - name: campaignId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Campaign products
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Product'

  /products/processing-level/{level}:
    get:
      tags: [Products]
      summary: Get products by processing level
      parameters:
        - name: level
          in: path
          required: true
          schema:
            type: string
            enum: [L0, L1, L2, L3]
      responses:
        '200':
          description: Products by level
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Product'

  /products/{id}/quality-score:
    post:
      tags: [Products]
      summary: Set product quality score
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                quality_score:
                  type: number
                  minimum: 0
                  maximum: 100
      responses:
        '200':
          description: Quality score set
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductResponse'

  /products/{id}/promote-quality:
    post:
      tags: [Products]
      summary: Promote product quality level
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Quality promoted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductResponse'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token in Authorization header
    CookieAuth:
      type: apiKey
      in: cookie
      name: sites_spectral_auth
      description: HTTP-only authentication cookie

  parameters:
    PageParam:
      name: page
      in: query
      schema:
        type: integer
        minimum: 1
        default: 1
      description: Page number for pagination
    LimitParam:
      name: limit
      in: query
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 25
      description: Items per page (max 100)
    SortByParam:
      name: sort_by
      in: query
      schema:
        type: string
      description: Field to sort by
    SortOrderParam:
      name: sort_order
      in: query
      schema:
        type: string
        enum: [asc, desc]
        default: asc
      description: Sort direction

  responses:
    BadRequest:
      description: Bad request - invalid input
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Unauthorized:
      description: Unauthorized - authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Forbidden:
      description: Forbidden - insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Conflict:
      description: Conflict - cannot perform operation
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    TooManyRequests:
      description: Rate limit exceeded
      headers:
        Retry-After:
          schema:
            type: integer
          description: Seconds until rate limit resets
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

  schemas:
    # ============================================
    # COMMON TYPES
    # ============================================
    PlatformType:
      type: string
      enum: [fixed, uav, satellite, mobile, usv, uuv]
      description: |
        Platform type:
        - fixed: Towers, masts, permanent installations
        - uav: Unmanned Aerial Vehicles (drones)
        - satellite: Earth observation satellites
        - mobile: Portable sensors (coming soon)
        - usv: Unmanned Surface Vehicles (coming soon)
        - uuv: Unmanned Underwater Vehicles (coming soon)

    MountTypeCode:
      type: string
      enum: [TWR, BLD, GND, UAV, SAT, MOB, USV, UUV]
      description: |
        Mount type code (v12.0.0+):
        - TWR: Tower/Mast (>1.5m height)
        - BLD: Building (rooftop/facade)
        - GND: Ground Level (<1.5m)
        - UAV: UAV Position
        - SAT: Satellite
        - MOB: Mobile
        - USV: Surface Vehicle
        - UUV: Underwater Vehicle

    EcosystemCode:
      type: string
      enum: [FOR, AGR, GRA, HEA, MIR, ALP, LAK, CON, WET, DEC, MAR, PEA]
      description: |
        Ecosystem code:
        - FOR: Forest
        - AGR: Arable Land
        - GRA: Grassland
        - HEA: Heathland
        - MIR: Mires
        - ALP: Alpine Forest
        - LAK: Lake
        - CON: Coniferous Forest
        - WET: Wetland
        - DEC: Deciduous Forest
        - MAR: Marshland
        - PEA: Peatland

    InstrumentType:
      type: string
      enum: [phenocam, multispectral, par, ndvi, pri, hyperspectral, rgb, thermal, lidar, sar]
      description: Instrument type

    Status:
      type: string
      enum: [Active, Inactive, Maintenance, Decommissioned]
      description: Entity status

    Pagination:
      type: object
      properties:
        page:
          type: integer
        limit:
          type: integer
        total:
          type: integer
        totalPages:
          type: integer

    # ============================================
    # ERROR RESPONSE
    # ============================================
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          example: Error message

    DeleteResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        deleted:
          type: boolean
          example: true

    # ============================================
    # AUTHENTICATION SCHEMAS
    # ============================================
    LoginRequest:
      type: object
      required: [username, password]
      properties:
        username:
          type: string
          example: svartberget-admin
        password:
          type: string
          format: password

    LoginResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        token:
          type: string
          description: JWT token (for backward compatibility)
        user:
          $ref: '#/components/schemas/User'

    VerifyResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        valid:
          type: boolean
          example: true
        user:
          $ref: '#/components/schemas/User'

    User:
      type: object
      properties:
        username:
          type: string
        role:
          type: string
          enum: [admin, station-admin, station, readonly]
        station_id:
          type: integer
          nullable: true
        station_acronym:
          type: string
          nullable: true
        station_normalized_name:
          type: string
          nullable: true
        edit_privileges:
          type: boolean
        permissions:
          type: array
          items:
            type: string
            enum: [read, write, edit, delete, admin]

    # ============================================
    # STATION SCHEMAS
    # ============================================
    Station:
      type: object
      properties:
        id:
          type: integer
        acronym:
          type: string
          example: SVB
        normalized_name:
          type: string
          example: svartberget
        display_name:
          type: string
          example: Svartberget Research Station
        description:
          type: string
        latitude:
          type: number
          format: float
          example: 64.2561
        longitude:
          type: number
          format: float
          example: 19.7745
        elevation_m:
          type: number
        status:
          $ref: '#/components/schemas/Status'
        country:
          type: string
          example: SE
        website_url:
          type: string
          format: uri
        contact_email:
          type: string
          format: email
        dwc_location_id:
          type: string
          description: Darwin Core location identifier
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    StationCreate:
      type: object
      required: [acronym, display_name]
      properties:
        acronym:
          type: string
          minLength: 2
          maxLength: 10
        display_name:
          type: string
        description:
          type: string
        latitude:
          type: number
        longitude:
          type: number
        website_url:
          type: string
          format: uri
        contact_email:
          type: string
          format: email

    StationUpdate:
      type: object
      properties:
        display_name:
          type: string
        description:
          type: string
        latitude:
          type: number
        longitude:
          type: number
        website_url:
          type: string
          format: uri
        contact_email:
          type: string
          format: email

    StationResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          $ref: '#/components/schemas/Station'

    StationListResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: array
          items:
            $ref: '#/components/schemas/Station'
        meta:
          $ref: '#/components/schemas/Pagination'

    StationDashboardResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            station:
              $ref: '#/components/schemas/Station'
            platforms:
              type: array
              items:
                $ref: '#/components/schemas/Platform'
            instruments:
              type: array
              items:
                $ref: '#/components/schemas/Instrument'
            statistics:
              type: object
              properties:
                platform_count:
                  type: integer
                instrument_count:
                  type: integer
                active_instruments:
                  type: integer

    # ============================================
    # PLATFORM SCHEMAS
    # ============================================
    Platform:
      type: object
      properties:
        id:
          type: integer
        station_id:
          type: integer
        normalized_name:
          type: string
          example: SVB_FOR_TWR01
        display_name:
          type: string
        platform_type:
          $ref: '#/components/schemas/PlatformType'
        ecosystem_code:
          $ref: '#/components/schemas/EcosystemCode'
        mount_type_code:
          $ref: '#/components/schemas/MountTypeCode'
        description:
          type: string
        latitude:
          type: number
        longitude:
          type: number
        status:
          $ref: '#/components/schemas/Status'
        vendor:
          type: string
          description: UAV vendor (DJI, MicaSense, etc.)
        model:
          type: string
          description: UAV model (M3M, P4M, etc.)
        agency:
          type: string
          description: Satellite agency (ESA, NASA, etc.)
        satellite:
          type: string
          description: Satellite name (S2A, Landsat-9, etc.)
        sensor:
          type: string
          description: Satellite sensor (MSI, OLI, etc.)
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    PlatformCreate:
      type: object
      required: [station_id, platform_type]
      properties:
        station_id:
          type: integer
        platform_type:
          $ref: '#/components/schemas/PlatformType'
        ecosystem_code:
          $ref: '#/components/schemas/EcosystemCode'
        mount_type_code:
          $ref: '#/components/schemas/MountTypeCode'
        display_name:
          type: string
        description:
          type: string
        latitude:
          type: number
        longitude:
          type: number
        vendor:
          type: string
        model:
          type: string
        agency:
          type: string
        satellite:
          type: string
        sensor:
          type: string

    PlatformUpdate:
      type: object
      properties:
        display_name:
          type: string
        description:
          type: string
        latitude:
          type: number
        longitude:
          type: number
        status:
          $ref: '#/components/schemas/Status'

    PlatformResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          $ref: '#/components/schemas/Platform'

    PlatformListResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: array
          items:
            $ref: '#/components/schemas/Platform'
        meta:
          $ref: '#/components/schemas/Pagination'

    PlatformCreateResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            platform:
              $ref: '#/components/schemas/Platform'
            instruments:
              type: array
              items:
                $ref: '#/components/schemas/Instrument'
              description: Auto-created instruments (for UAV platforms)

    # ============================================
    # INSTRUMENT SCHEMAS
    # ============================================
    Instrument:
      type: object
      properties:
        id:
          type: integer
        platform_id:
          type: integer
        normalized_name:
          type: string
          example: SVB_FOR_TWR01_PHE01
        display_name:
          type: string
        instrument_type:
          $ref: '#/components/schemas/InstrumentType'
        status:
          $ref: '#/components/schemas/Status'
        measurement_status:
          type: string
        description:
          type: string
        specifications:
          type: object
          description: Type-specific specifications
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    InstrumentCreate:
      type: object
      required: [platform_id, instrument_type]
      properties:
        platform_id:
          type: integer
        instrument_type:
          $ref: '#/components/schemas/InstrumentType'
        normalized_name:
          type: string
        display_name:
          type: string
        description:
          type: string
        status:
          $ref: '#/components/schemas/Status'
        specifications:
          type: object

    InstrumentUpdate:
      type: object
      properties:
        display_name:
          type: string
        description:
          type: string
        status:
          $ref: '#/components/schemas/Status'
        measurement_status:
          type: string
        specifications:
          type: object

    InstrumentResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          $ref: '#/components/schemas/Instrument'

    InstrumentListResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: array
          items:
            $ref: '#/components/schemas/Instrument'
        meta:
          $ref: '#/components/schemas/Pagination'

    InstrumentDetailsResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          allOf:
            - $ref: '#/components/schemas/Instrument'
            - type: object
              properties:
                calibrations:
                  type: array
                  items:
                    $ref: '#/components/schemas/Calibration'
                rois:
                  type: array
                  items:
                    $ref: '#/components/schemas/ROI'
                maintenance:
                  type: array
                  items:
                    $ref: '#/components/schemas/Maintenance'

    # ============================================
    # MAINTENANCE SCHEMAS
    # ============================================
    Maintenance:
      type: object
      properties:
        id:
          type: integer
        entity_type:
          type: string
          enum: [platform, instrument]
        entity_id:
          type: integer
        maintenance_type:
          type: string
        description:
          type: string
        scheduled_date:
          type: string
          format: date
        completed_date:
          type: string
          format: date-time
        status:
          type: string
          enum: [scheduled, in_progress, completed, overdue]
        notes:
          type: string
        created_at:
          type: string
          format: date-time

    MaintenanceCreate:
      type: object
      required: [entity_type, entity_id, maintenance_type]
      properties:
        entity_type:
          type: string
          enum: [platform, instrument]
        entity_id:
          type: integer
        maintenance_type:
          type: string
        description:
          type: string
        scheduled_date:
          type: string
          format: date
        notes:
          type: string

    MaintenanceUpdate:
      type: object
      properties:
        maintenance_type:
          type: string
        description:
          type: string
        scheduled_date:
          type: string
          format: date
        status:
          type: string
        notes:
          type: string

    MaintenanceResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/Maintenance'

    MaintenanceListResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: array
          items:
            $ref: '#/components/schemas/Maintenance'
        meta:
          $ref: '#/components/schemas/Pagination'

    MaintenanceTimelineResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            entity_type:
              type: string
            entity_id:
              type: integer
            timeline:
              type: array
              items:
                $ref: '#/components/schemas/Maintenance'

    # ============================================
    # CALIBRATION SCHEMAS
    # ============================================
    Calibration:
      type: object
      properties:
        id:
          type: integer
        instrument_id:
          type: integer
        calibration_date:
          type: string
          format: date
        expiry_date:
          type: string
          format: date
        status:
          type: string
          enum: [current, expired, superseded]
        calibrator:
          type: string
        panel_serial_number:
          type: string
        quality_score:
          type: number
        cloud_cover:
          type: string
        solar_elevation:
          type: number
        notes:
          type: string
        created_at:
          type: string
          format: date-time

    CalibrationCreate:
      type: object
      required: [instrument_id, calibration_date]
      properties:
        instrument_id:
          type: integer
        calibration_date:
          type: string
          format: date
        expiry_date:
          type: string
          format: date
        calibrator:
          type: string
        panel_serial_number:
          type: string
        quality_score:
          type: number
        cloud_cover:
          type: string
        solar_elevation:
          type: number
        notes:
          type: string

    CalibrationUpdate:
      type: object
      properties:
        calibration_date:
          type: string
          format: date
        expiry_date:
          type: string
          format: date
        calibrator:
          type: string
        panel_serial_number:
          type: string
        quality_score:
          type: number
        notes:
          type: string

    CalibrationResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/Calibration'

    CalibrationListResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: array
          items:
            $ref: '#/components/schemas/Calibration'
        meta:
          $ref: '#/components/schemas/Pagination'

    CalibrationTimelineResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            instrument_id:
              type: integer
            current:
              $ref: '#/components/schemas/Calibration'
            timeline:
              type: array
              items:
                $ref: '#/components/schemas/Calibration'

    # ============================================
    # ROI SCHEMAS
    # ============================================
    ROI:
      type: object
      properties:
        id:
          type: integer
        instrument_id:
          type: integer
        roi_name:
          type: string
          example: ROI_01
        polygon_points:
          type: string
          description: JSON array of [x, y] coordinates
        color:
          type: string
          example: '#FF5733'
        description:
          type: string
        vegetation_type:
          type: string
        is_legacy:
          type: boolean
        legacy_date:
          type: string
          format: date-time
        replaced_by_roi_id:
          type: integer
        timeseries_broken:
          type: boolean
        legacy_reason:
          type: string
        created_at:
          type: string
          format: date-time

    ROICreate:
      type: object
      required: [instrument_id, polygon_points]
      properties:
        instrument_id:
          type: integer
        roi_name:
          type: string
        polygon_points:
          type: string
        color:
          type: string
        description:
          type: string
        vegetation_type:
          type: string

    ROIUpdate:
      type: object
      properties:
        polygon_points:
          type: string
        color:
          type: string
        description:
          type: string
        vegetation_type:
          type: string
        is_legacy:
          type: boolean
        legacy_reason:
          type: string

    ROIResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/ROI'

    ROIListResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: array
          items:
            $ref: '#/components/schemas/ROI'

    # ============================================
    # SYSTEM SCHEMAS
    # ============================================
    HealthResponse:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, unhealthy]
        timestamp:
          type: string
          format: date-time
        version:
          type: string
        database:
          type: string
          enum: [connected, disconnected]
        architecture:
          type: string
          example: hexagonal
        api:
          type: object
          properties:
            current:
              type: string
            aliases:
              type: object
            supported:
              type: array
              items:
                type: string
        features:
          type: array
          items:
            type: string

    InfoResponse:
      type: object
      properties:
        name:
          type: string
        version:
          type: string
        architecture:
          type: string
        description:
          type: string
        patterns:
          type: array
          items:
            type: string
        standards:
          type: object
        endpoints:
          type: object
        mountTypeCodes:
          type: object
        processingLevels:
          type: object
        qualityControlLevels:
          type: object

    # ============================================
    # MAGIC LINKS SCHEMAS (v15.0.0+)
    # ============================================
    MagicLinkCreate:
      type: object
      required: [station_id]
      properties:
        station_id:
          type: integer
          description: Station to grant access to
        label:
          type: string
          description: Optional label for identification
        role:
          type: string
          enum: [station-internal, readonly]
          default: station-internal
          description: Role for the magic link user
        expiry_hours:
          type: integer
          minimum: 1
          maximum: 168
          default: 168
          description: Token expiry in hours (max 7 days)
        single_use:
          type: boolean
          default: false
          description: If true, token can only be used once

    MagicLinkCreateResponse:
      type: object
      properties:
        success:
          type: boolean
        token:
          type: string
          description: The magic link token (only returned once)
        token_id:
          type: integer
          description: Token ID for management
        expires_at:
          type: string
          format: date-time
        magic_link_url:
          type: string
          format: uri
          description: Full URL for the magic link

    MagicLinkValidateResponse:
      type: object
      properties:
        success:
          type: boolean
        user:
          $ref: '#/components/schemas/User'
        station:
          type: object
          properties:
            id:
              type: integer
            acronym:
              type: string
            display_name:
              type: string

    MagicLink:
      type: object
      properties:
        id:
          type: integer
        station_id:
          type: integer
        station_acronym:
          type: string
        label:
          type: string
        role:
          type: string
        created_at:
          type: string
          format: date-time
        expires_at:
          type: string
          format: date-time
        single_use:
          type: boolean
        used_at:
          type: string
          format: date-time
          nullable: true
        revoked_at:
          type: string
          format: date-time
          nullable: true
        revoked_reason:
          type: string
          nullable: true
        created_by:
          type: string

    MagicLinkListResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: array
          items:
            $ref: '#/components/schemas/MagicLink'
        meta:
          $ref: '#/components/schemas/Pagination'

    # ============================================
    # PUBLIC API SCHEMAS (v15.0.0+)
    # ============================================
    PublicHealthResponse:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
        timestamp:
          type: string
          format: date-time
        database:
          type: string
          enum: [connected, disconnected]
        version:
          type: string
        counts:
          type: object
          properties:
            stations:
              type: integer
            platforms:
              type: integer
            instruments:
              type: integer

    PublicStation:
      type: object
      properties:
        id:
          type: integer
        acronym:
          type: string
        display_name:
          type: string
        description:
          type: string
        latitude:
          type: number
        longitude:
          type: number
        elevation_m:
          type: number
          nullable: true
        status:
          type: string
        country:
          type: string
        sites_member:
          type: boolean
        icos_member:
          type: boolean
        icos_class:
          type: string
          nullable: true
        platform_count:
          type: integer
        instrument_count:
          type: integer
        portal_url:
          type: string
          format: uri
        operational_status:
          type: string
          enum: [operational, pending, offline, unknown]

    PublicStationsResponse:
      type: object
      properties:
        success:
          type: boolean
        count:
          type: integer
        stations:
          type: array
          items:
            $ref: '#/components/schemas/PublicStation'

    PublicStationDetailResponse:
      type: object
      properties:
        success:
          type: boolean
        station:
          $ref: '#/components/schemas/PublicStation'
        platforms:
          type: array
          items:
            type: object
            properties:
              id:
                type: integer
              normalized_name:
                type: string
              display_name:
                type: string
              mount_type_code:
                type: string
              status:
                type: string
              instrument_count:
                type: integer
        instrument_summary:
          type: object
          additionalProperties:
            type: integer
          description: Count of instruments by type

    PublicMetricsResponse:
      type: object
      properties:
        success:
          type: boolean
        timestamp:
          type: string
          format: date-time
        metrics:
          type: object
          properties:
            platforms_by_type:
              type: object
              additionalProperties:
                type: integer
            instruments_by_type:
              type: object
              additionalProperties:
                type: integer
            stations_by_status:
              type: object
              additionalProperties:
                type: integer
            active_instruments:
              type: integer

    # ============================================
    # UAV PILOT SCHEMAS (v15.0.0+)
    # ============================================
    PilotStatus:
      type: string
      enum: [active, inactive, suspended, pending_verification]
      description: Pilot status

    CertificateType:
      type: string
      enum: ['A1/A3', 'A2', 'STS-01', 'STS-02', 'national']
      description: Swedish Transport Agency certificate type

    Pilot:
      type: object
      properties:
        id:
          type: integer
        user_id:
          type: integer
          description: Linked user account ID
        full_name:
          type: string
        email:
          type: string
          format: email
        phone:
          type: string
        organization:
          type: string
        pilot_certificate_number:
          type: string
        certificate_type:
          $ref: '#/components/schemas/CertificateType'
        certificate_issued_date:
          type: string
          format: date
        certificate_expiry_date:
          type: string
          format: date
        insurance_provider:
          type: string
        insurance_policy_number:
          type: string
        insurance_expiry_date:
          type: string
          format: date
        flight_hours_total:
          type: number
        flight_hours_sites_spectral:
          type: number
        last_flight_date:
          type: string
          format: date
        authorized_stations:
          type: array
          items:
            type: integer
        status:
          $ref: '#/components/schemas/PilotStatus'
        notes:
          type: string
        can_fly:
          type: boolean
          description: Computed - all requirements met
        certificate_valid:
          type: boolean
          description: Computed - certificate not expired
        insurance_valid:
          type: boolean
          description: Computed - insurance not expired
        days_until_certificate_expiry:
          type: integer
          nullable: true
        days_until_insurance_expiry:
          type: integer
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    PilotCreate:
      type: object
      required: [full_name, email]
      properties:
        full_name:
          type: string
        email:
          type: string
          format: email
        phone:
          type: string
        organization:
          type: string
        pilot_certificate_number:
          type: string
        certificate_type:
          $ref: '#/components/schemas/CertificateType'
        certificate_issued_date:
          type: string
          format: date
        certificate_expiry_date:
          type: string
          format: date
        insurance_provider:
          type: string
        insurance_policy_number:
          type: string
        insurance_expiry_date:
          type: string
          format: date
        authorized_stations:
          type: array
          items:
            type: integer
        status:
          $ref: '#/components/schemas/PilotStatus'

    PilotUpdate:
      type: object
      properties:
        full_name:
          type: string
        email:
          type: string
          format: email
        phone:
          type: string
        organization:
          type: string
        pilot_certificate_number:
          type: string
        certificate_type:
          $ref: '#/components/schemas/CertificateType'
        certificate_issued_date:
          type: string
          format: date
        certificate_expiry_date:
          type: string
          format: date
        insurance_provider:
          type: string
        insurance_policy_number:
          type: string
        insurance_expiry_date:
          type: string
          format: date
        authorized_stations:
          type: array
          items:
            type: integer
        status:
          $ref: '#/components/schemas/PilotStatus'

    PilotResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/Pilot'

    PilotListResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: array
          items:
            $ref: '#/components/schemas/Pilot'
        meta:
          $ref: '#/components/schemas/Pagination'

    # ============================================
    # UAV MISSION SCHEMAS (v15.0.0+)
    # ============================================
    MissionStatus:
      type: string
      enum: [draft, planned, approved, in_progress, completed, aborted, cancelled]
      description: Mission lifecycle status

    FlightPattern:
      type: string
      enum: [grid, crosshatch, perimeter, point_of_interest, custom]
      description: Flight pattern type

    WeatherConditions:
      type: object
      properties:
        temperature_c:
          type: number
        humidity_percent:
          type: number
        wind_speed_ms:
          type: number
        wind_direction:
          type: string
        cloud_cover:
          type: string
          enum: [clear, scattered, broken, overcast, intermittent]
        visibility_km:
          type: number
        precipitation:
          type: boolean

    Mission:
      type: object
      properties:
        id:
          type: integer
        mission_code:
          type: string
          description: Auto-generated code (e.g., SVB_2026-01-26_001)
        display_name:
          type: string
        station_id:
          type: integer
        platform_id:
          type: integer
        station_acronym:
          type: string
        planned_date:
          type: string
          format: date
        planned_start_time:
          type: string
        planned_end_time:
          type: string
        planned_area_hectares:
          type: number
        planned_altitude_m:
          type: number
        planned_flight_pattern:
          $ref: '#/components/schemas/FlightPattern'
        planned_overlap_side:
          type: integer
          description: Side overlap percentage
        planned_overlap_front:
          type: integer
          description: Front overlap percentage
        objectives:
          type: array
          items:
            type: string
        target_products:
          type: array
          items:
            type: string
        status:
          $ref: '#/components/schemas/MissionStatus'
        actual_start_time:
          type: string
          format: date-time
        actual_end_time:
          type: string
          format: date-time
        weather_conditions:
          $ref: '#/components/schemas/WeatherConditions'
        weather_source:
          type: string
        flight_area_geojson:
          type: object
          description: GeoJSON polygon of flight area
        approved_by_user_id:
          type: integer
        approved_at:
          type: string
          format: date-time
        approval_notes:
          type: string
        data_collected_gb:
          type: number
        images_captured:
          type: integer
        coverage_achieved_percent:
          type: number
        quality_score:
          type: number
          minimum: 0
          maximum: 100
        notes:
          type: string
        is_planning:
          type: boolean
          description: Computed - in draft/planned state
        is_approved:
          type: boolean
          description: Computed - has been approved
        is_active:
          type: boolean
          description: Computed - approved or in_progress
        can_start:
          type: boolean
          description: Computed - can be started
        actual_duration_minutes:
          type: integer
          nullable: true
          description: Computed - actual duration
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    MissionCreate:
      type: object
      required: [station_id, planned_date]
      properties:
        station_id:
          type: integer
        platform_id:
          type: integer
        display_name:
          type: string
        planned_date:
          type: string
          format: date
        planned_start_time:
          type: string
        planned_end_time:
          type: string
        planned_area_hectares:
          type: number
        planned_altitude_m:
          type: number
        planned_flight_pattern:
          $ref: '#/components/schemas/FlightPattern'
        planned_overlap_side:
          type: integer
        planned_overlap_front:
          type: integer
        objectives:
          type: array
          items:
            type: string
        target_products:
          type: array
          items:
            type: string
        flight_area_geojson:
          type: object

    MissionUpdate:
      type: object
      properties:
        display_name:
          type: string
        planned_date:
          type: string
          format: date
        planned_start_time:
          type: string
        planned_end_time:
          type: string
        planned_area_hectares:
          type: number
        planned_altitude_m:
          type: number
        planned_flight_pattern:
          $ref: '#/components/schemas/FlightPattern'
        planned_overlap_side:
          type: integer
        planned_overlap_front:
          type: integer
        objectives:
          type: array
          items:
            type: string
        target_products:
          type: array
          items:
            type: string
        flight_area_geojson:
          type: object
        notes:
          type: string

    MissionResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/Mission'

    MissionListResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: array
          items:
            $ref: '#/components/schemas/Mission'
        meta:
          $ref: '#/components/schemas/Pagination'

    # ============================================
    # UAV FLIGHT LOG SCHEMAS (v15.0.0+)
    # ============================================
    IncidentSeverity:
      type: string
      enum: [minor, moderate, major, critical]
      description: Incident severity level

    FlightLog:
      type: object
      properties:
        id:
          type: integer
        mission_id:
          type: integer
        pilot_id:
          type: integer
        platform_id:
          type: integer
        flight_number:
          type: integer
          description: Flight number within mission
        takeoff_time:
          type: string
          format: date-time
        landing_time:
          type: string
          format: date-time
        flight_duration_seconds:
          type: integer
        takeoff_latitude:
          type: number
        takeoff_longitude:
          type: number
        takeoff_altitude_m:
          type: number
        max_altitude_agl_m:
          type: number
          description: Maximum altitude above ground level
        max_distance_m:
          type: number
          description: Maximum distance from takeoff point
        total_distance_m:
          type: number
          description: Total distance flown
        average_speed_ms:
          type: number
        battery_id:
          type: integer
        battery_start_percent:
          type: integer
        battery_end_percent:
          type: integer
        images_captured:
          type: integer
        data_size_mb:
          type: number
        telemetry_file_path:
          type: string
        telemetry_file_hash:
          type: string
        had_incident:
          type: boolean
        incident_description:
          type: string
        incident_severity:
          $ref: '#/components/schemas/IncidentSeverity'
        notes:
          type: string
        formatted_duration:
          type: string
          description: Computed - HH:MM:SS format
        battery_usage:
          type: integer
          nullable: true
          description: Computed - percentage used
        data_rate_mb_per_min:
          type: number
          nullable: true
          description: Computed - data rate
        has_severe_incident:
          type: boolean
          description: Computed - major or critical incident
        pilot_name:
          type: string
          description: From join
        platform_name:
          type: string
          description: From join
        mission_code:
          type: string
          description: From join
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    FlightLogCreate:
      type: object
      required: [mission_id, pilot_id, platform_id, takeoff_time, landing_time]
      properties:
        mission_id:
          type: integer
        pilot_id:
          type: integer
        platform_id:
          type: integer
        takeoff_time:
          type: string
          format: date-time
        landing_time:
          type: string
          format: date-time
        takeoff_latitude:
          type: number
        takeoff_longitude:
          type: number
        takeoff_altitude_m:
          type: number
        max_altitude_agl_m:
          type: number
        max_distance_m:
          type: number
        total_distance_m:
          type: number
        average_speed_ms:
          type: number
        battery_id:
          type: integer
        battery_start_percent:
          type: integer
        battery_end_percent:
          type: integer
        images_captured:
          type: integer
        data_size_mb:
          type: number
        telemetry_file_path:
          type: string
        telemetry_file_hash:
          type: string
        notes:
          type: string

    FlightLogUpdate:
      type: object
      properties:
        takeoff_time:
          type: string
          format: date-time
        landing_time:
          type: string
          format: date-time
        max_altitude_agl_m:
          type: number
        max_distance_m:
          type: number
        total_distance_m:
          type: number
        average_speed_ms:
          type: number
        images_captured:
          type: integer
        data_size_mb:
          type: number
        telemetry_file_path:
          type: string
        notes:
          type: string

    FlightLogResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/FlightLog'

    FlightLogListResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: array
          items:
            $ref: '#/components/schemas/FlightLog'
        meta:
          $ref: '#/components/schemas/Pagination'

    # ============================================
    # UAV BATTERY SCHEMAS (v15.0.0+)
    # ============================================
    BatteryStatus:
      type: string
      enum: [available, in_use, charging, storage, maintenance, retired, damaged]
      description: Battery status

    BatteryChemistry:
      type: string
      enum: [LiPo, LiHV, LiIon, other]
      description: Battery chemistry type

    Battery:
      type: object
      properties:
        id:
          type: integer
        serial_number:
          type: string
        display_name:
          type: string
        manufacturer:
          type: string
        model:
          type: string
        capacity_mah:
          type: integer
        cell_count:
          type: integer
        chemistry:
          $ref: '#/components/schemas/BatteryChemistry'
        station_id:
          type: integer
        platform_id:
          type: integer
        station_acronym:
          type: string
          description: From join
        platform_name:
          type: string
          description: From join
        purchase_date:
          type: string
          format: date
        first_use_date:
          type: string
          format: date
        last_use_date:
          type: string
          format: date
        cycle_count:
          type: integer
        health_percent:
          type: number
          minimum: 0
          maximum: 100
        internal_resistance_mohm:
          type: number
        last_health_check_date:
          type: string
          format: date
        status:
          $ref: '#/components/schemas/BatteryStatus'
        storage_voltage_v:
          type: number
        notes:
          type: string
        is_available:
          type: boolean
          description: Computed
        is_retired:
          type: boolean
          description: Computed
        needs_health_check:
          type: boolean
          description: Computed - older than 30 days
        has_low_health:
          type: boolean
          description: Computed - below 80%
        age_days:
          type: integer
          nullable: true
          description: Computed
        days_since_last_use:
          type: integer
          nullable: true
          description: Computed
        cell_configuration:
          type: string
          nullable: true
          description: Computed - e.g., "4S"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    BatteryCreate:
      type: object
      required: [serial_number]
      properties:
        serial_number:
          type: string
        display_name:
          type: string
        manufacturer:
          type: string
        model:
          type: string
        capacity_mah:
          type: integer
        cell_count:
          type: integer
        chemistry:
          $ref: '#/components/schemas/BatteryChemistry'
        station_id:
          type: integer
        platform_id:
          type: integer
        purchase_date:
          type: string
          format: date
        status:
          $ref: '#/components/schemas/BatteryStatus'

    BatteryUpdate:
      type: object
      properties:
        display_name:
          type: string
        manufacturer:
          type: string
        model:
          type: string
        capacity_mah:
          type: integer
        cell_count:
          type: integer
        chemistry:
          $ref: '#/components/schemas/BatteryChemistry'
        station_id:
          type: integer
        platform_id:
          type: integer
        status:
          $ref: '#/components/schemas/BatteryStatus'
        notes:
          type: string

    BatteryResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/Battery'

    BatteryListResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: array
          items:
            $ref: '#/components/schemas/Battery'
        meta:
          $ref: '#/components/schemas/Pagination'

    # ============================================
    # AOI SCHEMAS (v15.6.4+)
    # ============================================
    AOI:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        description:
          type: string
        geometry:
          type: object
          description: GeoJSON geometry object
        geometry_type:
          type: string
          enum: [point, polygon, multipolygon]
        station_id:
          type: integer
        ecosystem_code:
          $ref: '#/components/schemas/EcosystemCode'
        platform_type_code:
          $ref: '#/components/schemas/PlatformType'
        platform_id:
          type: integer
        mission_type:
          type: string
          enum: [monitoring, survey, calibration]
        mission_recurrence:
          type: string
          enum: [daily, weekly, monthly, seasonal, one_time]
        source_format:
          type: string
          enum: [manual, geojson, kml]
        metadata:
          type: object
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    AOICreate:
      type: object
      required: [name, geometry, geometry_type, station_id]
      properties:
        name:
          type: string
          maxLength: 200
        description:
          type: string
          maxLength: 1000
        geometry:
          type: object
          description: GeoJSON geometry object
        geometry_type:
          type: string
          enum: [point, polygon, multipolygon]
        station_id:
          type: integer
        ecosystem_code:
          $ref: '#/components/schemas/EcosystemCode'
        platform_type_code:
          $ref: '#/components/schemas/PlatformType'
        platform_id:
          type: integer
        mission_type:
          type: string
          enum: [monitoring, survey, calibration]
        mission_recurrence:
          type: string
          enum: [daily, weekly, monthly, seasonal, one_time]
        metadata:
          type: object

    AOIUpdate:
      type: object
      properties:
        name:
          type: string
          maxLength: 200
        description:
          type: string
          maxLength: 1000
        geometry:
          type: object
        geometry_type:
          type: string
          enum: [point, polygon, multipolygon]
        ecosystem_code:
          $ref: '#/components/schemas/EcosystemCode'
        platform_type_code:
          $ref: '#/components/schemas/PlatformType'
        platform_id:
          type: integer
        mission_type:
          type: string
          enum: [monitoring, survey, calibration]
        mission_recurrence:
          type: string
          enum: [daily, weekly, monthly, seasonal, one_time]
        metadata:
          type: object

    AOIResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/AOI'

    # ============================================
    # CAMPAIGN SCHEMAS (v15.6.4+)
    # ============================================
    Campaign:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        description:
          type: string
        station_id:
          type: integer
        status:
          type: string
          enum: [planned, active, completed, cancelled]
        start_date:
          type: string
          format: date
        end_date:
          type: string
          format: date
        objective:
          type: string
        principal_investigator:
          type: string
        funding_source:
          type: string
        metadata:
          type: object
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CampaignCreate:
      type: object
      required: [name, station_id, start_date]
      properties:
        name:
          type: string
          maxLength: 200
        description:
          type: string
          maxLength: 2000
        station_id:
          type: integer
        start_date:
          type: string
          format: date
        end_date:
          type: string
          format: date
        objective:
          type: string
          maxLength: 500
        principal_investigator:
          type: string
          maxLength: 100
        funding_source:
          type: string
          maxLength: 200
        metadata:
          type: object

    CampaignUpdate:
      type: object
      properties:
        name:
          type: string
          maxLength: 200
        description:
          type: string
          maxLength: 2000
        start_date:
          type: string
          format: date
        end_date:
          type: string
          format: date
        objective:
          type: string
          maxLength: 500
        principal_investigator:
          type: string
          maxLength: 100
        funding_source:
          type: string
          maxLength: 200
        status:
          type: string
          enum: [planned, active, completed, cancelled]
        metadata:
          type: object

    CampaignResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/Campaign'

    # ============================================
    # PRODUCT SCHEMAS (v15.6.4+)
    # ============================================
    Product:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        description:
          type: string
        doi:
          type: string
          description: Digital Object Identifier
        instrument_id:
          type: integer
        campaign_id:
          type: integer
        processing_level:
          type: string
          enum: [L0, L1, L2, L3]
        data_format:
          type: string
        file_size_bytes:
          type: integer
        file_path:
          type: string
        start_time:
          type: string
          format: date-time
        end_time:
          type: string
          format: date-time
        quality_score:
          type: number
          minimum: 0
          maximum: 100
        quality_level:
          type: string
          enum: [preliminary, validated, research, publication]
        metadata:
          type: object
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ProductCreate:
      type: object
      required: [name, instrument_id, processing_level]
      properties:
        name:
          type: string
          maxLength: 200
        description:
          type: string
          maxLength: 2000
        doi:
          type: string
          maxLength: 255
        instrument_id:
          type: integer
        campaign_id:
          type: integer
        processing_level:
          type: string
          enum: [L0, L1, L2, L3]
        data_format:
          type: string
          maxLength: 50
        file_size_bytes:
          type: integer
        file_path:
          type: string
          maxLength: 500
        start_time:
          type: string
          format: date-time
        end_time:
          type: string
          format: date-time
        metadata:
          type: object

    ProductUpdate:
      type: object
      properties:
        name:
          type: string
          maxLength: 200
        description:
          type: string
          maxLength: 2000
        doi:
          type: string
          maxLength: 255
        campaign_id:
          type: integer
        processing_level:
          type: string
          enum: [L0, L1, L2, L3]
        data_format:
          type: string
          maxLength: 50
        file_size_bytes:
          type: integer
        file_path:
          type: string
          maxLength: 500
        start_time:
          type: string
          format: date-time
        end_time:
          type: string
          format: date-time
        metadata:
          type: object

    ProductResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/Product'
