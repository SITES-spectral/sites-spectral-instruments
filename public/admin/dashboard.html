<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - SITES Spectral</title>
    <meta name="description" content="Administrative dashboard for SITES Spectral system management">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/images/SITES_favicon.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="/css/styles.css?v=2.0.1">
    
    <!-- Version Meta -->
    <meta name="app-version" content="2.0.1">
    <meta name="build-date" content="2025-09-17">
    
    <style>
        .admin-header {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            padding: 2rem 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .admin-header h1 {
            margin: 0 0 0.5rem 0;
            font-size: 2rem;
            font-weight: 700;
        }
        
        .admin-header p {
            margin: 0;
            opacity: 0.9;
        }
        
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        .admin-stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            border-left: 4px solid var(--danger-color);
        }
        
        .admin-stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--danger-color);
            margin-bottom: 0.5rem;
        }
        
        .admin-stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .admin-nav {
            background: white;
            border-radius: 12px;
            padding: 0;
            margin: 2rem 0;
            box-shadow: var(--shadow-md);
            overflow: hidden;
        }
        
        .admin-nav-item {
            display: block;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-primary);
            text-decoration: none;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .admin-nav-item:hover {
            background: var(--bg-tertiary);
            color: var(--danger-color);
        }
        
        .admin-nav-item:last-child {
            border-bottom: none;
        }
        
        .admin-nav-item i {
            width: 20px;
            text-align: center;
            color: var(--danger-color);
        }
        
        .admin-content {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--shadow-md);
            margin-top: 2rem;
        }
        
        .admin-section {
            display: none;
        }
        
        .admin-section.active {
            display: block;
        }
        
        .admin-section h2 {
            margin-bottom: 1.5rem;
            color: var(--text-primary);
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .admin-table th,
        .admin-table td {
            padding: 1.25rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            vertical-align: top;
        }
        
        .admin-table th {
            background: var(--bg-tertiary);
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .admin-table tbody tr:hover {
            background: var(--bg-secondary);
        }
        
        .admin-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .admin-actions .btn {
            padding: 0.25rem 0.75rem;
            font-size: 0.875rem;
        }

        .status-select {
            border: none;
            background: transparent;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.875rem;
            cursor: pointer;
            min-width: 80px;
        }

        .status-select.active {
            background: #dcfce7;
            color: #15803d;
        }

        .status-select.inactive {
            background: #fee2e2;
            color: #dc2626;
        }

        .status-select.disabled {
            background: #f3f4f6;
            color: #6b7280;
        }
        
        .danger-zone {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 2rem;
        }
        
        .danger-zone h3 {
            color: var(--danger-color);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .danger-zone p {
            color: #7f1d1d;
            margin-bottom: 1rem;
        }
        
        @media (max-width: 768px) {
            .admin-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <img src="/images/SITES_spectral_LOGO.png" alt="SITES Spectral" class="brand-logo">
                <span>SITES Spectral</span>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="/" class="nav-link">
                        <i class="fas fa-home"></i> Public Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/login.html" class="nav-link" id="auth-link">
                        <i class="fas fa-sign-in-alt"></i> <span id="auth-text">Login</span>
                    </a>
                </li>
            </ul>
            <div class="user-menu">
                <button class="user-dropdown" onclick="toggleUserMenu()">
                    <i class="fas fa-user-shield"></i>
                    <span id="admin-user-name">Admin</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="user-dropdown-menu" id="user-menu">
                    <a href="/station/dashboard.html" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Admin Header -->
    <section class="admin-header">
        <div class="container">
            <h1><i class="fas fa-shield-alt"></i> System Administration</h1>
            <p>Complete system management and oversight</p>
        </div>
    </section>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Admin Statistics -->
            <div class="admin-stats">
                <div class="admin-stat-card">
                    <div class="admin-stat-number" id="total-users">-</div>
                    <div class="admin-stat-label">System Users</div>
                </div>
                <div class="admin-stat-card">
                    <div class="admin-stat-number" id="active-sessions">-</div>
                    <div class="admin-stat-label">Active Sessions</div>
                </div>
                <div class="admin-stat-card">
                    <div class="admin-stat-number" id="total-stations-admin">-</div>
                    <div class="admin-stat-label">Total Stations</div>
                </div>
                <div class="admin-stat-card">
                    <div class="admin-stat-number" id="total-platforms-admin">-</div>
                    <div class="admin-stat-label">Total Platforms</div>
                </div>
                <div class="admin-stat-card">
                    <div class="admin-stat-number" id="total-instruments-admin">-</div>
                    <div class="admin-stat-label">Total Instruments</div>
                </div>
            </div>

            <!-- Admin Navigation -->
            <nav class="admin-nav">
                <a href="#users" class="admin-nav-item" onclick="showSection('users')">
                    <i class="fas fa-users"></i>
                    <span>User Management</span>
                </a>
                <a href="#stations" class="admin-nav-item" onclick="showSection('stations')">
                    <i class="fas fa-broadcast-tower"></i>
                    <span>Stations Overview</span>
                </a>
                <a href="#platforms" class="admin-nav-item" onclick="showSection('platforms')">
                    <i class="fas fa-building"></i>
                    <span>Platform Management</span>
                </a>
                <a href="#instruments" class="admin-nav-item" onclick="showSection('instruments')">
                    <i class="fas fa-microscope"></i>
                    <span>Instrument Overview</span>
                </a>
                <a href="#activity" class="admin-nav-item" onclick="showSection('activity')">
                    <i class="fas fa-history"></i>
                    <span>Activity Logs</span>
                </a>
                <a href="#system" class="admin-nav-item" onclick="showSection('system')">
                    <i class="fas fa-cogs"></i>
                    <span>System Settings</span>
                </a>
            </nav>

            <!-- Admin Content Sections -->
            <div class="admin-content">
                <!-- User Management -->
                <div id="users" class="admin-section active">
                    <h2><i class="fas fa-users"></i> User Management</h2>
                    <div class="section-actions">
                        <button class="btn btn-primary" onclick="addUser()">
                            <i class="fas fa-plus"></i> Add User
                        </button>
                        <button class="btn btn-outline" onclick="exportUsers()">
                            <i class="fas fa-download"></i> Export Users
                        </button>
                    </div>
                    
                    <table class="admin-table" id="users-table">
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Full Name</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Station</th>
                                <th>Status</th>
                                <th>Last Login</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="users-tbody">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 2rem;">
                                    <div class="spinner"></div>
                                    <p>Loading users...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Stations Overview -->
                <div id="stations" class="admin-section">
                    <h2><i class="fas fa-broadcast-tower"></i> Stations Management</h2>
                    <div class="section-actions">
                        <button class="btn btn-primary" onclick="addStation()">
                            <i class="fas fa-plus"></i> Add Station
                        </button>
                        <button class="btn btn-outline" onclick="exportStations()">
                            <i class="fas fa-download"></i> Export Stations
                        </button>
                    </div>
                    
                    <table class="admin-table" id="stations-table">
                        <thead>
                            <tr>
                                <th>Station Name</th>
                                <th>Acronym</th>
                                <th>Region</th>
                                <th>Status</th>
                                <th>Platforms</th>
                                <th>Instruments</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="stations-tbody">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 2rem;">
                                    <div class="spinner"></div>
                                    <p>Loading stations...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Platform Management -->
                <div id="platforms" class="admin-section">
                    <h2><i class="fas fa-building"></i> Platform Management</h2>
                    <div class="section-actions">
                        <button class="btn btn-primary" onclick="addPlatform()">
                            <i class="fas fa-plus"></i> Add Platform
                        </button>
                        <button class="btn btn-outline" onclick="exportPlatforms()">
                            <i class="fas fa-download"></i> Export Platforms
                        </button>
                    </div>
                    
                    <table class="admin-table" id="platforms-table">
                        <thead>
                            <tr>
                                <th>Platform Name</th>
                                <th>Station</th>
                                <th>Type</th>
                                <th>Status</th>
                                <th>Instruments</th>
                                <th>Location</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="platforms-tbody">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 2rem;">
                                    <div class="spinner"></div>
                                    <p>Loading platforms...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Instrument Overview -->
                <div id="instruments" class="admin-section">
                    <h2><i class="fas fa-microscope"></i> Instrument Management</h2>
                    <div class="section-actions">
                        <button class="btn btn-primary" onclick="addInstrument()">
                            <i class="fas fa-plus"></i> Add Instrument
                        </button>
                        <button class="btn btn-outline" onclick="exportInstruments()">
                            <i class="fas fa-download"></i> Export Instruments
                        </button>
                    </div>
                    
                    <table class="admin-table" id="instruments-table">
                        <thead>
                            <tr>
                                <th>Instrument Name</th>
                                <th>Station</th>
                                <th>Platform</th>
                                <th>Type</th>
                                <th>Status</th>
                                <th>Last Data</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="instruments-tbody">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 2rem;">
                                    <div class="spinner"></div>
                                    <p>Loading instruments...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Activity Logs -->
                <div id="activity" class="admin-section">
                    <h2><i class="fas fa-history"></i> Activity Logs</h2>
                    <div class="section-actions">
                        <button class="btn btn-outline" onclick="refreshActivity()">
                            <i class="fas fa-refresh"></i> Refresh
                        </button>
                        <button class="btn btn-outline" onclick="exportActivity()">
                            <i class="fas fa-download"></i> Export Logs
                        </button>
                        <button class="btn btn-danger" onclick="clearLogs()">
                            <i class="fas fa-trash"></i> Clear Logs
                        </button>
                    </div>
                    
                    <table class="admin-table" id="activity-table">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>User</th>
                                <th>Action</th>
                                <th>Target</th>
                                <th>IP Address</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="activity-tbody">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 2rem;">
                                    <div class="spinner"></div>
                                    <p>Loading activity logs...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- System Settings -->
                <div id="system" class="admin-section">
                    <h2><i class="fas fa-cogs"></i> System Settings</h2>
                    <p>System configuration, maintenance, and advanced settings.</p>
                    
                    <div class="danger-zone">
                        <h3><i class="fas fa-exclamation-triangle"></i> Danger Zone</h3>
                        <p>These actions can have serious consequences. Use with extreme caution.</p>
                        
                        <button class="btn btn-danger" onclick="confirmSystemReset()">
                            <i class="fas fa-exclamation-triangle"></i> Reset System Data
                        </button>
                        
                        <button class="btn btn-danger" onclick="confirmDatabaseBackup()" style="margin-left: 1rem;">
                            <i class="fas fa-database"></i> Backup Database
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Scripts -->
    <script src="/js/utils.js?v=2.0.1"></script>
    <script src="/js/api.js?v=2.0.1"></script>
    <script>
        class AdminDashboard {
            constructor() {
                this.currentUser = null;
                this.init();
            }
            
            async init() {
                await this.checkAuthentication();
                this.loadStatistics();
                this.loadUsers();
                this.loadStations();
                this.loadPlatforms();
                this.loadInstruments();
                this.loadActivity();
                this.setupEventListeners();
            }
            
            async checkAuthentication() {
                const token = localStorage.getItem('sites_spectral_token');
                if (!token) {
                    window.location.href = '/login.html?redirect=' + encodeURIComponent(window.location.pathname);
                    return;
                }
                
                try {
                    const response = await fetch('/api/auth/verify', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        if (data.valid && data.user.role === 'admin') {
                            this.currentUser = data.user;
                            document.getElementById('admin-user-name').textContent = data.user.full_name || data.user.username;
                            return;
                        }
                    }
                } catch (error) {
                    console.error('Auth verification failed:', error);
                }
                
                // Not admin or invalid token
                Utils.showToast('Admin access required', 'error');
                setTimeout(() => {
                    localStorage.removeItem('sites_spectral_token');
                    window.location.href = '/login.html';
                }, 2000);
            }
            
            async loadStatistics() {
                try {
                    // This would connect to admin-specific statistics endpoints
                    // For now, using placeholder data
                    document.getElementById('total-users').textContent = '5';
                    document.getElementById('active-sessions').textContent = '3';
                    document.getElementById('total-stations-admin').textContent = '9';
                    document.getElementById('total-platforms-admin').textContent = '12';
                    document.getElementById('total-instruments-admin').textContent = '83';
                } catch (error) {
                    console.error('Failed to load statistics:', error);
                }
            }
            
            async loadUsers() {
                try {
                    // This would load users from the API
                    // For now, show test users
                    const users = [
                        { username: 'admin', full_name: 'System Administrator', email: 'admin@sites.se', role: 'admin', station: 'All Stations', status: 'Active', last_login: '2025-09-12' },
                        { username: 'svartberget', full_name: 'Svartberget Manager', email: 'svb@sites.se', role: 'station', station: 'Svartberget', status: 'Active', last_login: '2025-09-10' },
                        { username: 'skogaryd', full_name: 'Skogaryd Manager', email: 'skc@sites.se', role: 'station', station: 'Skogaryd', status: 'Active', last_login: '2025-09-09' },
                        { username: 'lonnstorp', full_name: 'Lönnstorp Manager', email: 'lon@sites.se', role: 'station', station: 'Lönnstorp', status: 'Active', last_login: '2025-09-08' },
                        { username: 'readonly', full_name: 'Read Only User', email: 'readonly@sites.se', role: 'readonly', station: 'N/A', status: 'Active', last_login: 'Never' }
                    ];
                    
                    this.renderUsersTable(users);
                } catch (error) {
                    console.error('Failed to load users:', error);
                }
            }

            async loadStations() {
                try {
                    const response = await fetch('/api/stations', {
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('sites_spectral_token')}`
                        }
                    });
                    
                    if (response.ok) {
                        const stations = await response.json();
                        this.renderStationsTable(stations);
                    } else {
                        throw new Error('Failed to load stations');
                    }
                } catch (error) {
                    console.error('Failed to load stations:', error);
                    // Show test data if API fails
                    const testStations = [
                        { id: 1, name: 'Svartberget', acronym: 'SVB', region: 'Northern Sweden', status: 'active', platforms: 2, instruments: 12 },
                        { id: 2, name: 'Skogaryd', acronym: 'SKC', region: 'Southern Sweden', status: 'active', platforms: 1, instruments: 8 },
                        { id: 3, name: 'Lönnstorp', acronym: 'LON', region: 'Southern Sweden', status: 'active', platforms: 3, instruments: 15 },
                        { id: 4, name: 'Tarfala', acronym: 'TAR', region: 'Arctic', status: 'disabled', platforms: 1, instruments: 5 }
                    ];
                    this.renderStationsTable(testStations);
                }
            }

            async loadPlatforms() {
                try {
                    // Load test platform data
                    const testPlatforms = [
                        { id: 1, name: 'Tower Platform', station: 'Svartberget', type: 'Tower', status: 'active', instruments: 8, location: '64.2558°N, 19.7742°E' },
                        { id: 2, name: 'Ground Platform', station: 'Svartberget', type: 'Ground', status: 'active', instruments: 4, location: '64.2540°N, 19.7720°E' },
                        { id: 3, name: 'Canopy Platform', station: 'Skogaryd', type: 'Canopy', status: 'active', instruments: 8, location: '58.3822°N, 12.1475°E' },
                        { id: 4, name: 'Main Tower', station: 'Lönnstorp', type: 'Tower', status: 'active', instruments: 10, location: '55.6739°N, 13.1014°E' }
                    ];
                    this.renderPlatformsTable(testPlatforms);
                } catch (error) {
                    console.error('Failed to load platforms:', error);
                }
            }

            async loadInstruments() {
                try {
                    // Load test instrument data
                    const testInstruments = [
                        { id: 1, name: 'PhenoCam PC01', station: 'Svartberget', platform: 'Tower Platform', type: 'PhenoCam', status: 'active', last_data: '2025-09-12 14:30' },
                        { id: 2, name: 'MS Camera MS01', station: 'Svartberget', platform: 'Tower Platform', type: 'Multispectral', status: 'active', last_data: '2025-09-12 14:25' },
                        { id: 3, name: 'PhenoCam PC02', station: 'Skogaryd', platform: 'Canopy Platform', type: 'PhenoCam', status: 'inactive', last_data: '2025-09-10 12:15' },
                        { id: 4, name: 'MS Camera MS02', station: 'Lönnstorp', platform: 'Main Tower', type: 'Multispectral', status: 'active', last_data: '2025-09-12 14:20' }
                    ];
                    this.renderInstrumentsTable(testInstruments);
                } catch (error) {
                    console.error('Failed to load instruments:', error);
                }
            }

            async loadActivity() {
                try {
                    // Load test activity data
                    const testActivity = [
                        { timestamp: '2025-09-12 14:35', user: 'admin', action: 'Station Access', target: 'Svartberget', ip: '192.168.1.100', status: 'Success' },
                        { timestamp: '2025-09-12 14:30', user: 'svartberget', action: 'Instrument Update', target: 'PhenoCam PC01', ip: '10.0.0.50', status: 'Success' },
                        { timestamp: '2025-09-12 14:25', user: 'lonnstorp', action: 'Platform Edit', target: 'Main Tower', ip: '10.0.0.75', status: 'Success' },
                        { timestamp: '2025-09-12 14:20', user: 'admin', action: 'User Login', target: 'Admin Dashboard', ip: '192.168.1.100', status: 'Success' }
                    ];
                    this.renderActivityTable(testActivity);
                } catch (error) {
                    console.error('Failed to load activity:', error);
                }
            }
            
            renderUsersTable(users) {
                const tbody = document.getElementById('users-tbody');
                
                tbody.innerHTML = users.map(user => `
                    <tr>
                        <td><strong>${user.username}</strong></td>
                        <td>${user.full_name}</td>
                        <td>${user.email}</td>
                        <td><span class="status-badge ${user.role}">${user.role}</span></td>
                        <td>${user.station}</td>
                        <td>
                            <select class="status-select ${user.status.toLowerCase()}" onchange="updateUserStatus('${user.username}', this.value)">
                                <option value="Active" ${user.status === 'Active' ? 'selected' : ''}>Active</option>
                                <option value="Inactive" ${user.status === 'Inactive' ? 'selected' : ''}>Inactive</option>
                                <option value="Disabled" ${user.status === 'Disabled' ? 'selected' : ''}>Disabled</option>
                            </select>
                        </td>
                        <td>${user.last_login}</td>
                        <td>
                            <div class="admin-actions">
                                <button class="btn btn-sm btn-outline" onclick="editUser('${user.username}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteUser('${user.username}')" ${user.username === 'admin' ? 'disabled' : ''}>
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }

            renderStationsTable(stations) {
                const tbody = document.getElementById('stations-tbody');
                
                tbody.innerHTML = stations.map(station => `
                    <tr>
                        <td><strong>${station.name}</strong></td>
                        <td>${station.acronym}</td>
                        <td>${station.region}</td>
                        <td>
                            <select class="status-select ${station.status}" onchange="updateStationStatus(${station.id}, this.value)">
                                <option value="active" ${station.status === 'active' ? 'selected' : ''}>Active</option>
                                <option value="inactive" ${station.status === 'inactive' ? 'selected' : ''}>Inactive</option>
                                <option value="disabled" ${station.status === 'disabled' ? 'selected' : ''}>Disabled</option>
                            </select>
                        </td>
                        <td>${station.platforms}</td>
                        <td>${station.instruments}</td>
                        <td>
                            <div class="admin-actions">
                                <button class="btn btn-sm btn-outline" onclick="editStation(${station.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-primary" onclick="viewStation(${station.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteStation(${station.id}, '${station.name}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }

            renderPlatformsTable(platforms) {
                const tbody = document.getElementById('platforms-tbody');
                
                tbody.innerHTML = platforms.map(platform => `
                    <tr>
                        <td><strong>${platform.name}</strong></td>
                        <td>${platform.station}</td>
                        <td>${platform.type}</td>
                        <td>
                            <select class="status-select ${platform.status}" onchange="updatePlatformStatus(${platform.id}, this.value)">
                                <option value="active" ${platform.status === 'active' ? 'selected' : ''}>Active</option>
                                <option value="inactive" ${platform.status === 'inactive' ? 'selected' : ''}>Inactive</option>
                                <option value="disabled" ${platform.status === 'disabled' ? 'selected' : ''}>Disabled</option>
                            </select>
                        </td>
                        <td>${platform.instruments}</td>
                        <td>${platform.location}</td>
                        <td>
                            <div class="admin-actions">
                                <button class="btn btn-sm btn-outline" onclick="editPlatform(${platform.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-primary" onclick="viewPlatform(${platform.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deletePlatform(${platform.id}, '${platform.name}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }

            renderInstrumentsTable(instruments) {
                const tbody = document.getElementById('instruments-tbody');
                
                tbody.innerHTML = instruments.map(instrument => `
                    <tr>
                        <td><strong>${instrument.name}</strong></td>
                        <td>${instrument.station}</td>
                        <td>${instrument.platform}</td>
                        <td>${instrument.type}</td>
                        <td>
                            <select class="status-select ${instrument.status}" onchange="updateInstrumentStatus(${instrument.id}, this.value)">
                                <option value="active" ${instrument.status === 'active' ? 'selected' : ''}>Active</option>
                                <option value="inactive" ${instrument.status === 'inactive' ? 'selected' : ''}>Inactive</option>
                                <option value="disabled" ${instrument.status === 'disabled' ? 'selected' : ''}>Disabled</option>
                            </select>
                        </td>
                        <td>${instrument.last_data}</td>
                        <td>
                            <div class="admin-actions">
                                <button class="btn btn-sm btn-outline" onclick="editInstrument(${instrument.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-primary" onclick="viewInstrument(${instrument.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteInstrument(${instrument.id}, '${instrument.name}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }

            renderActivityTable(activities) {
                const tbody = document.getElementById('activity-tbody');
                
                tbody.innerHTML = activities.map(activity => `
                    <tr>
                        <td>${activity.timestamp}</td>
                        <td><strong>${activity.user}</strong></td>
                        <td>${activity.action}</td>
                        <td>${activity.target}</td>
                        <td>${activity.ip}</td>
                        <td><span class="status-badge ${activity.status.toLowerCase()}">${activity.status}</span></td>
                    </tr>
                `).join('');
            }
            
            setupEventListeners() {
                // Add event listeners for admin functionality
            }
        }
        
        // Global functions
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.admin-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Update nav active state
            document.querySelectorAll('.admin-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`a[href="#${sectionId}"]`).classList.add('active');
        }
        
        // User Management Functions
        function addUser() {
            Utils.showToast('Add user functionality coming soon', 'info');
        }
        
        function editUser(username) {
            Utils.showToast(`Edit user: ${username} (coming soon)`, 'info');
        }
        
        function deleteUser(username) {
            if (confirm(`Are you sure you want to delete user: ${username}?`)) {
                Utils.showToast(`Delete user functionality coming soon`, 'info');
            }
        }
        
        function updateUserStatus(username, status) {
            if (confirm(`Change user ${username} status to ${status}?`)) {
                // Update status via API
                Utils.showToast(`User ${username} status changed to ${status}`, 'success');
            }
        }
        
        function exportUsers() {
            Utils.showToast('Export users functionality coming soon', 'info');
        }

        // Station Management Functions
        function addStation() {
            Utils.showToast('Add station functionality coming soon', 'info');
        }
        
        function editStation(stationId) {
            Utils.showToast(`Edit station ID: ${stationId} (coming soon)`, 'info');
        }
        
        function viewStation(stationId) {
            // Navigate to station individual page
            window.open(`/station.html?id=${stationId}`, '_blank');
        }
        
        function deleteStation(stationId, stationName) {
            if (confirm(`Are you sure you want to delete station: ${stationName}? This action cannot be undone.`)) {
                Utils.showToast(`Delete station functionality coming soon`, 'info');
            }
        }
        
        function updateStationStatus(stationId, status) {
            if (confirm(`Change station status to ${status}?`)) {
                // Update status via API
                Utils.showToast(`Station status changed to ${status}`, 'success');
            }
        }
        
        function exportStations() {
            Utils.showToast('Export stations functionality coming soon', 'info');
        }

        // Platform Management Functions
        function addPlatform() {
            Utils.showToast('Add platform functionality coming soon', 'info');
        }
        
        function editPlatform(platformId) {
            Utils.showToast(`Edit platform ID: ${platformId} (coming soon)`, 'info');
        }
        
        function viewPlatform(platformId) {
            Utils.showToast(`View platform ID: ${platformId} (coming soon)`, 'info');
        }
        
        function deletePlatform(platformId, platformName) {
            if (confirm(`Are you sure you want to delete platform: ${platformName}?`)) {
                Utils.showToast(`Delete platform functionality coming soon`, 'info');
            }
        }
        
        function updatePlatformStatus(platformId, status) {
            if (confirm(`Change platform status to ${status}?`)) {
                // Update status via API
                Utils.showToast(`Platform status changed to ${status}`, 'success');
            }
        }
        
        function exportPlatforms() {
            Utils.showToast('Export platforms functionality coming soon', 'info');
        }

        // Instrument Management Functions
        function addInstrument() {
            Utils.showToast('Add instrument functionality coming soon', 'info');
        }
        
        function editInstrument(instrumentId) {
            Utils.showToast(`Edit instrument ID: ${instrumentId} (coming soon)`, 'info');
        }
        
        function viewInstrument(instrumentId) {
            Utils.showToast(`View instrument ID: ${instrumentId} (coming soon)`, 'info');
        }
        
        function deleteInstrument(instrumentId, instrumentName) {
            if (confirm(`Are you sure you want to delete instrument: ${instrumentName}?`)) {
                Utils.showToast(`Delete instrument functionality coming soon`, 'info');
            }
        }
        
        function updateInstrumentStatus(instrumentId, status) {
            if (confirm(`Change instrument status to ${status}?`)) {
                // Update status via API
                Utils.showToast(`Instrument status changed to ${status}`, 'success');
            }
        }
        
        function exportInstruments() {
            Utils.showToast('Export instruments functionality coming soon', 'info');
        }

        // Activity Management Functions
        function refreshActivity() {
            Utils.showToast('Refreshing activity logs...', 'info');
            // Reload activity data
        }
        
        function exportActivity() {
            Utils.showToast('Export activity logs functionality coming soon', 'info');
        }
        
        function clearLogs() {
            if (confirm('Are you sure you want to clear all activity logs? This action cannot be undone.')) {
                Utils.showToast('Clear logs functionality disabled for safety', 'warning');
            }
        }
        
        function confirmSystemReset() {
            if (confirm('This will reset all system data. This action cannot be undone. Are you absolutely sure?')) {
                Utils.showToast('System reset functionality disabled for safety', 'warning');
            }
        }
        
        function confirmDatabaseBackup() {
            Utils.showToast('Database backup functionality coming soon', 'info');
        }
        
        function toggleUserMenu() {
            const menu = document.getElementById('user-menu');
            menu.classList.toggle('show');
        }
        
        function logout() {
            localStorage.removeItem('sites_spectral_token');
            localStorage.removeItem('sites_spectral_user');
            window.location.href = '/login.html';
        }
        
        // Initialize admin dashboard
        document.addEventListener('DOMContentLoaded', () => {
            new AdminDashboard();
        });
    </script>
</body>
</html>